"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[7404],{7184(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"codesearch-repository-management","title":"Code Search Repository Management: Local, Remote, and Incremental Indexing","description":"Problem Statement","source":"@site/docs/codesearch-repository-management.md","sourceDirName":".","slug":"/codesearch-repository-management","permalink":"/aeterna/docs/codesearch-repository-management","draft":false,"unlisted":false,"editUrl":"https://github.com/kikokikok/aeterna/tree/main/website/docs/codesearch-repository-management.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Code Search Integration Guide","permalink":"/aeterna/docs/codesearch-integration"},"next":{"title":"RBAC Permission Matrix","permalink":"/aeterna/docs/security/rbac-matrix"}}');var t=i(4848),s=i(8453);const a={},l="Code Search Repository Management: Local, Remote, and Incremental Indexing",c={},d=[{value:"Problem Statement",id:"problem-statement",level:2},{value:"Solution Architecture",id:"solution-architecture",level:2},{value:"Repository Types",id:"repository-types",level:3},{value:"1. Local Repositories",id:"1-local-repositories",level:4},{value:"2. Remote Repositories",id:"2-remote-repositories",level:4},{value:"3. Hybrid Repositories",id:"3-hybrid-repositories",level:4},{value:"Incremental Indexing",id:"incremental-indexing",level:3},{value:"Problem",id:"problem",level:4},{value:"Solution: Git-Based Change Detection",id:"solution-git-based-change-detection",level:4},{value:"Smart Strategies",id:"smart-strategies",level:4},{value:"Repository Lifecycle Management",id:"repository-lifecycle-management",level:3},{value:"State Machine",id:"state-machine",level:4},{value:"Database Schema",id:"database-schema",level:4},{value:"Performance Considerations",id:"performance-considerations",level:3},{value:"Indexing Performance",id:"indexing-performance",level:4},{value:"Storage Performance",id:"storage-performance",level:4},{value:"Multi-Branch Strategy",id:"multi-branch-strategy",level:3},{value:"Use Cases",id:"use-cases",level:4},{value:"Implementation",id:"implementation",level:4},{value:"Webhook Integration",id:"webhook-integration",level:3},{value:"GitHub Webhooks",id:"github-webhooks",level:4},{value:"CLI Commands",id:"cli-commands",level:3},{value:"Extended Repository Management",id:"extended-repository-management",level:4},{value:"Configuration Examples",id:"configuration-examples",level:3},{value:"Development Setup (Local Only)",id:"development-setup-local-only",level:4},{value:"Team Setup (Remote + Incremental)",id:"team-setup-remote--incremental",level:4},{value:"Hybrid Setup (Best of Both Worlds)",id:"hybrid-setup-best-of-both-worlds",level:4},{value:"Migration Path",id:"migration-path",level:3},{value:"From Standalone Code Search",id:"from-standalone-code-search",level:4},{value:"Best Practices",id:"best-practices",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3},{value:"Issue: Incremental index missing changes",id:"issue-incremental-index-missing-changes",level:4},{value:"Issue: Webhook not triggering",id:"issue-webhook-not-triggering",level:4},{value:"Issue: High embedding API costs",id:"issue-high-embedding-api-costs",level:4},{value:"Future Enhancements",id:"future-enhancements",level:3},{value:"Conclusion",id:"conclusion",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"code-search-repository-management-local-remote-and-incremental-indexing",children:"Code Search Repository Management: Local, Remote, and Incremental Indexing"})}),"\n",(0,t.jsx)(n.h2,{id:"problem-statement",children:"Problem Statement"}),"\n",(0,t.jsxs)(n.p,{children:["The current Code Search integration only supports ",(0,t.jsx)(n.strong,{children:"static local directories"}),". Real-world use cases require:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Local Development Repos"})," - Developer's active workspace with real-time changes"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Remote Team Repos"})," - Shared repositories with multiple branches"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Incremental Indexing"})," - Only re-index changes, not full codebase"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Hybrid Approach"})," - Local clones of remote repos with synchronization"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"solution-architecture",children:"Solution Architecture"}),"\n",(0,t.jsx)(n.h3,{id:"repository-types",children:"Repository Types"}),"\n",(0,t.jsx)(n.h4,{id:"1-local-repositories",children:"1. Local Repositories"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Use Case"}),": Active development on developer's machine"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"repositories:\n  - name: my-local-project\n    type: local\n    path: /workspace/my-project\n    indexing:\n      mode: watch  # Real-time file watching\n      on_save: true\n      debounce_ms: 500\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Characteristics"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Real-time file system watching (fsnotify/inotify)"}),"\n",(0,t.jsx)(n.li,{children:"Immediate index updates on file changes"}),"\n",(0,t.jsx)(n.li,{children:"No git required (can work with uncommitted changes)"}),"\n",(0,t.jsx)(n.li,{children:"Lowest latency for search/trace"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"2-remote-repositories",children:"2. Remote Repositories"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Use Case"}),": Team repositories, open-source projects, dependencies"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'repositories:\n  - name: company-backend\n    type: remote\n    url: https://github.com/company/backend.git\n    branches:\n      - main\n      - develop\n      - "feature/*"  # Wildcard support\n    indexing:\n      mode: poll\n      interval: 5m  # Check for updates every 5 minutes\n      on_push: webhook  # Optional: GitHub webhook trigger\n    credentials:\n      type: token\n      secret: github-token\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Characteristics"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Automatic cloning on first use"}),"\n",(0,t.jsx)(n.li,{children:"Periodic polling for updates (configurable)"}),"\n",(0,t.jsx)(n.li,{children:"Multi-branch support with branch switching"}),"\n",(0,t.jsx)(n.li,{children:"Git credentials management (SSH keys, tokens, OAuth)"}),"\n",(0,t.jsx)(n.li,{children:"Optional webhook integration for instant updates"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"3-hybrid-repositories",children:"3. Hybrid Repositories"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Use Case"}),": Local clone of remote repo with bidirectional sync"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"repositories:\n  - name: aeterna-dev\n    type: hybrid\n    url: https://github.com/kikokikok/aeterna.git\n    local_path: /workspace/aeterna\n    branch: main\n    sync:\n      mode: bidirectional\n      auto_pull: true\n      pull_interval: 10m\n      watch_local: true  # Also watch local changes\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Characteristics"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Best of both worlds: local speed + remote updates"}),"\n",(0,t.jsx)(n.li,{children:"Automatic git pull to stay synchronized"}),"\n",(0,t.jsx)(n.li,{children:"Can switch branches locally"}),"\n",(0,t.jsx)(n.li,{children:"Detects local uncommitted changes"}),"\n",(0,t.jsx)(n.li,{children:"Smart conflict detection"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"incremental-indexing",children:"Incremental Indexing"}),"\n",(0,t.jsx)(n.h4,{id:"problem",children:"Problem"}),"\n",(0,t.jsx)(n.p,{children:"Full re-indexing is expensive:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Large codebases: 10,000+ files"}),"\n",(0,t.jsx)(n.li,{children:"Embedding generation: 100-500ms per file"}),"\n",(0,t.jsx)(n.li,{children:"Total time: 15-60 minutes for full index"}),"\n",(0,t.jsx)(n.li,{children:"Resource intensive (CPU, memory, API costs)"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"solution-git-based-change-detection",children:"Solution: Git-Based Change Detection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:'pub struct IncrementalIndexer {\n    repo_path: PathBuf,\n    last_indexed_commit: String,\n    index_metadata: IndexMetadata,\n}\n\nimpl IncrementalIndexer {\n    /// Detect files changed since last index\n    pub fn get_changed_files(&self) -> Result<Vec<ChangedFile>> {\n        // git diff --name-status <last_commit>..HEAD\n        let output = Command::new("git")\n            .args(&["diff", "--name-status", \n                    &format!("{}..HEAD", self.last_indexed_commit)])\n            .current_dir(&self.repo_path)\n            .output()?;\n        \n        // Parse: A (added), M (modified), D (deleted), R (renamed)\n        self.parse_diff_output(&output.stdout)\n    }\n    \n    /// Perform incremental index update\n    pub async fn update_index(&mut self) -> Result<IndexStats> {\n        let changes = self.get_changed_files()?;\n        \n        let mut stats = IndexStats::default();\n        \n        for change in changes {\n            match change.status {\n                ChangeStatus::Added | ChangeStatus::Modified => {\n                    // Generate embeddings for new/modified file\n                    self.index_file(&change.path).await?;\n                    stats.files_indexed += 1;\n                }\n                ChangeStatus::Deleted => {\n                    // Remove from index\n                    self.remove_from_index(&change.path).await?;\n                    stats.files_removed += 1;\n                }\n                ChangeStatus::Renamed => {\n                    // Update path in index\n                    self.rename_in_index(&change.old_path, &change.new_path).await?;\n                    stats.files_renamed += 1;\n                }\n            }\n        }\n        \n        // Update metadata\n        self.last_indexed_commit = self.get_current_commit()?;\n        self.save_metadata()?;\n        \n        Ok(stats)\n    }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"10-100x faster than full re-index"}),"\n",(0,t.jsx)(n.li,{children:"Proportional to change size (1 file = 1 file indexed)"}),"\n",(0,t.jsx)(n.li,{children:"Lower API costs (only new/modified files)"}),"\n",(0,t.jsx)(n.li,{children:"Can run more frequently"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"smart-strategies",children:"Smart Strategies"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"File System Watch"})," (Local Repos)"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:"// Use notify crate for file system events\nlet watcher = notify::watcher(tx, Duration::from_millis(500))?;\nwatcher.watch(&repo_path, RecursiveMode::Recursive)?;\n\n// On file change\nasync fn on_file_changed(path: &Path) {\n    // Debounce to avoid re-indexing on every keystroke\n    tokio::time::sleep(Duration::from_millis(500)).await;\n    indexer.index_file(path).await?;\n}\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Git Hook Integration"})," (Hybrid/Local)"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# .git/hooks/post-commit\n#!/bin/bash\naeterna codesearch index --incremental --async\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Webhook Triggers"})," (Remote Repos)"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'# GitHub webhook on push\nPOST /api/v1/codesearch/webhook/github\n{\n  "repository": "company/backend",\n  "ref": "refs/heads/main",\n  "commits": [...]\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"repository-lifecycle-management",children:"Repository Lifecycle Management"}),"\n",(0,t.jsx)(n.h4,{id:"state-machine",children:"State Machine"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 INITIAL  \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502 add remote\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 CLONING  \u2502  \u2190 git clone in progress\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502 clone complete\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 INDEXING \u2502  \u2190 initial full index\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502 index complete\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  READY   \u2502 \u2500\u2500\u2500\u2500\u25b6\u2502 UPDATING \u2502  \u2190 incremental update\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502                  \u2502\n     \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502\n     \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  ERROR   \u2502  \u2190 failed clone/index\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.h4,{id:"database-schema",children:"Database Schema"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Repository metadata\nCREATE TABLE codesearch_repositories (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    tenant_id UUID NOT NULL REFERENCES tenants(id),\n    name VARCHAR(255) NOT NULL,\n    type VARCHAR(20) NOT NULL,  -- 'local', 'remote', 'hybrid'\n    \n    -- Remote repo fields\n    remote_url TEXT,\n    current_branch VARCHAR(255),\n    tracked_branches TEXT[],\n    \n    -- Local repo fields\n    local_path TEXT NOT NULL,\n    \n    -- Indexing state\n    status VARCHAR(20) NOT NULL,  -- 'cloning', 'indexing', 'ready', 'error'\n    last_indexed_commit VARCHAR(40),\n    last_indexed_at TIMESTAMPTZ,\n    last_updated_at TIMESTAMPTZ,\n    \n    -- Configuration\n    config JSONB,  -- Type-specific config\n    \n    created_at TIMESTAMPTZ DEFAULT NOW(),\n    updated_at TIMESTAMPTZ DEFAULT NOW(),\n    \n    UNIQUE(tenant_id, name)\n);\n\n-- Index metadata for incremental updates\nCREATE TABLE codesearch_index_metadata (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    repository_id UUID NOT NULL REFERENCES codesearch_repositories(id),\n    \n    -- Commit tracking\n    commit_sha VARCHAR(40) NOT NULL,\n    parent_commit_sha VARCHAR(40),\n    \n    -- Statistics\n    files_indexed INTEGER NOT NULL,\n    files_removed INTEGER,\n    files_renamed INTEGER,\n    embeddings_generated INTEGER,\n    \n    -- Performance metrics\n    indexing_duration_ms INTEGER,\n    embedding_api_calls INTEGER,\n    \n    indexed_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- Enable RLS for multi-tenancy\nALTER TABLE codesearch_repositories ENABLE ROW LEVEL SECURITY;\nALTER TABLE codesearch_index_metadata ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY codesearch_repositories_tenant_isolation \nON codesearch_repositories \nFOR ALL \nTO authenticated \nUSING (tenant_id = current_setting('app.tenant_id', true)::UUID);\n\nCREATE POLICY codesearch_index_metadata_tenant_isolation \nON codesearch_index_metadata \nFOR ALL \nTO authenticated \nUSING (\n    repository_id IN (\n        SELECT id FROM codesearch_repositories \n        WHERE tenant_id = current_setting('app.tenant_id', true)::UUID\n    )\n);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,t.jsx)(n.h4,{id:"indexing-performance",children:"Indexing Performance"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Strategy"}),(0,t.jsx)(n.th,{children:"Files Changed"}),(0,t.jsx)(n.th,{children:"Time (Approx)"}),(0,t.jsx)(n.th,{children:"API Calls"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Full Index"}),(0,t.jsx)(n.td,{children:"10,000"}),(0,t.jsx)(n.td,{children:"30-60 min"}),(0,t.jsx)(n.td,{children:"10,000"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Incremental (10 files)"}),(0,t.jsx)(n.td,{children:"10"}),(0,t.jsx)(n.td,{children:"5-10 sec"}),(0,t.jsx)(n.td,{children:"10"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Incremental (100 files)"}),(0,t.jsx)(n.td,{children:"100"}),(0,t.jsx)(n.td,{children:"30-60 sec"}),(0,t.jsx)(n.td,{children:"100"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Watch Mode (1 file)"}),(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:"<1 sec"}),(0,t.jsx)(n.td,{children:"1"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Optimization Strategies"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Batch Processing"}),": Group file changes into batches"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Parallel Embedding"}),": Generate embeddings concurrently"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Caching"}),": Cache embeddings for unchanged files"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Smart Filtering"}),": Skip generated files, vendor directories"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Rate Limiting"}),": Respect embedding API rate limits"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"storage-performance",children:"Storage Performance"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Backend"}),(0,t.jsx)(n.th,{children:"Index Size (10k files)"}),(0,t.jsx)(n.th,{children:"Query Latency"}),(0,t.jsx)(n.th,{children:"Best For"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Qdrant"}),(0,t.jsx)(n.td,{children:"500 MB"}),(0,t.jsx)(n.td,{children:"10-50ms"}),(0,t.jsx)(n.td,{children:"Production, multi-tenant"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"PostgreSQL + pgvector"}),(0,t.jsx)(n.td,{children:"800 MB"}),(0,t.jsx)(n.td,{children:"20-100ms"}),(0,t.jsx)(n.td,{children:"Unified storage"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"GOB (file-based)"}),(0,t.jsx)(n.td,{children:"400 MB"}),(0,t.jsx)(n.td,{children:"50-200ms"}),(0,t.jsx)(n.td,{children:"Dev/test, single-tenant"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"multi-branch-strategy",children:"Multi-Branch Strategy"}),"\n",(0,t.jsx)(n.h4,{id:"use-cases",children:"Use Cases"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Feature Branch Development"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Index main branch (stable reference)"}),"\n",(0,t.jsx)(n.li,{children:"Index feature branch (active development)"}),"\n",(0,t.jsx)(n.li,{children:"Switch between branches for context"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Code Review"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Index PR source branch"}),"\n",(0,t.jsx)(n.li,{children:"Index PR target branch"}),"\n",(0,t.jsx)(n.li,{children:"Compare call graphs, find breaking changes"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Multi-Version Support"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Index v1.x branch (maintenance)"}),"\n",(0,t.jsx)(n.li,{children:"Index v2.x branch (current)"}),"\n",(0,t.jsx)(n.li,{children:"Index v3.x branch (development)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"implementation",children:"Implementation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:'pub struct BranchManager {\n    repo_path: PathBuf,\n    current_branch: String,\n    indexed_branches: HashMap<String, IndexHandle>,\n}\n\nimpl BranchManager {\n    /// Switch to a different branch and update index\n    pub async fn checkout_branch(&mut self, branch: &str) -> Result<()> {\n        // Check if branch already indexed\n        if let Some(handle) = self.indexed_branches.get(branch) {\n            // Switch active index\n            self.activate_index(handle).await?;\n            return Ok(());\n        }\n        \n        // Git checkout\n        Command::new("git")\n            .args(&["checkout", branch])\n            .current_dir(&self.repo_path)\n            .output()?;\n        \n        // Check what changed from main branch\n        let changed_files = self.diff_from_main(branch)?;\n        \n        if changed_files.len() < 100 {\n            // Incremental index from main branch\n            self.incremental_index_from_main(branch, changed_files).await?;\n        } else {\n            // Full index for this branch\n            self.full_index(branch).await?;\n        }\n        \n        self.current_branch = branch.to_string();\n        Ok(())\n    }\n    \n    /// Clean up old branch indexes to save space\n    pub async fn prune_branches(&mut self, keep: Vec<String>) -> Result<()> {\n        for (branch, handle) in &self.indexed_branches {\n            if !keep.contains(branch) {\n                self.remove_index(handle).await?;\n            }\n        }\n        Ok(())\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"webhook-integration",children:"Webhook Integration"}),"\n",(0,t.jsx)(n.h4,{id:"github-webhooks",children:"GitHub Webhooks"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:'// API endpoint for GitHub webhooks\n#[post("/api/v1/codesearch/webhook/github")]\nasync fn github_webhook(\n    payload: web::Json<GitHubPayload>,\n    secret: web::Data<String>,\n) -> Result<HttpResponse> {\n    // Verify webhook signature\n    verify_github_signature(&payload, &secret)?;\n    \n    match payload.event {\n        "push" => {\n            // Extract repository and branch\n            let repo_name = payload.repository.full_name;\n            let branch = payload.ref_.trim_start_matches("refs/heads/");\n            \n            // Trigger incremental index\n            tokio::spawn(async move {\n                if let Some(repo) = find_repository(&repo_name).await {\n                    repo.incremental_update().await?;\n                }\n            });\n        }\n        "pull_request" => {\n            // Index PR branch on open/synchronize\n            if ["opened", "synchronize"].contains(&payload.action.as_str()) {\n                let branch = payload.pull_request.head.ref_;\n                // Index PR branch\n            }\n        }\n        _ => {}\n    }\n    \n    Ok(HttpResponse::Ok().finish())\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"cli-commands",children:"CLI Commands"}),"\n",(0,t.jsx)(n.h4,{id:"extended-repository-management",children:"Extended Repository Management"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Add a remote repository\naeterna codesearch repo add \\\n  --name company-backend \\\n  --url https://github.com/company/backend.git \\\n  --branches main,develop \\\n  --poll-interval 5m\n\n# List all tracked repositories\naeterna codesearch repo list\n# Output:\n# NAME              TYPE    STATUS    BRANCH    LAST INDEXED\n# company-backend   remote  ready     main      2m ago\n# my-local-project  local   ready     -         5s ago (watching)\n# aeterna           hybrid  ready     main      10m ago\n\n# Update a repository (pull + incremental index)\naeterna codesearch repo update company-backend\n# Output:\n# Pulling latest changes from main...\n# Found 15 changed files\n# Indexing incrementally...\n# \u2713 15 files indexed in 8.3s\n\n# Checkout a different branch\naeterna codesearch repo checkout company-backend develop\n# Output:\n# Checking out branch: develop\n# Calculating delta from main: 42 files changed\n# Indexing incrementally from main...\n# \u2713 Branch switched and indexed in 15.2s\n\n# Remove a repository\naeterna codesearch repo remove company-backend\n# Output:\n# Removing repository and index...\n# \u2713 Repository removed\n\n# Incremental index (manual trigger)\naeterna codesearch index --incremental\n# Auto-detect changed files in all local/hybrid repos\n# Output:\n# Scanning repositories...\n# Found 3 repositories with changes:\n#   - my-local-project: 2 files\n#   - aeterna: 5 files\n# Indexing 7 files...\n# \u2713 Completed in 3.1s\n\n# Force full re-index\naeterna codesearch index --full --repo company-backend\n# Warning: This will re-index all 10,247 files\n# Proceed? [y/N] y\n# Indexing...\n# \u2713 Completed in 42m 15s\n"})}),"\n",(0,t.jsx)(n.h3,{id:"configuration-examples",children:"Configuration Examples"}),"\n",(0,t.jsx)(n.h4,{id:"development-setup-local-only",children:"Development Setup (Local Only)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# values.yaml\ncodesearch:\n  enabled: true\n  \n  repositories:\n    - name: my-project\n      type: local\n      path: /workspace/my-project\n      indexing:\n        mode: watch\n        on_save: true\n  \n  embedder:\n    type: ollama\n    model: nomic-embed-text\n  \n  store:\n    type: gob  # Simple file-based for dev\n"})}),"\n",(0,t.jsx)(n.h4,{id:"team-setup-remote--incremental",children:"Team Setup (Remote + Incremental)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'# values.yaml\ncodesearch:\n  enabled: true\n  \n  repositories:\n    # Main backend repo\n    - name: backend\n      type: remote\n      url: https://github.com/company/backend.git\n      branches: [main, develop]\n      indexing:\n        mode: poll\n        interval: 5m\n      credentials:\n        secret: github-token\n    \n    # Frontend repo\n    - name: frontend\n      type: remote\n      url: https://github.com/company/frontend.git\n      branches: [main]\n      indexing:\n        mode: webhook  # GitHub webhook integration\n      credentials:\n        secret: github-token\n    \n    # Shared library\n    - name: shared-lib\n      type: remote\n      url: https://github.com/company/shared-lib.git\n      branches: ["v1.*", "v2.*"]\n      indexing:\n        mode: poll\n        interval: 30m  # Less frequent\n  \n  embedder:\n    type: openai\n    model: text-embedding-3-small\n  \n  store:\n    type: qdrant  # Production-grade\n  \n  # Webhook server for instant updates\n  webhook:\n    enabled: true\n    port: 9091\n    secret: webhook-secret\n'})}),"\n",(0,t.jsx)(n.h4,{id:"hybrid-setup-best-of-both-worlds",children:"Hybrid Setup (Best of Both Worlds)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# values.yaml\ncodesearch:\n  enabled: true\n  \n  repositories:\n    # Active development (local clone + remote sync)\n    - name: my-feature\n      type: hybrid\n      url: https://github.com/company/backend.git\n      local_path: /workspace/backend\n      branch: feature/my-feature\n      sync:\n        auto_pull: true\n        pull_interval: 10m\n        watch_local: true\n      credentials:\n        secret: github-token\n    \n    # Reference repos (remote only)\n    - name: main-backend\n      type: remote\n      url: https://github.com/company/backend.git\n      branches: [main]\n      indexing:\n        mode: poll\n        interval: 15m\n  \n  embedder:\n    type: ollama\n  \n  store:\n    type: qdrant\n"})}),"\n",(0,t.jsx)(n.h3,{id:"migration-path",children:"Migration Path"}),"\n",(0,t.jsx)(n.h4,{id:"from-standalone-code-search",children:"From Standalone Code Search"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Before"})," (Manual Code Search):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Manual setup\ncd /workspace/project\ncodesearch init --embedder ollama --store gob\n\n# Manual updates\ngit pull\ncodesearch init --force  # Full re-index :(\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"After"})," (Aeterna + Code Search):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# One-time setup\naeterna codesearch repo add \\\n  --name project \\\n  --type hybrid \\\n  --url https://github.com/org/project.git \\\n  --local-path /workspace/project\n\n# Automatic updates\n# - Git hooks trigger incremental index\n# - Or periodic polling\n# - Or webhook from GitHub\n\n# Manual update when needed\naeterna codesearch repo update project  # Incremental only!\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Benefits"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"10-100x faster updates (incremental vs full)"}),"\n",(0,t.jsx)(n.li,{children:"Automatic synchronization"}),"\n",(0,t.jsx)(n.li,{children:"Multi-repository support"}),"\n",(0,t.jsx)(n.li,{children:"Branch management"}),"\n",(0,t.jsx)(n.li,{children:"Tenant isolation"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Choose the Right Repository Type"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Local: Active development, low latency needed"}),"\n",(0,t.jsx)(n.li,{children:"Remote: Team repos, read-only access"}),"\n",(0,t.jsx)(n.li,{children:"Hybrid: Feature branches, need local changes + remote sync"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Optimize Indexing Frequency"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Local watch: Real-time (500ms debounce)"}),"\n",(0,t.jsx)(n.li,{children:"Hybrid poll: 10-15 minutes"}),"\n",(0,t.jsx)(n.li,{children:"Remote poll: 5-30 minutes (depends on activity)"}),"\n",(0,t.jsx)(n.li,{children:"Webhook: Instant (preferred for remote)"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Manage Branch Indexes"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Index main/develop permanently"}),"\n",(0,t.jsx)(n.li,{children:"Index feature branches on-demand"}),"\n",(0,t.jsx)(n.li,{children:"Prune old feature branch indexes"}),"\n",(0,t.jsx)(n.li,{children:"Keep last 5-10 branch indexes"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Monitor Resource Usage"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Embedding API quota (OpenAI: 3M tokens/min)"}),"\n",(0,t.jsx)(n.li,{children:"Storage space (500MB per 10k files)"}),"\n",(0,t.jsx)(n.li,{children:"CPU usage during indexing"}),"\n",(0,t.jsx)(n.li,{children:"Set appropriate rate limits"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Security"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Store git credentials in Kubernetes secrets"}),"\n",(0,t.jsx)(n.li,{children:"Use deploy keys (read-only) for remote repos"}),"\n",(0,t.jsx)(n.li,{children:"Enable RLS for multi-tenancy"}),"\n",(0,t.jsx)(n.li,{children:"Audit repository access"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h4,{id:"issue-incremental-index-missing-changes",children:"Issue: Incremental index missing changes"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Cause"}),": Git commit history not properly tracked\n",(0,t.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Check index metadata\naeterna codesearch repo status company-backend --verbose\n# Last indexed commit: abc123\n# Current commit: xyz789\n\n# Force re-sync\naeterna codesearch index --full --repo company-backend\n"})}),"\n",(0,t.jsx)(n.h4,{id:"issue-webhook-not-triggering",children:"Issue: Webhook not triggering"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Cause"}),": Webhook secret mismatch or network issue\n",(0,t.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Test webhook locally\ncurl -X POST http://localhost:9091/api/v1/codesearch/webhook/github \\\n  -H "X-Hub-Signature-256: sha256=..." \\\n  -d @webhook-payload.json\n\n# Check webhook logs\nkubectl logs -n aeterna <pod> -c codesearch --tail=100\n'})}),"\n",(0,t.jsx)(n.h4,{id:"issue-high-embedding-api-costs",children:"Issue: High embedding API costs"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Cause"}),": Full re-indexing too frequently\n",(0,t.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# Switch to incremental only\nrepositories:\n  - name: backend\n    indexing:\n      mode: poll\n      interval: 30m  # Increase interval\n      strategy: incremental  # Never full re-index\n"})}),"\n",(0,t.jsx)(n.h3,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Monorepo Support"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'Index subdirectories as separate "projects"'}),"\n",(0,t.jsx)(n.li,{children:"Shared root, independent indexes"}),"\n",(0,t.jsx)(n.li,{children:"Workspace-aware searching"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Multi-Language Optimization"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Language-specific parsing"}),"\n",(0,t.jsx)(n.li,{children:"Cross-language call graphs"}),"\n",(0,t.jsx)(n.li,{children:"Language-aware chunking"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Distributed Indexing"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Shard large repos across workers"}),"\n",(0,t.jsx)(n.li,{children:"Parallel embedding generation"}),"\n",(0,t.jsx)(n.li,{children:"Index merging"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"AI-Powered Index Optimization"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Learn frequently accessed files"}),"\n",(0,t.jsx)(n.li,{children:"Pre-index predicted files"}),"\n",(0,t.jsx)(n.li,{children:"Smart cache warming"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,t.jsx)(n.p,{children:"This repository management strategy provides:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Flexibility"}),": Local, remote, and hybrid support"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Performance"}),": 10-100x faster with incremental indexing"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Scale"}),": Multi-repository, multi-branch, multi-tenant"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Cost"}),": Proportional API costs (only index changes)"]}),"\n",(0,t.jsxs)(n.li,{children:["\u2705 ",(0,t.jsx)(n.strong,{children:"Developer Experience"}),": Automatic updates, minimal friction"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Implementation Priority"}),":"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Repository manager and database schema (1 week)"}),"\n",(0,t.jsx)(n.li,{children:"Incremental indexing engine (1 week)"}),"\n",(0,t.jsx)(n.li,{children:"CLI commands for repo management (3 days)"}),"\n",(0,t.jsx)(n.li,{children:"Webhook integration (3 days)"}),"\n",(0,t.jsx)(n.li,{children:"Multi-branch support (3 days)"}),"\n",(0,t.jsx)(n.li,{children:"Documentation and testing (3 days)"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Total Estimated Effort"}),": 3-4 weeks"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453(e,n,i){i.d(n,{R:()=>a,x:()=>l});var r=i(6540);const t={},s=r.createContext(t);function a(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);