"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[4347],{956(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>t});const l=JSON.parse('{"id":"helm/upgrade","title":"Upgrade Guide","description":"Standard Upgrade Procedure","source":"@site/docs/helm/upgrade.md","sourceDirName":"helm","slug":"/helm/upgrade","permalink":"/aeterna/docs/helm/upgrade","draft":false,"unlisted":false,"editUrl":"https://github.com/kikokikok/aeterna/tree/main/website/docs/helm/upgrade.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"SOPS Secrets Management","permalink":"/aeterna/docs/helm/sops-secrets"},"next":{"title":"CloudNativePG Upgrade Procedure","permalink":"/aeterna/docs/helm/cnpg-upgrade"}}');var a=r(4848),i=r(8453);const s={},d="Upgrade Guide",c={},t=[{value:"Standard Upgrade Procedure",id:"standard-upgrade-procedure",level:2},{value:"Pre-Upgrade Checks",id:"pre-upgrade-checks",level:3},{value:"Upgrade Steps",id:"upgrade-steps",level:3},{value:"Post-Upgrade Verification",id:"post-upgrade-verification",level:3},{value:"Version Migration Notes",id:"version-migration-notes",level:2},{value:"0.1.x \u2192 0.2.x (placeholder)",id:"01x--02x-placeholder",level:3},{value:"Values Schema Changes",id:"values-schema-changes",level:3},{value:"Subchart Upgrades",id:"subchart-upgrades",level:2},{value:"CloudNativePG (PostgreSQL)",id:"cloudnativepg-postgresql",level:3},{value:"Qdrant",id:"qdrant",level:3},{value:"Dragonfly",id:"dragonfly",level:3},{value:"OPAL Stack",id:"opal-stack",level:3},{value:"Rollback Procedure",id:"rollback-procedure",level:2},{value:"Quick Rollback",id:"quick-rollback",level:3},{value:"When Rollback Fails",id:"when-rollback-fails",level:3},{value:"Rollback Limitations",id:"rollback-limitations",level:3},{value:"Blue-Green Upgrade Strategy",id:"blue-green-upgrade-strategy",level:2},{value:"Canary Upgrade Strategy",id:"canary-upgrade-strategy",level:2},{value:"Emergency Procedures",id:"emergency-procedures",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"upgrade-guide",children:"Upgrade Guide"})}),"\n",(0,a.jsx)(n.h2,{id:"standard-upgrade-procedure",children:"Standard Upgrade Procedure"}),"\n",(0,a.jsx)(n.h3,{id:"pre-upgrade-checks",children:"Pre-Upgrade Checks"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Check current release: ",(0,a.jsx)(n.code,{children:"helm list -n aeterna"})]}),"\n",(0,a.jsx)(n.li,{children:"Review changelog for breaking changes"}),"\n",(0,a.jsxs)(n.li,{children:["Compare values: ",(0,a.jsx)(n.code,{children:"helm get values aeterna -n aeterna > current-values.yaml"})]}),"\n",(0,a.jsx)(n.li,{children:"Back up database before upgrade"}),"\n",(0,a.jsx)(n.li,{children:"Check cluster resources for new requirements"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"upgrade-steps",children:"Upgrade Steps"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Update repo\nhelm repo update\n\n# Review changes (dry-run)\nhelm upgrade aeterna aeterna/aeterna -f values.yaml --dry-run --debug\n\n# Perform upgrade\nhelm upgrade aeterna aeterna/aeterna -f values.yaml\n\n# Verify\nkubectl rollout status deployment/aeterna -n aeterna\nhelm test aeterna -n aeterna\n"})}),"\n",(0,a.jsx)(n.h3,{id:"post-upgrade-verification",children:"Post-Upgrade Verification"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Check all pods running"}),"\n",(0,a.jsx)(n.li,{children:"Verify health endpoints"}),"\n",(0,a.jsx)(n.li,{children:"Check metrics flowing"}),"\n",(0,a.jsx)(n.li,{children:"Test memory operations"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"version-migration-notes",children:"Version Migration Notes"}),"\n",(0,a.jsx)(n.h3,{id:"01x--02x-placeholder",children:"0.1.x \u2192 0.2.x (placeholder)"}),"\n",(0,a.jsx)(n.p,{children:"Document the pattern for future migration notes:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Breaking changes"}),"\n",(0,a.jsx)(n.li,{children:"New required values"}),"\n",(0,a.jsx)(n.li,{children:"Deprecated values"}),"\n",(0,a.jsx)(n.li,{children:"Migration steps"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"values-schema-changes",children:"Values Schema Changes"}),"\n",(0,a.jsx)(n.p,{children:"How to diff values schemas between versions."}),"\n",(0,a.jsx)(n.h2,{id:"subchart-upgrades",children:"Subchart Upgrades"}),"\n",(0,a.jsx)(n.h3,{id:"cloudnativepg-postgresql",children:"CloudNativePG (PostgreSQL)"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Check cnpg operator compatibility"}),"\n",(0,a.jsx)(n.li,{children:"Review PostgreSQL version changes"}),"\n",(0,a.jsx)(n.li,{children:"Backup before upgrade"}),"\n",(0,a.jsx)(n.li,{children:"Monitor replication status"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"qdrant",children:"Qdrant"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Check API compatibility"}),"\n",(0,a.jsx)(n.li,{children:"Review storage format changes"}),"\n",(0,a.jsx)(n.li,{children:"Snapshot before upgrade"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"dragonfly",children:"Dragonfly"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Check Redis protocol compatibility"}),"\n",(0,a.jsx)(n.li,{children:"Review memory behavior changes"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"opal-stack",children:"OPAL Stack"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Check policy format compatibility"}),"\n",(0,a.jsx)(n.li,{children:"Review Cedar schema changes"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"rollback-procedure",children:"Rollback Procedure"}),"\n",(0,a.jsx)(n.h3,{id:"quick-rollback",children:"Quick Rollback"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# View history\nhelm history aeterna -n aeterna\n\n# Rollback to previous\nhelm rollback aeterna -n aeterna\n\n# Rollback to specific revision\nhelm rollback aeterna 3 -n aeterna\n"})}),"\n",(0,a.jsx)(n.h3,{id:"when-rollback-fails",children:"When Rollback Fails"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Manual pod restart"}),"\n",(0,a.jsx)(n.li,{children:"PVC recovery"}),"\n",(0,a.jsx)(n.li,{children:"Database rollback considerations (migrations are NOT automatically reversed)"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"rollback-limitations",children:"Rollback Limitations"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Database migrations are forward-only"}),"\n",(0,a.jsx)(n.li,{children:"PVC data may have been modified"}),"\n",(0,a.jsx)(n.li,{children:"External service configurations won't rollback"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"blue-green-upgrade-strategy",children:"Blue-Green Upgrade Strategy"}),"\n",(0,a.jsx)(n.p,{children:"For zero-downtime upgrades:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Deploy new release to separate namespace"}),"\n",(0,a.jsx)(n.li,{children:"Run smoke tests"}),"\n",(0,a.jsx)(n.li,{children:"Switch ingress"}),"\n",(0,a.jsx)(n.li,{children:"Decommission old release"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"canary-upgrade-strategy",children:"Canary Upgrade Strategy"}),"\n",(0,a.jsx)(n.p,{children:"Using Argo Rollouts or Flagger (brief overview)."}),"\n",(0,a.jsx)(n.h2,{id:"emergency-procedures",children:"Emergency Procedures"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"How to quickly disable a broken component"}),"\n",(0,a.jsx)(n.li,{children:"How to scale down to minimum"}),"\n",(0,a.jsx)(n.li,{children:"How to switch from bundled to external services"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},8453(e,n,r){r.d(n,{R:()=>s,x:()=>d});var l=r(6540);const a={},i=l.createContext(a);function s(e){const n=l.useContext(i);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),l.createElement(i.Provider,{value:n},e.children)}}}]);