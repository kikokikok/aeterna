"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[9201],{7766(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"guides/ha-deployment","title":"High Availability Deployment Guide","description":"Overview","source":"@site/docs/guides/ha-deployment.md","sourceDirName":"guides","slug":"/guides/ha-deployment","permalink":"/aeterna/docs/guides/ha-deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/kikokikok/aeterna/tree/main/website/docs/guides/ha-deployment.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Chart Versioning Strategy","permalink":"/aeterna/docs/helm/chart-versioning"},"next":{"title":"Disaster Recovery Runbook","permalink":"/aeterna/docs/guides/disaster-recovery-runbook"}}');var s=r(4848),t=r(8453);const l={},d="High Availability Deployment Guide",c={},a=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Component Configuration",id:"component-configuration",level:2},{value:"1. PostgreSQL with Patroni",id:"1-postgresql-with-patroni",level:3},{value:"2. Qdrant Cluster",id:"2-qdrant-cluster",level:3},{value:"3. Redis Sentinel",id:"3-redis-sentinel",level:3},{value:"Deployment Order",id:"deployment-order",level:2},{value:"Health Check Commands",id:"health-check-commands",level:2},{value:"PostgreSQL (Patroni)",id:"postgresql-patroni",level:3},{value:"Qdrant Cluster",id:"qdrant-cluster",level:3},{value:"Redis Sentinel",id:"redis-sentinel",level:3},{value:"Common Issues &amp; Resolution",id:"common-issues--resolution",level:2},{value:"Health Check Endpoint Summary",id:"health-check-endpoint-summary",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"high-availability-deployment-guide",children:"High Availability Deployment Guide"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"This guide describes the configuration and deployment of the Aeterna High Availability (HA) infrastructure. To achieve 99.9% availability, Aeterna uses a multi-node storage architecture with automated failover for all critical data stores."}),"\n",(0,s.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(n.p,{children:"The HA setup consists of the following components:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"PostgreSQL"}),": Managed by ",(0,s.jsx)(n.strong,{children:"Patroni"})," for automated failover and streaming replication."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Qdrant"}),": Native ",(0,s.jsx)(n.strong,{children:"Cluster Mode"})," with multiple nodes and replication factor of 2."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Redis"}),": ",(0,s.jsx)(n.strong,{children:"Sentinel"})," mode for monitoring, notification, and automatic failover."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Load Balancing"}),": Multi-AZ load balancer distributing traffic across service replicas."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Kubernetes cluster with at least 3 nodes across multiple Availability Zones (AZs)."}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"kubectl"})," and ",(0,s.jsx)(n.code,{children:"helm"})," installed and configured."]}),"\n",(0,s.jsxs)(n.li,{children:["Access to the ",(0,s.jsx)(n.code,{children:"infrastructure/ha/"})," directory in the Aeterna repository."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"component-configuration",children:"Component Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"1-postgresql-with-patroni",children:"1. PostgreSQL with Patroni"}),"\n",(0,s.jsxs)(n.p,{children:["Patroni manages the PostgreSQL cluster using ",(0,s.jsx)(n.code,{children:"etcd"})," or ",(0,s.jsx)(n.code,{children:"Consul"})," for leader election."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File"}),": ",(0,s.jsx)(n.code,{children:"infrastructure/ha/patroni/patroni.yml"})]}),"\n",(0,s.jsx)(n.p,{children:"The configuration ensures:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Automated primary election."}),"\n",(0,s.jsx)(n.li,{children:"Synchronous or asynchronous replication."}),"\n",(0,s.jsx)(n.li,{children:"Health check endpoints for load balancers."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Deployment Command"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"helm install patroni-postgresql ./charts/patroni -f infrastructure/ha/patroni/patroni.yml\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-qdrant-cluster",children:"2. Qdrant Cluster"}),"\n",(0,s.jsx)(n.p,{children:"Qdrant cluster mode provides horizontal scaling and redundancy for vector embeddings."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File"}),": ",(0,s.jsx)(n.code,{children:"infrastructure/ha/qdrant/qdrant-cluster.yaml"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Key Settings"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"replication_factor: 2"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"shard_number: 3"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"consensus_enabled: true"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Deployment Command"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f infrastructure/ha/qdrant/qdrant-cluster.yaml\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-redis-sentinel",children:"3. Redis Sentinel"}),"\n",(0,s.jsx)(n.p,{children:"Redis Sentinel provides high availability for the caching layer."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"File"}),": ",(0,s.jsx)(n.code,{children:"infrastructure/ha/redis/redis-sentinel.yaml"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configuration"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"3 Redis instances (1 Master, 2 Replicas)."}),"\n",(0,s.jsx)(n.li,{children:"3 Sentinel instances for quorum-based failover."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Deployment Command"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f infrastructure/ha/redis/redis-sentinel.yaml\n"})}),"\n",(0,s.jsx)(n.h2,{id:"deployment-order",children:"Deployment Order"}),"\n",(0,s.jsx)(n.p,{children:"To ensure a smooth startup, deploy components in the following order:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Infrastructure Foundation"}),": etcd/Consul (if used by Patroni)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Storage Layer"}),":\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PostgreSQL (Patroni)"}),"\n",(0,s.jsx)(n.li,{children:"Redis (Sentinel)"}),"\n",(0,s.jsx)(n.li,{children:"Qdrant (Cluster)"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Aeterna Services"}),":\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Memory Service"}),"\n",(0,s.jsx)(n.li,{children:"Knowledge Service"}),"\n",(0,s.jsx)(n.li,{children:"Governance Service"}),"\n",(0,s.jsx)(n.li,{children:"Sync Bridge"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"health-check-commands",children:"Health Check Commands"}),"\n",(0,s.jsx)(n.p,{children:"Verify the health of the HA components using these commands:"}),"\n",(0,s.jsx)(n.h3,{id:"postgresql-patroni",children:"PostgreSQL (Patroni)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# List cluster members and status\nkubectl exec -it patroni-postgresql-0 -- patronictl list\n"})}),"\n",(0,s.jsx)(n.h3,{id:"qdrant-cluster",children:"Qdrant Cluster"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Check cluster status via API\ncurl http://qdrant-cluster:6333/cluster\n"})}),"\n",(0,s.jsx)(n.h3,{id:"redis-sentinel",children:"Redis Sentinel"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Query sentinel for master status\nkubectl exec -it redis-sentinel-0 -- redis-cli -p 26379 sentinel master mymaster\n"})}),"\n",(0,s.jsx)(n.h2,{id:"common-issues--resolution",children:"Common Issues & Resolution"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Issue"}),(0,s.jsx)(n.th,{children:"Symptom"}),(0,s.jsx)(n.th,{children:"Resolution"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Patroni split-brain"}),(0,s.jsx)(n.td,{children:"Multiple masters reported"}),(0,s.jsx)(n.td,{children:"Check etcd/Consul connectivity; restart minority nodes."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Qdrant read-only"}),(0,s.jsx)(n.td,{children:'Shards in "Red" state'}),(0,s.jsx)(n.td,{children:"Verify node connectivity; check disk space on vector nodes."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Redis failover delay"}),(0,s.jsx)(n.td,{children:"Sentinels cannot reach quorum"}),(0,s.jsx)(n.td,{children:"Ensure at least 2 Sentinels are running and can communicate."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"High replication lag"}),(0,s.jsx)(n.td,{children:"Stale data on reads"}),(0,s.jsx)(n.td,{children:"Check network throughput between AZs; optimize write heavy workloads."})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"health-check-endpoint-summary",children:"Health Check Endpoint Summary"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Service"}),(0,s.jsx)(n.th,{children:"Port"}),(0,s.jsx)(n.th,{children:"Endpoint"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Patroni (Leader)"}),(0,s.jsx)(n.td,{children:"8008"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/primary"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Patroni (Replica)"}),(0,s.jsx)(n.td,{children:"8008"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/replica"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Qdrant"}),(0,s.jsx)(n.td,{children:"6333"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/healthz"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Aeterna Services"}),(0,s.jsx)(n.td,{children:"9090"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/health"})})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453(e,n,r){r.d(n,{R:()=>l,x:()=>d});var i=r(6540);const s={},t=i.createContext(s);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);