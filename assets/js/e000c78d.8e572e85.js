"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[5874],{2738(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"guides/managed-observability","title":"Managed Observability Platform Integration","description":"Overview","source":"@site/docs/guides/managed-observability.md","sourceDirName":"guides","slug":"/guides/managed-observability","permalink":"/aeterna/docs/guides/managed-observability","draft":false,"unlisted":false,"editUrl":"https://github.com/kikokikok/aeterna/tree/main/website/docs/guides/managed-observability.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Observability Runbook","permalink":"/aeterna/docs/guides/observability-runbook"},"next":{"title":"Cost Optimization Guide","permalink":"/aeterna/docs/guides/cost-optimization"}}');var s=t(4848),a=t(8453);const i={},d="Managed Observability Platform Integration",l={},o=[{value:"Overview",id:"overview",level:2},{value:"Decision",id:"decision",level:2},{value:"Grafana Cloud Setup",id:"grafana-cloud-setup",level:2},{value:"1. Create Grafana Cloud Account",id:"1-create-grafana-cloud-account",level:3},{value:"2. Obtain Credentials",id:"2-obtain-credentials",level:3},{value:"3. Deploy OpenTelemetry Collector",id:"3-deploy-opentelemetry-collector",level:3},{value:"4. Import Dashboards",id:"4-import-dashboards",level:3},{value:"5. Configure SLO Dashboards",id:"5-configure-slo-dashboards",level:3},{value:"SLO Dashboard Panels",id:"slo-dashboard-panels",level:4},{value:"6. Set Up Alerting",id:"6-set-up-alerting",level:3},{value:"Datadog Setup (Enterprise)",id:"datadog-setup-enterprise",level:2},{value:"1. Install Datadog Agent",id:"1-install-datadog-agent",level:3},{value:"2. Configure OpenTelemetry Export to Datadog",id:"2-configure-opentelemetry-export-to-datadog",level:3},{value:"3. Enable Datadog APM",id:"3-enable-datadog-apm",level:3},{value:"Migrating Existing Metrics",id:"migrating-existing-metrics",level:2},{value:"Cost Estimates",id:"cost-estimates",level:2}];function c(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"managed-observability-platform-integration",children:"Managed Observability Platform Integration"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["Aeterna supports two managed observability platforms: ",(0,s.jsx)(n.strong,{children:"Grafana Cloud"})," (default) and ",(0,s.jsx)(n.strong,{children:"Datadog"})," (enterprise option). Both integrate with the existing OpenTelemetry pipeline."]}),"\n",(0,s.jsx)(n.h2,{id:"decision",children:"Decision"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Default"}),": Grafana Cloud \u2014 80% of Datadog features at ~20% of the cost.",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Enterprise option"}),": Datadog \u2014 best-in-class UX, advanced APM, higher cost."]}),"\n",(0,s.jsx)(n.h2,{id:"grafana-cloud-setup",children:"Grafana Cloud Setup"}),"\n",(0,s.jsx)(n.h3,{id:"1-create-grafana-cloud-account",children:"1. Create Grafana Cloud Account"}),"\n",(0,s.jsxs)(n.p,{children:["Sign up at ",(0,s.jsx)(n.a,{href:"https://grafana.com/products/cloud/",children:"https://grafana.com/products/cloud/"})," (free tier: 50GB logs, 10k series)."]}),"\n",(0,s.jsx)(n.h3,{id:"2-obtain-credentials",children:"2. Obtain Credentials"}),"\n",(0,s.jsx)(n.p,{children:"From Grafana Cloud portal \u2192 API Keys:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Prometheus remote_write"})," endpoint + API key"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Loki"})," endpoint + API key"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Tempo"})," (traces) endpoint + API key"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-deploy-opentelemetry-collector",children:"3. Deploy OpenTelemetry Collector"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'# deploy/k8s/observability/otel-collector.yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: otel-collector-config\n  namespace: aeterna\ndata:\n  otel-collector-config.yaml: |\n    receivers:\n      otlp:\n        protocols:\n          grpc:\n            endpoint: 0.0.0.0:4317\n          http:\n            endpoint: 0.0.0.0:4318\n      prometheus:\n        config:\n          scrape_configs:\n            - job_name: aeterna-memory\n              static_configs:\n                - targets: [aeterna-memory:9091]\n            - job_name: aeterna-knowledge\n              static_configs:\n                - targets: [aeterna-knowledge:9092]\n            - job_name: aeterna-governance\n              static_configs:\n                - targets: [aeterna-governance:9093]\n            - job_name: aeterna-sync\n              static_configs:\n                - targets: [aeterna-sync:9094]\n\n    processors:\n      batch:\n        timeout: 10s\n        send_batch_size: 1000\n      memory_limiter:\n        limit_mib: 512\n\n    exporters:\n      prometheusremotewrite:\n        endpoint: https://prometheus-prod-XX.grafana.net/api/prom/push\n        headers:\n          Authorization: "Basic ${GRAFANA_PROMETHEUS_TOKEN}"\n      loki:\n        endpoint: https://logs-prod-XXX.grafana.net/loki/api/v1/push\n        headers:\n          Authorization: "Basic ${GRAFANA_LOKI_TOKEN}"\n      otlp/tempo:\n        endpoint: https://tempo-prod-XX.grafana.net:443\n        headers:\n          Authorization: "Basic ${GRAFANA_TEMPO_TOKEN}"\n        tls:\n          insecure: false\n\n    service:\n      pipelines:\n        metrics:\n          receivers: [otlp, prometheus]\n          processors: [memory_limiter, batch]\n          exporters: [prometheusremotewrite]\n        logs:\n          receivers: [otlp]\n          processors: [memory_limiter, batch]\n          exporters: [loki]\n        traces:\n          receivers: [otlp]\n          processors: [memory_limiter, batch]\n          exporters: [otlp/tempo]\n'})}),"\n",(0,s.jsx)(n.h3,{id:"4-import-dashboards",children:"4. Import Dashboards"}),"\n",(0,s.jsxs)(n.p,{children:["Upload all 5 Grafana dashboard JSON files from ",(0,s.jsx)(n.code,{children:"deploy/grafana/dashboards/"})," to Grafana Cloud:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"system-health.json"})," \u2014 System health overview"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"memory-operations.json"})," \u2014 Memory read/write operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"knowledge-queries.json"})," \u2014 Knowledge query performance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"governance-compliance.json"})," \u2014 Policy evaluations and violations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"cost-analysis.json"})," \u2014 Per-tenant cost and budget tracking"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Import method"}),": Grafana UI \u2192 Dashboards \u2192 Import \u2192 Upload JSON"]}),"\n",(0,s.jsx)(n.h3,{id:"5-configure-slo-dashboards",children:"5. Configure SLO Dashboards"}),"\n",(0,s.jsx)(n.p,{children:"In Grafana Cloud \u2192 SLO tab, create the core SLOs:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"SLO"}),(0,s.jsx)(n.th,{children:"Target"}),(0,s.jsx)(n.th,{children:"Window"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Memory API P99 < 200ms"}),(0,s.jsx)(n.td,{children:"99.9%"}),(0,s.jsx)(n.td,{children:"30d"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Knowledge API P99 < 500ms"}),(0,s.jsx)(n.td,{children:"99.5%"}),(0,s.jsx)(n.td,{children:"30d"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Service availability"}),(0,s.jsx)(n.td,{children:"99.9%"}),(0,s.jsx)(n.td,{children:"30d"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Error rate < 1%"}),(0,s.jsx)(n.td,{children:"99%"}),(0,s.jsx)(n.td,{children:"7d"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"slo-dashboard-panels",children:"SLO Dashboard Panels"}),"\n",(0,s.jsxs)(n.p,{children:["Create a dedicated SLO dashboard (import ",(0,s.jsx)(n.code,{children:"deploy/grafana/dashboards/slo-overview.json"})," or build manually) with these panels:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Error Budget Burn Rate"})}),"\n",(0,s.jsx)(n.p,{children:"Track how quickly each SLO consumes its error budget. A burn rate > 1.0 means the budget is depleting faster than the window allows."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-promql",children:'# 1-hour burn rate for memory API latency SLO\n1 - (\n  sum(rate(aeterna_memory_api_duration_seconds_bucket{le="0.2"}[1h]))\n  /\n  sum(rate(aeterna_memory_api_duration_seconds_count[1h]))\n) / (1 - 0.999)\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Multi-Window Burn Rate Alerts"})}),"\n",(0,s.jsx)(n.p,{children:"Configure alerts using the multi-window, multi-burn-rate method recommended by Google SRE:"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Severity"}),(0,s.jsx)(n.th,{children:"Long Window"}),(0,s.jsx)(n.th,{children:"Short Window"}),(0,s.jsx)(n.th,{children:"Burn Rate"}),(0,s.jsx)(n.th,{children:"Budget Consumed"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Critical (page)"}),(0,s.jsx)(n.td,{children:"1h"}),(0,s.jsx)(n.td,{children:"5m"}),(0,s.jsx)(n.td,{children:"14.4\xd7"}),(0,s.jsx)(n.td,{children:"2% in 1h"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Warning (ticket)"}),(0,s.jsx)(n.td,{children:"6h"}),(0,s.jsx)(n.td,{children:"30m"}),(0,s.jsx)(n.td,{children:"6\xd7"}),(0,s.jsx)(n.td,{children:"5% in 6h"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Info (log)"}),(0,s.jsx)(n.td,{children:"3d"}),(0,s.jsx)(n.td,{children:"6h"}),(0,s.jsx)(n.td,{children:"1\xd7"}),(0,s.jsx)(n.td,{children:"10% in 3d"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Per-Service SLO Panel"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Panel"}),(0,s.jsx)(n.th,{children:"PromQL"}),(0,s.jsx)(n.th,{children:"Visualization"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Memory API latency SLO"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"histogram_quantile(0.99, sum(rate(aeterna_memory_api_duration_seconds_bucket[5m])) by (le))"})}),(0,s.jsx)(n.td,{children:"Gauge (green < 200ms)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Knowledge API latency SLO"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"histogram_quantile(0.99, sum(rate(aeterna_knowledge_api_duration_seconds_bucket[5m])) by (le))"})}),(0,s.jsx)(n.td,{children:"Gauge (green < 500ms)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Availability (success rate)"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'sum(rate(aeterna_http_requests_total{status!~"5.."}[5m])) / sum(rate(aeterna_http_requests_total[5m]))'})}),(0,s.jsx)(n.td,{children:"Stat (target: 99.9%)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Error budget remaining"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"1 - (error_ratio / (1 - slo_target))"})}),(0,s.jsx)(n.td,{children:"Time series (30d)"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Tenant-Level SLO Tracking"})}),"\n",(0,s.jsxs)(n.p,{children:["For multi-tenant deployments, add a variable ",(0,s.jsx)(n.code,{children:"$tenant_id"})," and filter all SLO queries:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-promql",children:'# Per-tenant availability\nsum(rate(aeterna_http_requests_total{status!~"5..", tenant_id="$tenant_id"}[5m]))\n/\nsum(rate(aeterna_http_requests_total{tenant_id="$tenant_id"}[5m]))\n'})}),"\n",(0,s.jsx)(n.p,{children:"This enables per-tenant SLA reporting and identifies tenants experiencing degraded service before aggregate SLOs breach."}),"\n",(0,s.jsx)(n.h3,{id:"6-set-up-alerting",children:"6. Set Up Alerting"}),"\n",(0,s.jsx)(n.p,{children:"In Grafana Cloud \u2192 Alerting \u2192 Contact Points, configure:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Slack webhook for warnings"}),"\n",(0,s.jsx)(n.li,{children:"PagerDuty for critical alerts"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Alert rules to create (import from ",(0,s.jsx)(n.code,{children:"deploy/grafana/alerts/"}),"):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"memory_error_rate_high"})," \u2014 Error rate > 5% for 5 minutes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"budget_exceeded"})," \u2014 Tenant budget > 100%"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"service_down"})," \u2014 ",(0,s.jsx)(n.code,{children:"up == 0"})," for 2 minutes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"p99_latency_high"})," \u2014 P99 > 2s for 10 minutes"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"datadog-setup-enterprise",children:"Datadog Setup (Enterprise)"}),"\n",(0,s.jsx)(n.h3,{id:"1-install-datadog-agent",children:"1. Install Datadog Agent"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"helm repo add datadog https://helm.datadoghq.com\nhelm install datadog-agent datadog/datadog \\\n  --set datadog.apiKey=<DD_API_KEY> \\\n  --set datadog.apm.portEnabled=true \\\n  --set datadog.logs.enabled=true \\\n  --set clusterAgent.enabled=true\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-configure-opentelemetry-export-to-datadog",children:"2. Configure OpenTelemetry Export to Datadog"}),"\n",(0,s.jsxs)(n.p,{children:["Add to the OTel Collector config under ",(0,s.jsx)(n.code,{children:"exporters"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"datadog:\n  api:\n    key: ${DD_API_KEY}\n    site: datadoghq.com\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-enable-datadog-apm",children:"3. Enable Datadog APM"}),"\n",(0,s.jsx)(n.p,{children:"Aeterna services emit OTLP traces. Configure:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# In aeterna config\ntracing:\n  exporter: datadog\n  agent_host: datadog-agent.default.svc:4317\n"})}),"\n",(0,s.jsx)(n.h2,{id:"migrating-existing-metrics",children:"Migrating Existing Metrics"}),"\n",(0,s.jsxs)(n.p,{children:["All Aeterna metrics follow ",(0,s.jsx)(n.code,{children:"aeterna_*"})," naming convention and are already emitted via the ",(0,s.jsx)(n.code,{children:"observability"})," crate. No migration steps required \u2014 metrics flow through OTel Collector automatically once the collector is deployed."]}),"\n",(0,s.jsx)(n.h2,{id:"cost-estimates",children:"Cost Estimates"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Platform"}),(0,s.jsx)(n.th,{children:"Scale"}),(0,s.jsx)(n.th,{children:"Monthly Cost"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Grafana Cloud Free"}),(0,s.jsx)(n.td,{children:"< 10k series"}),(0,s.jsx)(n.td,{children:"$0"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Grafana Cloud Pro"}),(0,s.jsx)(n.td,{children:"< 100k series"}),(0,s.jsx)(n.td,{children:"~$50-200"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Grafana Cloud Advanced"}),(0,s.jsx)(n.td,{children:"> 100k series"}),(0,s.jsx)(n.td,{children:"~$500+"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Datadog"}),(0,s.jsx)(n.td,{children:"Per host"}),(0,s.jsx)(n.td,{children:"$23-34/host/mo"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453(e,n,t){t.d(n,{R:()=>i,x:()=>d});var r=t(6540);const s={},a=r.createContext(s);function i(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);