"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[68],{2334(e,n,r){r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"examples/policies/architecture-constraints","title":"Architecture Constraints Policies","description":"Enforce architectural decisions and design patterns across your organization.","source":"@site/docs/examples/policies/architecture-constraints.md","sourceDirName":"examples/policies","slug":"/examples/policies/architecture-constraints","permalink":"/aeterna/docs/examples/policies/architecture-constraints","draft":false,"unlisted":false,"editUrl":"https://github.com/kikokikok/aeterna/tree/main/website/docs/examples/policies/architecture-constraints.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Code Quality Policies","permalink":"/aeterna/docs/examples/policies/code-quality"},"next":{"title":"Dependency Management Policies","permalink":"/aeterna/docs/examples/policies/dependency-management"}}');var i=r(4848),t=r(8453);const a={},c="Architecture Constraints Policies",o={},l=[{value:"1. Require Strangler Facade",id:"1-require-strangler-facade",level:2},{value:"2. No Direct Database Access",id:"2-no-direct-database-access",level:2},{value:"3. Require API Versioning",id:"3-require-api-versioning",level:2},{value:"4. No Circular Dependencies",id:"4-no-circular-dependencies",level:2},{value:"5. Require Interface Segregation",id:"5-require-interface-segregation",level:2},{value:"6. Require Error Boundaries",id:"6-require-error-boundaries",level:2},{value:"7. Max Function Length",id:"7-max-function-length",level:2},{value:"8. Require Typed Errors",id:"8-require-typed-errors",level:2},{value:"Implementation Checklist",id:"implementation-checklist",level:2},{value:"Related Policies",id:"related-policies",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"architecture-constraints-policies",children:"Architecture Constraints Policies"})}),"\n",(0,i.jsx)(n.p,{children:"Enforce architectural decisions and design patterns across your organization."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"1-require-strangler-facade",children:"1. Require Strangler Facade"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Natural Language"}),': "All legacy system integrations must use the Strangler Facade pattern"']}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cedar Policy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cedar",children:'// Policy: require-strangler-facade\n// Scope: org (Platform Engineering)\n// Severity: block\n// Reference: ADR-001\n\nforbid(\n  principal,\n  action == Action::"Commit",\n  resource\n)\nwhen {\n  resource.project.tags.contains("legacy-migration") &&\n  resource.imports_from.any(import =>\n    import.source.matches("legacy-.*") &&\n    !import.through_facade == true\n  )\n};\n\n// Require facade registration for new integrations\nforbid(\n  principal,\n  action == Action::"CreateIntegration",\n  resource\n)\nwhen {\n  resource.target.type == "legacy" &&\n  !resource.facade_registered == true\n}\nadvice {\n  message: "Register facade in services/facades/ before integrating with legacy system"\n};\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Explanation"}),":\nThe Strangler Facade pattern enables gradual migration from legacy systems by creating a facade that routes requests to either the old or new implementation. This prevents direct coupling to legacy code."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use Cases"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Legacy modernization"}),"\n",(0,i.jsx)(n.li,{children:"Platform migrations"}),"\n",(0,i.jsx)(n.li,{children:"Risk reduction during rewrites"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Pattern Diagram"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Client    \u2502\u2500\u2500\u2500\u2500\u25ba\u2502 Strangler Facade \u2502\u2500\u2500\u2500\u2500\u25ba\u2502 New Service  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502                 \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502  Routing Logic  \u2502\n                    \u2502                 \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502                 \u2502\u2500\u2500\u2500\u2500\u25ba\u2502Legacy System \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Customization"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cedar",children:'// Allow direct legacy access for monitoring/debugging tools\npermit(\n  principal,\n  action == Action::"Commit",\n  resource\n)\nwhen {\n  resource.path.matches("tools/(monitoring|debugging)/.*") &&\n  resource.imports_from.all(import =>\n    import.purpose == "read-only"\n  )\n};\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-no-direct-database-access",children:"2. No Direct Database Access"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Natural Language"}),': "Services must use the repository pattern - no direct SQL queries in controllers"']}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cedar Policy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cedar",children:'// Policy: no-direct-db-access\n// Scope: org\n// Severity: error\n\nforbid(\n  principal,\n  action == Action::"Commit",\n  resource\n)\nwhen {\n  // Controller/handler files with direct DB imports\n  resource.path.matches(".*(controller|handler|route|endpoint|resolver).*\\\\.(ts|js|rs)$") &&\n  (\n    resource.content.matches("import.*from\\\\s*[\'\\"]pg[\'\\"]") ||\n    resource.content.matches("import.*from\\\\s*[\'\\"]mysql") ||\n    resource.content.matches("use\\\\s+sqlx::") ||\n    resource.content.matches("import.*from\\\\s*[\'\\"]@prisma/client[\'\\"]")\n  )\n}\nadvice {\n  message: "Use repository pattern. Import from \'../repositories/\' instead of direct DB access."\n};\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Explanation"}),":\nThe repository pattern provides an abstraction layer between business logic and data access. This enables easier testing, database changes, and separation of concerns."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use Cases"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Clean architecture"}),"\n",(0,i.jsx)(n.li,{children:"Testability improvement"}),"\n",(0,i.jsx)(n.li,{children:"Database abstraction"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Correct Structure"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"src/\n\u251c\u2500\u2500 controllers/      # HTTP handling only\n\u2502   \u2514\u2500\u2500 user.controller.ts\n\u251c\u2500\u2500 services/         # Business logic\n\u2502   \u2514\u2500\u2500 user.service.ts\n\u251c\u2500\u2500 repositories/     # Data access\n\u2502   \u2514\u2500\u2500 user.repository.ts\n\u2514\u2500\u2500 entities/         # Domain models\n    \u2514\u2500\u2500 user.entity.ts\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// \u274c Bad: Direct DB in controller\nclass UserController {\n  async getUser(id: string) {\n    return await prisma.user.findUnique({ where: { id } });\n  }\n}\n\n// \u2705 Good: Repository pattern\nclass UserController {\n  constructor(private userRepo: UserRepository) {}\n  \n  async getUser(id: string) {\n    return await this.userRepo.findById(id);\n  }\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"3-require-api-versioning",children:"3. Require API Versioning"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Natural Language"}),': "All public APIs must include version in the URL path"']}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cedar Policy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cedar",children:'// Policy: require-api-versioning\n// Scope: company\n// Severity: block\n\nforbid(\n  principal,\n  action == Action::"Deploy",\n  resource\n)\nwhen {\n  resource.type == "api" &&\n  resource.visibility == "public" &&\n  !resource.endpoints.all(endpoint =>\n    endpoint.path.matches("^/v[0-9]+/.*")\n  )\n};\n\n// Require version documentation\nforbid(\n  principal,\n  action == Action::"Deploy",\n  resource\n)\nwhen {\n  resource.type == "api" &&\n  resource.visibility == "public" &&\n  !resource.files.contains("API_VERSIONING.md")\n}\nadvice {\n  message: "Document API versioning strategy in API_VERSIONING.md"\n};\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Explanation"}),":\nAPI versioning prevents breaking changes from affecting clients. URL-based versioning (v1, v2) is explicit and cache-friendly."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use Cases"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"API stability"}),"\n",(0,i.jsx)(n.li,{children:"Client compatibility"}),"\n",(0,i.jsx)(n.li,{children:"Gradual deprecation"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Versioning Strategies"}),":"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Strategy"}),(0,i.jsx)(n.th,{children:"Example"}),(0,i.jsx)(n.th,{children:"Pros"}),(0,i.jsx)(n.th,{children:"Cons"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"URL Path"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/v1/users"})}),(0,i.jsx)(n.td,{children:"Clear, cacheable"}),(0,i.jsx)(n.td,{children:"URL changes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Header"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Accept: application/vnd.api+json;version=1"})}),(0,i.jsx)(n.td,{children:"Clean URLs"}),(0,i.jsx)(n.td,{children:"Hidden"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Query"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/users?version=1"})}),(0,i.jsx)(n.td,{children:"Simple"}),(0,i.jsx)(n.td,{children:"Caching issues"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Recommended: URL Path"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# openapi.yaml\nservers:\n  - url: https://api.company.com/v1\n    description: Version 1 (current)\n  - url: https://api.company.com/v2\n    description: Version 2 (beta)\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"4-no-circular-dependencies",children:"4. No Circular Dependencies"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Natural Language"}),': "Prevent circular imports between modules"']}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cedar Policy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cedar",children:'// Policy: no-circular-dependencies\n// Scope: org\n// Severity: error\n\nforbid(\n  principal,\n  action == Action::"Commit",\n  resource\n)\nwhen {\n  resource.module_graph.has_cycles == true\n}\nadvice {\n  message: "Circular dependency detected: {resource.module_graph.cycle_path}"\n};\n\n// Also check at package level\nforbid(\n  principal,\n  action == Action::"Commit",\n  resource\n)\nwhen {\n  resource.file == "package.json" &&\n  resource.workspace_deps.has_cycles == true\n};\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Explanation"}),":\nCircular dependencies create tight coupling, make testing difficult, and can cause runtime issues. They often indicate architectural problems."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use Cases"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Code maintainability"}),"\n",(0,i.jsx)(n.li,{children:"Build performance"}),"\n",(0,i.jsx)(n.li,{children:"Clear module boundaries"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Detection Tools"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# TypeScript/JavaScript\nnpx madge --circular src/\n\n# Rust\ncargo +nightly udeps --all\n\n# Python\npydeps --show-cycles src/\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Resolution Patterns"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Problem: A imports B, B imports A\n// file: a.ts\nimport { B } from './b'  // B needs A!\n\n// Solution 1: Extract shared code\n// file: shared.ts\nexport interface SharedType { ... }\n\n// Solution 2: Dependency injection\n// file: a.ts\nclass A {\n  constructor(private b: BInterface) {}\n}\n\n// Solution 3: Event-based communication\n// file: a.ts\neventBus.emit('a:completed', data)\n// file: b.ts\neventBus.on('a:completed', handler)\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"5-require-interface-segregation",children:"5. Require Interface Segregation"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Natural Language"}),': "Interfaces should be small and focused - no god interfaces"']}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cedar Policy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cedar",children:'// Policy: require-interface-segregation\n// Scope: team\n// Severity: warn\n\nforbid(\n  principal,\n  action == Action::"Commit",\n  resource\n)\nwhen {\n  resource.interfaces.any(iface =>\n    iface.method_count > 7\n  )\n}\nadvice {\n  message: "Interface has too many methods ({count}). Split into smaller, focused interfaces."\n};\n\n// Also check trait implementations in Rust\nforbid(\n  principal,\n  action == Action::"Commit",\n  resource\n)\nwhen {\n  resource.path.matches(".*\\\\.rs$") &&\n  resource.traits.any(trait =>\n    trait.method_count > 10 &&\n    !trait.name.matches(".*Builder$")  // Builders are OK\n  )\n};\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Explanation"}),":\nThe Interface Segregation Principle (ISP) states that clients shouldn't depend on interfaces they don't use. Large interfaces force unnecessary dependencies."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use Cases"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"SOLID principles"}),"\n",(0,i.jsx)(n.li,{children:"Reduced coupling"}),"\n",(0,i.jsx)(n.li,{children:"Better testability"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// \u274c Bad: God interface\ninterface UserService {\n  getUser(id: string): User\n  createUser(data: UserData): User\n  updateUser(id: string, data: UserData): User\n  deleteUser(id: string): void\n  sendEmail(userId: string, email: Email): void\n  resetPassword(userId: string): void\n  generateReport(userId: string): Report\n  importUsers(file: File): User[]\n  exportUsers(): File\n  validateUser(data: UserData): ValidationResult\n}\n\n// \u2705 Good: Segregated interfaces\ninterface UserReader {\n  getUser(id: string): User\n}\n\ninterface UserWriter {\n  createUser(data: UserData): User\n  updateUser(id: string, data: UserData): User\n  deleteUser(id: string): void\n}\n\ninterface UserNotifier {\n  sendEmail(userId: string, email: Email): void\n  resetPassword(userId: string): void\n}\n\ninterface UserBulkOperations {\n  importUsers(file: File): User[]\n  exportUsers(): File\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"6-require-error-boundaries",children:"6. Require Error Boundaries"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Natural Language"}),': "React components must be wrapped in error boundaries at route level"']}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cedar Policy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cedar",children:'// Policy: require-error-boundaries\n// Scope: team (Frontend)\n// Severity: warn\n\nforbid(\n  principal,\n  action == Action::"Commit",\n  resource\n)\nwhen {\n  resource.path.matches(".*/pages/.*\\\\.(tsx|jsx)$") &&\n  !resource.content.matches("ErrorBoundary")\n}\nadvice {\n  message: "Page components should be wrapped in ErrorBoundary. See: docs/frontend/error-handling.md"\n};\n\n// Require ErrorBoundary component exists\nforbid(\n  principal,\n  action == Action::"Deploy",\n  resource\n)\nwhen {\n  resource.type == "frontend" &&\n  !resource.files.any(f => f.matches(".*ErrorBoundary.*\\\\.(tsx|jsx)$"))\n};\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Explanation"}),":\nError boundaries catch JavaScript errors in React component trees, preventing entire app crashes. They're essential for production stability."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use Cases"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Production stability"}),"\n",(0,i.jsx)(n.li,{children:"Graceful degradation"}),"\n",(0,i.jsx)(n.li,{children:"Error reporting"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Implementation"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:'// components/ErrorBoundary.tsx\nclass ErrorBoundary extends React.Component<Props, State> {\n  static getDerivedStateFromError(error: Error) {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    // Log to monitoring service\n    errorReporter.captureException(error, { extra: errorInfo });\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return <ErrorFallback error={this.state.error} />;\n    }\n    return this.props.children;\n  }\n}\n\n// Usage in routes\n<Route path="/dashboard">\n  <ErrorBoundary fallback={<DashboardError />}>\n    <Dashboard />\n  </ErrorBoundary>\n</Route>\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"7-max-function-length",children:"7. Max Function Length"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Natural Language"}),': "Functions should not exceed 50 lines - extract helper functions for complex logic"']}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cedar Policy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cedar",children:'// Policy: max-function-length\n// Scope: team\n// Severity: warn\n\nforbid(\n  principal,\n  action == Action::"Commit",\n  resource\n)\nwhen {\n  resource.functions.any(fn =>\n    fn.line_count > 50 &&\n    !fn.name.matches(".*test.*|.*spec.*")  // Exclude tests\n  )\n}\nadvice {\n  message: "Function \'{fn.name}\' is {fn.line_count} lines. Consider extracting helper functions."\n};\n\n// Stricter for controllers/handlers\nforbid(\n  principal,\n  action == Action::"Commit",\n  resource\n)\nwhen {\n  resource.path.matches(".*(controller|handler).*") &&\n  resource.functions.any(fn => fn.line_count > 30)\n};\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Explanation"}),":\nLong functions are hard to understand, test, and maintain. They often violate single responsibility and can hide bugs."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use Cases"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Code readability"}),"\n",(0,i.jsx)(n.li,{children:"Maintainability"}),"\n",(0,i.jsx)(n.li,{children:"Testability"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Refactoring Strategies"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// \u274c Bad: 80-line function\nasync function processOrder(order: Order) {\n  // Validate order (15 lines)\n  // Calculate totals (20 lines)\n  // Apply discounts (15 lines)\n  // Process payment (20 lines)\n  // Send notifications (10 lines)\n}\n\n// \u2705 Good: Extracted functions\nasync function processOrder(order: Order) {\n  const validated = await validateOrder(order);\n  const totals = calculateTotals(validated);\n  const discounted = applyDiscounts(totals);\n  const payment = await processPayment(discounted);\n  await sendNotifications(payment);\n  return payment;\n}\n\n// Each helper is focused and testable\nfunction calculateTotals(order: ValidatedOrder): OrderTotals {\n  // 15 focused lines\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"8-require-typed-errors",children:"8. Require Typed Errors"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Natural Language"}),': "Use Result types with typed errors, not panics or thrown exceptions"']}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cedar Policy"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cedar",children:'// Policy: require-typed-errors\n// Scope: org (Platform Engineering)\n// Severity: error\n\n// Rust: No unwrap in production code\nforbid(\n  principal,\n  action == Action::"Commit",\n  resource\n)\nwhen {\n  resource.path.matches(".*\\\\.rs$") &&\n  !resource.path.matches(".*(test|spec|mock).*") &&\n  resource.content.matches("\\\\.unwrap\\\\(\\\\)") &&\n  !resource.content.matches("// SAFETY:")  // Allow documented unwraps\n};\n\n// Rust: No panic! macro\nforbid(\n  principal,\n  action == Action::"Commit",\n  resource\n)\nwhen {\n  resource.path.matches(".*\\\\.rs$") &&\n  !resource.path.matches(".*(test|spec).*") &&\n  resource.content.matches("panic!\\\\(")\n};\n\n// TypeScript: Require error types\nforbid(\n  principal,\n  action == Action::"Commit",\n  resource\n)\nwhen {\n  resource.path.matches(".*\\\\.ts$") &&\n  resource.content.matches("throw\\\\s+new\\\\s+Error\\\\(") &&\n  !resource.content.matches("throw\\\\s+new\\\\s+[A-Z][a-zA-Z]+Error\\\\(")\n}\nadvice {\n  message: "Use typed error classes instead of generic Error. See: src/errors/"\n};\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Explanation"}),":\nTyped errors enable exhaustive error handling, better tooling support, and clearer contracts. They make error recovery explicit and predictable."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Use Cases"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Error handling"}),"\n",(0,i.jsx)(n.li,{children:"API reliability"}),"\n",(0,i.jsx)(n.li,{children:"Debugging"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Rust Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'// \u274c Bad: Panics and unwraps\nfn process(input: &str) -> Output {\n    let parsed = input.parse::<i32>().unwrap();  // Panic on invalid!\n    if parsed < 0 {\n        panic!("Negative not allowed");\n    }\n    Output { value: parsed }\n}\n\n// \u2705 Good: Typed Result errors\n#[derive(Debug, thiserror::Error)]\nenum ProcessError {\n    #[error("Invalid input: {0}")]\n    ParseError(#[from] std::num::ParseIntError),\n    \n    #[error("Value must be non-negative, got {0}")]\n    NegativeValue(i32),\n}\n\nfn process(input: &str) -> Result<Output, ProcessError> {\n    let parsed = input.parse::<i32>()?;\n    if parsed < 0 {\n        return Err(ProcessError::NegativeValue(parsed));\n    }\n    Ok(Output { value: parsed })\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"TypeScript Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// \u274c Bad: Generic errors\nthrow new Error('User not found');\n\n// \u2705 Good: Typed errors\nclass UserNotFoundError extends Error {\n  constructor(public userId: string) {\n    super(`User not found: ${userId}`);\n    this.name = 'UserNotFoundError';\n  }\n}\n\n// Usage enables exhaustive handling\ntry {\n  await getUser(id);\n} catch (e) {\n  if (e instanceof UserNotFoundError) {\n    return res.status(404).json({ error: e.message });\n  }\n  if (e instanceof UnauthorizedError) {\n    return res.status(401).json({ error: e.message });\n  }\n  throw e;  // Re-throw unknown errors\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"implementation-checklist",children:"Implementation Checklist"}),"\n",(0,i.jsx)(n.p,{children:"To implement architecture constraints:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Document architectural decisions"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'$ aeterna knowledge add adr \\\n    --id ADR-001 \\\n    --title "Strangler Facade for Legacy Migration" \\\n    --decision "All legacy integrations must use strangler facade"\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Create pattern examples"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ mkdir -p docs/patterns\n$ # Create example implementations for each pattern\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Deploy as warnings"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ aeterna policy import architecture-constraints.md \\\n    --scope org \\\n    --severity warn\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Train team on patterns"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Schedule architecture review sessions"}),"\n",(0,i.jsx)(n.li,{children:"Create migration guides for existing code"}),"\n",(0,i.jsx)(n.li,{children:"Document exceptions process"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Gradually enforce"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# After 30 days\n$ aeterna policy update require-strangler-facade --severity error\n\n# After 60 days\n$ aeterna policy update require-strangler-facade --severity block\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"related-policies",children:"Related Policies"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/aeterna/docs/examples/policies/security-baseline",children:"Security Baseline"})," - Core security policies"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/aeterna/docs/examples/policies/dependency-management",children:"Dependency Management"})," - Control packages"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/aeterna/docs/examples/policies/code-quality",children:"Code Quality"})," - Maintain standards"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/aeterna/docs/examples/policies/team-conventions",children:"Team Conventions"})," - Team-specific rules"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>a,x:()=>c});var s=r(6540);const i={},t=s.createContext(i);function a(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);