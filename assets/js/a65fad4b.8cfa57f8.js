"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[6422],{1536(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"guides/provider-adapters","title":"Provider Adapters Guide","description":"Overview","source":"@site/docs/guides/provider-adapters.md","sourceDirName":"guides","slug":"/guides/provider-adapters","permalink":"/aeterna/docs/guides/provider-adapters","draft":false,"unlisted":false,"editUrl":"https://github.com/kikokikok/aeterna/tree/main/website/docs/guides/provider-adapters.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"OpenCode Integration Guide","permalink":"/aeterna/docs/integrations/opencode-integration"},"next":{"title":"Code Search Integration Guide","permalink":"/aeterna/docs/codesearch-integration"}}');var s=t(4848),d=t(8453);const i={},c="Provider Adapters Guide",a={},l=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"The <code>VectorBackend</code> Trait",id:"the-vectorbackend-trait",level:2},{value:"Key Types",id:"key-types",level:3},{value:"Tenant Isolation Contract",id:"tenant-isolation-contract",level:3},{value:"Step-by-Step: Adding a New Provider",id:"step-by-step-adding-a-new-provider",level:2},{value:"Step 1: Add the Feature Flag",id:"step-1-add-the-feature-flag",level:3},{value:"Step 2: Create the Backend Module",id:"step-2-create-the-backend-module",level:3},{value:"Step 3: Add Configuration",id:"step-3-add-configuration",level:3},{value:"Step 4: Register the Module",id:"step-4-register-the-module",level:3},{value:"Step 5: Write an Integration Test Stub",id:"step-5-write-an-integration-test-stub",level:3},{value:"Step 6: Update Documentation",id:"step-6-update-documentation",level:3},{value:"New Provider Checklist",id:"new-provider-checklist",level:2},{value:"Switching Providers at Runtime",id:"switching-providers-at-runtime",level:2},{value:"Observability for All Backends",id:"observability-for-all-backends",level:2},{value:"Existing Backends Reference",id:"existing-backends-reference",level:2}];function o(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"provider-adapters-guide",children:"Provider Adapters Guide"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["Aeterna uses a ",(0,s.jsx)(n.strong,{children:"pluggable backend architecture"})," built around the ",(0,s.jsx)(n.code,{children:"VectorBackend"})," trait. Every vector database \u2014 self-hosted or managed \u2014 implements the same trait, allowing you to switch providers by changing a single environment variable."]}),"\n",(0,s.jsx)(n.p,{children:"This guide explains how the adapter system works and how to add a new provider."}),"\n",(0,s.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                  \u2502         MemoryManager            \u2502\n                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                 \u2502\n                                 \u25bc\n                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                  \u2502   InstrumentedBackend (wrapper)   \u2502\n                  \u2502   \u2022 Metrics emission              \u2502\n                  \u2502   \u2022 Circuit breaker               \u2502\n                  \u2502   \u2022 Latency tracking              \u2502\n                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                 \u2502\n                                 \u25bc\n                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                  \u2502   dyn VectorBackend (trait obj)   \u2502\n                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                  \u25bc                                  \u25bc\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502  QdrantBackend  \u2502                \u2502 PineconeBackend \u2502  ...\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsxs)(n.p,{children:["All backends are created through the ",(0,s.jsx)(n.code,{children:"create_backend()"})," factory function in ",(0,s.jsx)(n.code,{children:"memory/src/backends/factory.rs"}),", which reads configuration and returns an ",(0,s.jsx)(n.code,{children:"Arc<dyn VectorBackend>"}),". The ",(0,s.jsx)(n.code,{children:"InstrumentedBackend"})," wrapper (in ",(0,s.jsx)(n.code,{children:"observability.rs"}),") adds metrics and a circuit breaker around any backend transparently."]}),"\n",(0,s.jsxs)(n.h2,{id:"the-vectorbackend-trait",children:["The ",(0,s.jsx)(n.code,{children:"VectorBackend"})," Trait"]}),"\n",(0,s.jsxs)(n.p,{children:["Located at ",(0,s.jsx)(n.code,{children:"memory/src/backends/mod.rs"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'#[async_trait]\npub trait VectorBackend: Send + Sync {\n    /// Health check \u2014 returns status and optional latency.\n    async fn health_check(&self) -> Result<HealthStatus, BackendError>;\n\n    /// Advertised capabilities (max dimensions, hybrid search, etc.).\n    async fn capabilities(&self) -> BackendCapabilities;\n\n    /// Insert or update vectors, scoped to a tenant.\n    async fn upsert(\n        &self,\n        tenant_id: &str,\n        vectors: Vec<VectorRecord>,\n    ) -> Result<UpsertResult, BackendError>;\n\n    /// Semantic search, scoped to a tenant.\n    async fn search(\n        &self,\n        tenant_id: &str,\n        query: SearchQuery,\n    ) -> Result<Vec<SearchResult>, BackendError>;\n\n    /// Delete vectors by ID, scoped to a tenant.\n    async fn delete(\n        &self,\n        tenant_id: &str,\n        ids: Vec<String>,\n    ) -> Result<DeleteResult, BackendError>;\n\n    /// Retrieve a single vector by ID.\n    async fn get(\n        &self,\n        tenant_id: &str,\n        id: &str,\n    ) -> Result<Option<VectorRecord>, BackendError>;\n\n    /// Human-readable backend name (e.g., "qdrant", "pinecone").\n    fn backend_name(&self) -> &\'static str;\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"key-types",children:"Key Types"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Location"}),(0,s.jsx)(n.th,{children:"Purpose"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"VectorRecord"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"types.rs"})}),(0,s.jsx)(n.td,{children:"ID + embedding vector + metadata hashmap"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SearchQuery"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"types.rs"})}),(0,s.jsx)(n.td,{children:"Vector + limit + score threshold + filters"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SearchResult"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"types.rs"})}),(0,s.jsx)(n.td,{children:"ID + score + optional vector + metadata"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"UpsertResult"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"types.rs"})}),(0,s.jsx)(n.td,{children:"Count of upserted records + any failed IDs"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"DeleteResult"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"types.rs"})}),(0,s.jsx)(n.td,{children:"Count of deleted records"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"HealthStatus"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"types.rs"})}),(0,s.jsx)(n.td,{children:"Healthy/unhealthy flag + latency + message"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"BackendCapabilities"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"types.rs"})}),(0,s.jsx)(n.td,{children:"Feature flags (hybrid search, namespaces, max dims, etc.)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"BackendError"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"error.rs"})}),(0,s.jsxs)(n.td,{children:["Typed errors with ",(0,s.jsx)(n.code,{children:"is_retryable()"})," and ",(0,s.jsx)(n.code,{children:"retry_after_ms()"})]})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"tenant-isolation-contract",children:"Tenant Isolation Contract"}),"\n",(0,s.jsxs)(n.p,{children:["Every mutating and query method takes ",(0,s.jsx)(n.code,{children:"tenant_id: &str"})," as its first argument. The backend implementation is responsible for enforcing isolation. Strategies vary by provider:"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Backend"}),(0,s.jsx)(n.th,{children:"Isolation Strategy"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Qdrant"}),(0,s.jsxs)(n.td,{children:["Collection per tenant (",(0,s.jsx)(n.code,{children:"{prefix}_{tenant_id}"}),")"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Pinecone"}),(0,s.jsx)(n.td,{children:"Namespace per tenant"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"pgvector"}),(0,s.jsxs)(n.td,{children:["Row-level filter on ",(0,s.jsx)(n.code,{children:"tenant_id"})," column"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Weaviate"}),(0,s.jsx)(n.td,{children:"Tenant key in multi-tenancy class"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"MongoDB"}),(0,s.jsx)(n.td,{children:"Collection-level or filter-level isolation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Vertex AI"}),(0,s.jsx)(n.td,{children:"Metadata restricts filter"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Databricks"}),(0,s.jsx)(n.td,{children:"Unity Catalog schema per tenant"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"step-by-step-adding-a-new-provider",children:"Step-by-Step: Adding a New Provider"}),"\n",(0,s.jsx)(n.p,{children:'This walkthrough uses a hypothetical "Milvus" backend as an example.'}),"\n",(0,s.jsx)(n.h3,{id:"step-1-add-the-feature-flag",children:"Step 1: Add the Feature Flag"}),"\n",(0,s.jsxs)(n.p,{children:["Edit ",(0,s.jsx)(n.code,{children:"memory/Cargo.toml"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:'[features]\ndefault = []\npinecone = ["dep:reqwest"]\npgvector = ["dep:sqlx"]\nweaviate = ["dep:reqwest"]\nmongodb = ["dep:mongodb"]\nmilvus = ["dep:tonic"]  # \u2190 add your feature\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Add the dependency itself under ",(0,s.jsx)(n.code,{children:"[dependencies]"})," with ",(0,s.jsx)(n.code,{children:"optional = true"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:'[dependencies]\ntonic = { version = "0.12", optional = true }\n'})}),"\n",(0,s.jsx)(n.h3,{id:"step-2-create-the-backend-module",children:"Step 2: Create the Backend Module"}),"\n",(0,s.jsxs)(n.p,{children:["Create ",(0,s.jsx)(n.code,{children:"memory/src/backends/milvus.rs"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'use super::factory::MilvusConfig;\nuse super::{\n    BackendCapabilities, BackendError, DeleteResult, HealthStatus,\n    SearchQuery, SearchResult, UpsertResult, VectorBackend, VectorRecord,\n};\nuse async_trait::async_trait;\n\npub struct MilvusBackend {\n    // Client handle, config, etc.\n    config: MilvusConfig,\n}\n\nimpl MilvusBackend {\n    pub async fn new(config: MilvusConfig) -> Result<Self, BackendError> {\n        // Initialize client connection\n        Ok(Self { config })\n    }\n}\n\n#[async_trait]\nimpl VectorBackend for MilvusBackend {\n    async fn health_check(&self) -> Result<HealthStatus, BackendError> {\n        // Ping the Milvus server\n        Ok(HealthStatus::healthy("milvus"))\n    }\n\n    async fn capabilities(&self) -> BackendCapabilities {\n        BackendCapabilities {\n            max_vector_dimensions: 32768,\n            supports_metadata_filter: true,\n            supports_hybrid_search: true,\n            supports_batch_upsert: true,\n            supports_namespaces: false,\n            distance_metrics: vec![\n                DistanceMetric::Cosine,\n                DistanceMetric::Euclidean,\n            ],\n            max_batch_size: 1000,\n            supports_delete_by_filter: true,\n        }\n    }\n\n    async fn upsert(\n        &self,\n        tenant_id: &str,\n        vectors: Vec<VectorRecord>,\n    ) -> Result<UpsertResult, BackendError> {\n        // Ensure collection exists for tenant\n        // Map VectorRecord \u2192 Milvus insert request\n        // Return UpsertResult::success(count)\n        todo!()\n    }\n\n    async fn search(\n        &self,\n        tenant_id: &str,\n        query: SearchQuery,\n    ) -> Result<Vec<SearchResult>, BackendError> {\n        // Build Milvus search request from SearchQuery\n        // Apply tenant isolation filter\n        // Map Milvus results \u2192 Vec<SearchResult>\n        todo!()\n    }\n\n    async fn delete(\n        &self,\n        tenant_id: &str,\n        ids: Vec<String>,\n    ) -> Result<DeleteResult, BackendError> {\n        // Delete by IDs within tenant scope\n        todo!()\n    }\n\n    async fn get(\n        &self,\n        tenant_id: &str,\n        id: &str,\n    ) -> Result<Option<VectorRecord>, BackendError> {\n        // Fetch single record by ID within tenant scope\n        todo!()\n    }\n\n    fn backend_name(&self) -> &\'static str {\n        "milvus"\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"step-3-add-configuration",children:"Step 3: Add Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["In ",(0,s.jsx)(n.code,{children:"memory/src/backends/factory.rs"}),", add the config struct and update ",(0,s.jsx)(n.code,{children:"BackendConfig"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'#[derive(Debug, Clone, Deserialize)]\npub struct MilvusConfig {\n    pub endpoint: String,\n    pub token: Option<String>,\n    pub database: String,\n}\n\nimpl MilvusConfig {\n    pub fn from_env() -> Result<Self, BackendError> {\n        Ok(Self {\n            endpoint: std::env::var("MILVUS_ENDPOINT")\n                .map_err(|_| BackendError::Configuration(\n                    "MILVUS_ENDPOINT not set".into()\n                ))?,\n            token: std::env::var("MILVUS_TOKEN").ok(),\n            database: std::env::var("MILVUS_DATABASE")\n                .unwrap_or_else(|_| "aeterna".to_string()),\n        })\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Add the variant to ",(0,s.jsx)(n.code,{children:"VectorBackendType"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"pub enum VectorBackendType {\n    // ... existing variants ...\n    Milvus,\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Update ",(0,s.jsx)(n.code,{children:"FromStr"}),", ",(0,s.jsx)(n.code,{children:"Display"}),", and the ",(0,s.jsx)(n.code,{children:"create_backend()"})," match arm following the same pattern as existing backends."]}),"\n",(0,s.jsx)(n.h3,{id:"step-4-register-the-module",children:"Step 4: Register the Module"}),"\n",(0,s.jsxs)(n.p,{children:["In ",(0,s.jsx)(n.code,{children:"memory/src/backends/mod.rs"}),", add the conditional module declaration:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'#[cfg(feature = "milvus")]\npub mod milvus;\n'})}),"\n",(0,s.jsx)(n.h3,{id:"step-5-write-an-integration-test-stub",children:"Step 5: Write an Integration Test Stub"}),"\n",(0,s.jsxs)(n.p,{children:["Create ",(0,s.jsx)(n.code,{children:"memory/tests/milvus_integration_test.rs"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:'//! Integration tests for Milvus backend.\n//! Requires a running Milvus instance.\n//! Run with: cargo test --features milvus -- --ignored\n\n#[cfg(feature = "milvus")]\nmod milvus_tests {\n    use memory::backends::*;\n\n    #[tokio::test]\n    #[ignore] // Requires live Milvus instance\n    async fn test_milvus_health_check() {\n        let config = BackendConfig::from_env().unwrap();\n        let backend = create_backend(config).await.unwrap();\n        let health = backend.health_check().await.unwrap();\n        assert!(health.healthy);\n        assert_eq!(health.backend, "milvus");\n    }\n\n    #[tokio::test]\n    #[ignore]\n    async fn test_milvus_upsert_and_search() {\n        let config = BackendConfig::from_env().unwrap();\n        let backend = create_backend(config).await.unwrap();\n\n        let records = vec![VectorRecord::new(\n            "test-1",\n            vec![0.1; 1536],\n            Default::default(),\n        )];\n\n        let result = backend.upsert("test-tenant", records).await.unwrap();\n        assert_eq!(result.upserted_count, 1);\n\n        let query = SearchQuery::new(vec![0.1; 1536]).with_limit(5);\n        let results = backend.search("test-tenant", query).await.unwrap();\n        assert!(!results.is_empty());\n    }\n\n    #[tokio::test]\n    #[ignore]\n    async fn test_milvus_tenant_isolation() {\n        let config = BackendConfig::from_env().unwrap();\n        let backend = create_backend(config).await.unwrap();\n\n        // Upsert to tenant-a\n        let records = vec![VectorRecord::new(\n            "isolated-1",\n            vec![0.5; 1536],\n            Default::default(),\n        )];\n        backend.upsert("tenant-a", records).await.unwrap();\n\n        // Search in tenant-b should not find it\n        let query = SearchQuery::new(vec![0.5; 1536]).with_limit(10);\n        let results = backend.search("tenant-b", query).await.unwrap();\n        let found = results.iter().any(|r| r.id == "isolated-1");\n        assert!(!found, "tenant-b must not see tenant-a records");\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"step-6-update-documentation",children:"Step 6: Update Documentation"}),"\n",(0,s.jsxs)(n.p,{children:["Add the new backend to the comparison table in ",(0,s.jsx)(n.code,{children:"memory/src/backends/mod.rs"})," doc comments and update ",(0,s.jsx)(n.code,{children:"docs/guides/managed-services-evaluation.md"})," if the provider has a managed offering."]}),"\n",(0,s.jsx)(n.h2,{id:"new-provider-checklist",children:"New Provider Checklist"}),"\n",(0,s.jsx)(n.p,{children:"Use this checklist when adding any new vector backend:"}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:"Feature flag"})," added in ",(0,s.jsx)(n.code,{children:"memory/Cargo.toml"})," with optional dependency"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:"Config struct"})," created in ",(0,s.jsx)(n.code,{children:"factory.rs"})," with ",(0,s.jsx)(n.code,{children:"from_env()"})," method"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsxs)(n.strong,{children:[(0,s.jsx)(n.code,{children:"VectorBackendType"})," variant"]})," added with ",(0,s.jsx)(n.code,{children:"FromStr"}),", ",(0,s.jsx)(n.code,{children:"Display"}),", and ",(0,s.jsx)(n.code,{children:"create_backend()"})," match arm"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:"Backend module"})," created (e.g., ",(0,s.jsx)(n.code,{children:"milvus.rs"}),") implementing all 7 ",(0,s.jsx)(n.code,{children:"VectorBackend"})," methods"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:"Tenant isolation"})," enforced in all methods (upsert, search, delete, get)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"BackendCapabilities"})})," returned accurately (max dims, hybrid search support, etc.)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:"Error mapping"})," from provider SDK errors to ",(0,s.jsx)(n.code,{children:"BackendError"})," variants"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:"Module registered"})," in ",(0,s.jsx)(n.code,{children:"mod.rs"})," behind ",(0,s.jsx)(n.code,{children:'#[cfg(feature = "...")]'})]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:"Integration test stub"})," created (marked ",(0,s.jsx)(n.code,{children:"#[ignore]"})," for CI)"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:"Tenant isolation test"})," verifying cross-tenant data cannot leak"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:"Health check test"})," verifying connectivity reporting"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,s.jsx)(n.strong,{children:"Doc comments"})," added to the backend struct and module"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"switching-providers-at-runtime",children:"Switching Providers at Runtime"}),"\n",(0,s.jsxs)(n.p,{children:["Aeterna selects the backend at startup based on the ",(0,s.jsx)(n.code,{children:"VECTOR_BACKEND"})," environment variable:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Switch from self-hosted Qdrant to Qdrant Cloud\nexport VECTOR_BACKEND=qdrant\nexport QDRANT_URL=https://xyz-abc.us-east4-0.gcp.cloud.qdrant.io:6333\nexport QDRANT_API_KEY=your-cloud-api-key\n\n# Switch from Qdrant to Pinecone\nexport VECTOR_BACKEND=pinecone\nexport PINECONE_API_KEY=your-api-key\nexport PINECONE_ENVIRONMENT=us-east-1-aws\nexport PINECONE_INDEX_NAME=aeterna-memories\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"InstrumentedBackend"})," wrapper is applied automatically by ",(0,s.jsx)(n.code,{children:"wrap_with_instrumentation()"}),", so all backends get metrics, circuit breaker protection, and latency tracking without additional configuration."]}),"\n",(0,s.jsx)(n.h2,{id:"observability-for-all-backends",children:"Observability for All Backends"}),"\n",(0,s.jsxs)(n.p,{children:["Every backend, regardless of provider, emits the following Prometheus metrics through the ",(0,s.jsx)(n.code,{children:"InstrumentedBackend"})," wrapper:"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Metric"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Labels"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"vector_backend_operation_duration_seconds"})}),(0,s.jsx)(n.td,{children:"Histogram"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"backend"}),", ",(0,s.jsx)(n.code,{children:"operation"}),", ",(0,s.jsx)(n.code,{children:"tenant_id"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"vector_backend_operations_total"})}),(0,s.jsx)(n.td,{children:"Counter"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"backend"}),", ",(0,s.jsx)(n.code,{children:"operation"}),", ",(0,s.jsx)(n.code,{children:"status"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"vector_backend_errors_total"})}),(0,s.jsx)(n.td,{children:"Counter"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"backend"}),", ",(0,s.jsx)(n.code,{children:"error_type"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"vector_backend_circuit_breaker_rejected_total"})}),(0,s.jsx)(n.td,{children:"Counter"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"backend"})})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"The circuit breaker defaults to opening after 5 consecutive failures and resetting after 30 seconds. Configure with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"let instrumented = InstrumentedBackend::new(backend)\n    .with_circuit_breaker(10, 60); // 10 failures, 60s reset\n"})}),"\n",(0,s.jsx)(n.h2,{id:"existing-backends-reference",children:"Existing Backends Reference"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Backend"}),(0,s.jsx)(n.th,{children:"File"}),(0,s.jsx)(n.th,{children:"Feature Flag"}),(0,s.jsx)(n.th,{children:"Isolation"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Qdrant"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"qdrant.rs"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.em,{children:"(always compiled)"})}),(0,s.jsx)(n.td,{children:"Collection per tenant"}),(0,s.jsx)(n.td,{children:"Default backend"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Pinecone"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"pinecone.rs"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"pinecone"})}),(0,s.jsx)(n.td,{children:"Namespace per tenant"}),(0,s.jsx)(n.td,{children:"Serverless"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"pgvector"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"pgvector.rs"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"pgvector"})}),(0,s.jsx)(n.td,{children:"Row-level filter"}),(0,s.jsx)(n.td,{children:"Requires PostgreSQL 16+"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Weaviate"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"weaviate.rs"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"weaviate"})}),(0,s.jsx)(n.td,{children:"Multi-tenancy class"}),(0,s.jsx)(n.td,{children:"GraphQL + hybrid search"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"MongoDB Atlas"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"mongodb.rs"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"mongodb"})}),(0,s.jsx)(n.td,{children:"Collection filter"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"$vectorSearch"})," aggregation"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Vertex AI"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"vertex_ai.rs"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"vertex-ai"})}),(0,s.jsx)(n.td,{children:"Metadata restricts"}),(0,s.jsx)(n.td,{children:"GCP native"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Databricks"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"databricks.rs"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"databricks"})}),(0,s.jsx)(n.td,{children:"Unity Catalog schema"}),(0,s.jsx)(n.td,{children:"Data lakehouse"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453(e,n,t){t.d(n,{R:()=>i,x:()=>c});var r=t(6540);const s={},d=r.createContext(s);function i(e){const n=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);