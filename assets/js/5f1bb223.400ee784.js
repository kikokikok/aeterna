"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[7754],{2617(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"helm/ha-requirements","title":"High Availability Requirements for Aeterna","description":"This guide details the infrastructure and configuration requirements for a highly available Aeterna deployment suitable for production environments handling enterprise-scale AI agent workloads.","source":"@site/docs/helm/ha-requirements.md","sourceDirName":"helm","slug":"/helm/ha-requirements","permalink":"/aeterna/docs/helm/ha-requirements","draft":false,"unlisted":false,"editUrl":"https://github.com/kikokikok/aeterna/tree/main/website/docs/helm/ha-requirements.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Hybrid Mode: Architecture and Data Flow","permalink":"/aeterna/docs/helm/hybrid-mode"},"next":{"title":"Sizing Guide for Aeterna Deployments","permalink":"/aeterna/docs/helm/sizing-guide"}}');var t=i(4848),r=i(8453);const s={},l="High Availability Requirements for Aeterna",o={},c=[{value:"Infrastructure Baseline",id:"infrastructure-baseline",level:2},{value:"Kubernetes Cluster Requirements",id:"kubernetes-cluster-requirements",level:3},{value:"Zone Distribution",id:"zone-distribution",level:3},{value:"Component-Level High Availability",id:"component-level-high-availability",level:2},{value:"Aeterna Deployment",id:"aeterna-deployment",level:3},{value:"PostgreSQL High Availability",id:"postgresql-high-availability",level:3},{value:"Qdrant Vector Database",id:"qdrant-vector-database",level:3},{value:"OPAL Authorization Server",id:"opal-authorization-server",level:3},{value:"Dragonfly Cache",id:"dragonfly-cache",level:3},{value:"Pod Disruption Budgets",id:"pod-disruption-budgets",level:2},{value:"Topology Spread Constraints",id:"topology-spread-constraints",level:2},{value:"Horizontal Pod Autoscaling",id:"horizontal-pod-autoscaling",level:2},{value:"Storage High Availability",id:"storage-high-availability",level:2},{value:"Replicated Volume Configuration",id:"replicated-volume-configuration",level:3},{value:"Network Considerations",id:"network-considerations",level:2},{value:"Cross-AZ Traffic Policy",id:"cross-az-traffic-policy",level:3},{value:"Network Policies",id:"network-policies",level:3},{value:"Monitoring for HA Health",id:"monitoring-for-ha-health",level:2},{value:"Critical Alerts",id:"critical-alerts",level:3},{value:"Key Metrics to Monitor",id:"key-metrics-to-monitor",level:3},{value:"Testing HA Failover",id:"testing-ha-failover",level:2},{value:"Simulate Component Failure",id:"simulate-component-failure",level:3},{value:"Checklist for HA Deployment",id:"checklist-for-ha-deployment",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"high-availability-requirements-for-aeterna",children:"High Availability Requirements for Aeterna"})}),"\n",(0,t.jsx)(n.p,{children:"This guide details the infrastructure and configuration requirements for a highly available Aeterna deployment suitable for production environments handling enterprise-scale AI agent workloads."}),"\n",(0,t.jsx)(n.h2,{id:"infrastructure-baseline",children:"Infrastructure Baseline"}),"\n",(0,t.jsx)(n.h3,{id:"kubernetes-cluster-requirements",children:"Kubernetes Cluster Requirements"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Minimum Cluster Configuration:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Nodes"}),": 3 nodes minimum, distributed across 2+ availability zones"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Node Specs"}),": 4 CPU cores, 16GB RAM minimum per node"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Total Capacity"}),": 12+ CPU cores, 48GB+ RAM cluster-wide"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Network"}),": Low-latency cross-AZ connectivity (<10ms latency preferred)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Storage"}),": Replicated storage class (e.g., ",(0,t.jsx)(n.code,{children:"pd-ssd"})," on GKE, ",(0,t.jsx)(n.code,{children:"gp3"})," on EKS with replication)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"zone-distribution",children:"Zone Distribution"}),"\n",(0,t.jsx)(n.p,{children:"Deploy across at least 2 availability zones to survive single AZ failure:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# Example: 3-node cluster across 2 AZs\nnodes:\n  - node-1: us-east-1a (1 core Aeterna, 1 core PostgreSQL, 1 core Qdrant)\n  - node-2: us-east-1b (1 core Aeterna, 1 core PostgreSQL, 1 core Qdrant)\n  - node-3: us-east-1a (1 core Aeterna, 1 core PostgreSQL, 1 core Qdrant)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"component-level-high-availability",children:"Component-Level High Availability"}),"\n",(0,t.jsx)(n.h3,{id:"aeterna-deployment",children:"Aeterna Deployment"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Configuration for HA:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# values.yaml for HA deployment\naeterna:\n  replicaCount: 3\n  \n  affinity:\n    podAntiAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        - labelSelector:\n            matchExpressions:\n              - key: app.kubernetes.io/name\n                operator: In\n                values:\n                  - aeterna\n          topologyKey: kubernetes.io/hostname\n    \n    podTopologySpread:\n      - maxSkew: 1\n        topologyKey: topology.kubernetes.io/zone\n        whenUnsatisfiable: DoNotSchedule\n        labelSelector:\n          matchLabels:\n            app.kubernetes.io/name: aeterna\n  \n  pdb:\n    enabled: true\n    minAvailable: 2  # Allow 1 pod disruption, keep 2 running\n\nresources:\n  requests:\n    cpu: 500m\n    memory: 1Gi\n  limits:\n    cpu: 2000m\n    memory: 2Gi\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Replica Count Strategy:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Minimum"}),": 3 replicas (1 disruption allowed with minAvailable: 2)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Recommended"}),": 5 replicas for large deployments"]}),"\n",(0,t.jsxs)(n.li,{children:["Scale with ",(0,t.jsx)(n.code,{children:"kubectl autoscale deployment aeterna --min=3 --max=10 --cpu-percent=70"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"postgresql-high-availability",children:"PostgreSQL High Availability"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"CloudNativePG Configuration:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'postgresql:\n  cloudnativepg:\n    enabled: true\n    instances: 3  # 1 primary + 2 standbys\n    \n    primaryUpdateStrategy: unsupervised\n    \n    # Synchronous replication for data durability\n    postgresql:\n      synchronous_commit: "on"\n      synchronous_standby_names: "ANY 2 (standby1, standby2)"\n    \n    # Automatic failover\n    monitoring:\n      enabled: true\n    \n    # Storage HA\n    storage:\n      size: 100Gi\n      storageClass: gp3-replicated  # Must support replication\n    \n    # Backup + PITR\n    backup:\n      enabled: true\n      schedule: "0 2 * * *"  # 2 AM UTC daily\n      destination: s3\n      s3Credentials:\n        accessKeyId: <AWS_ACCESS_KEY>\n        secretAccessKey: <AWS_SECRET_KEY>\n        bucket: aeterna-backups\n        region: us-east-1\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Failover Behavior:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Automatic promotion of standby to primary within 30 seconds"}),"\n",(0,t.jsx)(n.li,{children:"Connection pooling via PgBouncer (included in CloudNativePG) routes traffic to new primary"}),"\n",(0,t.jsx)(n.li,{children:"Monitoring detects unhealthy primary and triggers failover"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"qdrant-vector-database",children:"Qdrant Vector Database"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"High Availability Setup:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"qdrant:\n  enabled: true\n  replicaCount: 3\n  \n  affinity:\n    podAntiAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        - labelSelector:\n            matchExpressions:\n              - key: app.kubernetes.io/name\n                operator: In\n                values:\n                  - qdrant\n          topologyKey: topology.kubernetes.io/zone\n  \n  pdb:\n    enabled: true\n    minAvailable: 2\n  \n  persistence:\n    size: 200Gi\n    storageClass: gp3-replicated\n    replicas: 3  # 3-way replication within cluster\n  \n  config:\n    cluster:\n      enabled: true\n      consensus:\n        tick_period_ms: 100\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Cluster Consensus:"}),"\nQdrant uses Raft consensus; 3 replicas tolerate 1 node failure."]}),"\n",(0,t.jsx)(n.h3,{id:"opal-authorization-server",children:"OPAL Authorization Server"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Replicated Setup:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"opal:\n  enabled: true\n  opalServer:\n    replicaCount: 2  # Minimum 2 for HA\n    \n    affinity:\n      podAntiAffinity:\n        preferredDuringSchedulingIgnoredDuringExecution:\n          - weight: 100\n            podAffinityTerm:\n              labelSelector:\n                matchLabels:\n                  app.kubernetes.io/name: opal-server\n              topologyKey: kubernetes.io/hostname\n  \n  pdb:\n    enabled: true\n    minAvailable: 1\n"})}),"\n",(0,t.jsx)(n.h3,{id:"dragonfly-cache",children:"Dragonfly Cache"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Replicated Cache:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"dragonfly:\n  enabled: true\n  replicaCount: 2  # Primary + replica\n  \n  persistence:\n    enabled: true\n    size: 50Gi\n    storageClass: gp3\n  \n  affinity:\n    podAntiAffinity:\n      preferredDuringSchedulingIgnoredDuringExecution:\n        - weight: 100\n          podAffinityTerm:\n            labelSelector:\n              matchLabels:\n                app.kubernetes.io/name: dragonfly\n            topologyKey: kubernetes.io/hostname\n"})}),"\n",(0,t.jsx)(n.h2,{id:"pod-disruption-budgets",children:"Pod Disruption Budgets"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"PDB Policies Across All Components:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"apiVersion: policy/v1\nkind: PodDisruptionBudget\nmetadata:\n  name: aeterna-pdb\nspec:\n  minAvailable: 2\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: aeterna\n---\napiVersion: policy/v1\nkind: PodDisruptionBudget\nmetadata:\n  name: qdrant-pdb\nspec:\n  minAvailable: 2\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: qdrant\n---\napiVersion: policy/v1\nkind: PodDisruptionBudget\nmetadata:\n  name: postgresql-pdb\nspec:\n  minAvailable: 1  # CloudNativePG manages this\n  selector:\n    matchLabels:\n      cnpg.io/cluster: aeterna-postgres\n"})}),"\n",(0,t.jsx)(n.h2,{id:"topology-spread-constraints",children:"Topology Spread Constraints"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Zone-Aware Pod Distribution:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"aeterna:\n  affinity:\n    podTopologySpread:\n      - maxSkew: 1\n        topologyKey: topology.kubernetes.io/zone\n        whenUnsatisfiable: DoNotSchedule\n        labelSelector:\n          matchLabels:\n            app.kubernetes.io/name: aeterna\n      - maxSkew: 2\n        topologyKey: kubernetes.io/hostname\n        whenUnsatisfiable: ScheduleAnyway\n        labelSelector:\n          matchLabels:\n            app.kubernetes.io/name: aeterna\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Effect"}),": Ensures 1 pod per zone minimum, prefers spread across nodes."]}),"\n",(0,t.jsx)(n.h2,{id:"horizontal-pod-autoscaling",children:"Horizontal Pod Autoscaling"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"HPA Configuration for Load Scaling:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"autoscaling:\n  enabled: true\n  minReplicas: 3\n  maxReplicas: 10\n  targetCPUUtilizationPercentage: 70\n  targetMemoryUtilizationPercentage: 80\n  # Scale up to handle memory load from large embeddings\n"})}),"\n",(0,t.jsx)(n.h2,{id:"storage-high-availability",children:"Storage High Availability"}),"\n",(0,t.jsx)(n.h3,{id:"replicated-volume-configuration",children:"Replicated Volume Configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'# For cloud providers:\n# AWS EKS: Use GP3 with io1/io2 for critical workloads\n# GKE: Use pd-ssd with regional persistent disks\n# Azure AKS: Use Premium_LRS or StandardSSD_LRS with replication\n\npostgresql:\n  cloudnativepg:\n    storage:\n      storageClass: gp3-replicated\n      # Ensure StorageClass has:\n      # - parameters.replication: "true"\n      # - parameters.replicas: 3\n'})}),"\n",(0,t.jsx)(n.h2,{id:"network-considerations",children:"Network Considerations"}),"\n",(0,t.jsx)(n.h3,{id:"cross-az-traffic-policy",children:"Cross-AZ Traffic Policy"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# Minimize cross-AZ traffic where possible\naeterna:\n  affinity:\n    # Prefer same-zone for low latency\n    podPreferredAffinity:\n      - weight: 100\n        podAffinityTerm:\n          labelSelector:\n            matchLabels:\n              app.kubernetes.io/name: postgresql\n          topologyKey: topology.kubernetes.io/zone\n"})}),"\n",(0,t.jsx)(n.h3,{id:"network-policies",children:"Network Policies"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# Restrict traffic between critical components\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: aeterna-network-policy\nspec:\n  podSelector:\n    matchLabels:\n      app.kubernetes.io/name: aeterna\n  policyTypes:\n    - Ingress\n  ingress:\n    - from:\n        - podSelector:\n            matchLabels:\n              role: api-gateway\n      ports:\n        - protocol: TCP\n          port: 8000\n"})}),"\n",(0,t.jsx)(n.h2,{id:"monitoring-for-ha-health",children:"Monitoring for HA Health"}),"\n",(0,t.jsx)(n.h3,{id:"critical-alerts",children:"Critical Alerts"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'alertmanager:\n  rules:\n    - alert: AeternaPodsBelowMinReplicas\n      expr: kube_deployment_status_replicas_available{deployment="aeterna"} < 2\n      for: 5m\n      \n    - alert: PostgreSQLNotReplicating\n      expr: cnpg_replication_lag_bytes > 1000000  # 1MB lag\n      \n    - alert: QdrantClusterDegraded\n      expr: qdrant_cluster_peers_total < 3\n      \n    - alert: StorageIOPSThrottled\n      expr: rate(kubelet_volume_stats_available_bytes[5m]) < 10000000\n'})}),"\n",(0,t.jsx)(n.h3,{id:"key-metrics-to-monitor",children:"Key Metrics to Monitor"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"kube_deployment_status_replicas_available"}),": Available replicas per component"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cnpg_replication_lag_bytes"}),": PostgreSQL replication lag"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"qdrant_cluster_peers_total"}),": Active Qdrant peers"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"node_cpu_usage_percent"}),": Node CPU utilization"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"kubelet_volume_stats_capacity_bytes"}),": Storage capacity vs. usage"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"testing-ha-failover",children:"Testing HA Failover"}),"\n",(0,t.jsx)(n.h3,{id:"simulate-component-failure",children:"Simulate Component Failure"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Test Aeterna failover\nkubectl delete pod -n aeterna aeterna-0\n# Verify new pod starts and traffic routes within 30s\n\n# Test PostgreSQL failover\nkubectl delete pod -n aeterna aeterna-postgres-1\n# CloudNativePG promotes standby automatically\n\n# Test zone failure (drain node in AZ)\nkubectl drain node-1 --ignore-daemonsets --delete-emptydir-data\n# All pods reschedule to remaining AZ\n"})}),"\n",(0,t.jsx)(n.h2,{id:"checklist-for-ha-deployment",children:"Checklist for HA Deployment"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," 3+ nodes across 2+ AZs provisioned"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," Storage class supports replication"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," All component replicaCounts \u2265 minimum (Aeterna: 3, PostgreSQL: 3, Qdrant: 3)"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," PDB policies configured for all components"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," Anti-affinity rules deployed"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," Topology spread constraints active"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," HPA enabled and tested"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," Backup/restore procedure validated"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," Monitoring and alerting configured"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," Load testing confirms HA under failure scenarios"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,n,i){i.d(n,{R:()=>s,x:()=>l});var a=i(6540);const t={},r=a.createContext(t);function s(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);