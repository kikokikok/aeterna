"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[7025],{5809(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"integrations/opencode-integration","title":"OpenCode Integration Guide","description":"Comprehensive guide for integrating Aeterna with OpenCode, the AI-powered coding assistant.","source":"@site/docs/integrations/opencode-integration.md","sourceDirName":"integrations","slug":"/integrations/opencode-integration","permalink":"/aeterna/docs/integrations/opencode-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/kikokikok/aeterna/tree/main/website/docs/integrations/opencode-integration.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"MCP Server Integration Guide","permalink":"/aeterna/docs/integrations/mcp-server"},"next":{"title":"Provider Adapters Guide","permalink":"/aeterna/docs/guides/provider-adapters"}}');var s=r(4848),o=r(8453);const i={},a="OpenCode Integration Guide",l={},c=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Overview",id:"overview",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"1. Install the Plugin",id:"1-install-the-plugin",level:3},{value:"2. Initialize Configuration",id:"2-initialize-configuration",level:3},{value:"3. Configure OpenCode",id:"3-configure-opencode",level:3},{value:"4. Start Using",id:"4-start-using",level:3},{value:"Integration Methods",id:"integration-methods",level:2},{value:"Feature Comparison",id:"feature-comparison",level:3},{value:"NPM Plugin (Recommended)",id:"npm-plugin-recommended",level:2},{value:"Architecture",id:"architecture",level:3},{value:"Package Structure",id:"package-structure",level:3},{value:"All 8 Aeterna Tools",id:"all-8-aeterna-tools",level:2},{value:"Memory Tools",id:"memory-tools",level:3},{value:"<code>aeterna_memory_add</code>",id:"aeterna_memory_add",level:4},{value:"<code>aeterna_memory_search</code>",id:"aeterna_memory_search",level:4},{value:"<code>aeterna_memory_get</code>",id:"aeterna_memory_get",level:4},{value:"<code>aeterna_memory_promote</code>",id:"aeterna_memory_promote",level:4},{value:"Knowledge Tools",id:"knowledge-tools",level:3},{value:"<code>aeterna_knowledge_query</code>",id:"aeterna_knowledge_query",level:4},{value:"<code>aeterna_knowledge_propose</code>",id:"aeterna_knowledge_propose",level:4},{value:"Sync &amp; Governance Tools",id:"sync--governance-tools",level:3},{value:"<code>aeterna_sync_status</code>",id:"aeterna_sync_status",level:4},{value:"<code>aeterna_governance_status</code>",id:"aeterna_governance_status",level:4},{value:"Hook System",id:"hook-system",level:2},{value:"Chat Message Hook",id:"chat-message-hook",level:3},{value:"System Prompt Transform Hook",id:"system-prompt-transform-hook",level:3},{value:"Tool Execute Before Hook",id:"tool-execute-before-hook",level:3},{value:"Tool Execute After Hook",id:"tool-execute-after-hook",level:3},{value:"Permission Hook",id:"permission-hook",level:3},{value:"Event Hook",id:"event-hook",level:3},{value:"Automatic Session Capture",id:"automatic-session-capture",level:2},{value:"What Gets Captured",id:"what-gets-captured",level:3},{value:"Capture Flow",id:"capture-flow",level:3},{value:"Session Summary Generation",id:"session-summary-generation",level:3},{value:"Knowledge Context Injection",id:"knowledge-context-injection",level:2},{value:"Semantic Matching",id:"semantic-matching",level:3},{value:"Priority Order",id:"priority-order",level:3},{value:"Token Limits",id:"token-limits",level:3},{value:"Significance Detection",id:"significance-detection",level:2},{value:"Detection Criteria",id:"detection-criteria",level:3},{value:"Error Resolution Detection",id:"error-resolution-detection",level:3},{value:"Repeated Pattern Detection",id:"repeated-pattern-detection",level:3},{value:"Governance Integration",id:"governance-integration",level:2},{value:"Governance Notifications",id:"governance-notifications",level:3},{value:"Event Handling",id:"event-handling",level:3},{value:"Permission Checks",id:"permission-checks",level:3},{value:"Configuration Reference",id:"configuration-reference",level:2},{value:"<code>.aeterna/config.toml</code>",id:"aeternaconfigtoml",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"<code>opencode.jsonc</code>",id:"opencodejsonc",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Plugin Not Loading",id:"plugin-not-loading",level:4},{value:"Connection Refused",id:"connection-refused",level:4},{value:"Knowledge Not Injecting",id:"knowledge-not-injecting",level:4},{value:"Memories Not Capturing",id:"memories-not-capturing",level:4},{value:"Permission Denied for Proposals",id:"permission-denied-for-proposals",level:4},{value:"Debug Mode",id:"debug-mode",level:3},{value:"Health Check",id:"health-check",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"opencode-integration-guide",children:"OpenCode Integration Guide"})}),"\n",(0,s.jsxs)(n.p,{children:["Comprehensive guide for integrating Aeterna with ",(0,s.jsx)(n.a,{href:"https://opencode.ai",children:"OpenCode"}),", the AI-powered coding assistant."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#overview",children:"Overview"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#quick-start",children:"Quick Start"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#integration-methods",children:"Integration Methods"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#npm-plugin-recommended",children:"NPM Plugin (Recommended)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#all-8-aeterna-tools",children:"All 8 Aeterna Tools"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#hook-system",children:"Hook System"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#automatic-session-capture",children:"Automatic Session Capture"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#knowledge-context-injection",children:"Knowledge Context Injection"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#significance-detection",children:"Significance Detection"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#governance-integration",children:"Governance Integration"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#configuration-reference",children:"Configuration Reference"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#troubleshooting",children:"Troubleshooting"})}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"Aeterna integrates with OpenCode to provide:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Persistent Memory"}),": Remember context across sessions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Organizational Knowledge"}),": ADRs, policies, patterns injected into chat"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Automatic Capture"}),": Tool executions saved as working memory"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Significance Detection"}),": Important learnings auto-promoted"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Governance"}),": Policy enforcement and constraint checking"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           OPENCODE + AETERNA                                 \u2502\n\u2502                                                                              \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                \u2502\n\u2502   \u2502   User Message  \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502   AI Response   \u2502                \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                \u2502\n\u2502            \u2502                                      \u2502                          \u2502\n\u2502            \u25bc                                      \u25bc                          \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502   \u2502                     AETERNA PLUGIN HOOKS                        \u2502        \u2502\n\u2502   \u2502                                                                 \u2502        \u2502\n\u2502   \u2502   chat.message          system.transform      tool.execute      \u2502        \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502        \u2502\n\u2502   \u2502   \u2502 Inject   \u2502          \u2502 Add      \u2502          \u2502 Capture  \u2502     \u2502        \u2502\n\u2502   \u2502   \u2502 Knowledge\u2502          \u2502 Context  \u2502          \u2502 Memory   \u2502     \u2502        \u2502\n\u2502   \u2502   \u2502 + Memory \u2502          \u2502 + Hints  \u2502          \u2502 + Detect \u2502     \u2502        \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502        \u2502\n\u2502   \u2502                                                                 \u2502        \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                              \u2502                                               \u2502\n\u2502                              \u25bc                                               \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n\u2502   \u2502                      AETERNA BACKEND                             \u2502       \u2502\n\u2502   \u2502                                                                  \u2502       \u2502\n\u2502   \u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502       \u2502\n\u2502   \u2502   \u2502    Memory    \u2502  \u2502  Knowledge   \u2502  \u2502  Governance  \u2502          \u2502       \u2502\n\u2502   \u2502   \u2502   (Qdrant)   \u2502  \u2502    (Git)     \u2502  \u2502   (Cedar)    \u2502          \u2502       \u2502\n\u2502   \u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502       \u2502\n\u2502   \u2502                                                                  \u2502       \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502\n\u2502                                                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,s.jsx)(n.h3,{id:"1-install-the-plugin",children:"1. Install the Plugin"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm install -D @kiko-aeterna/opencode-plugin\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-initialize-configuration",children:"2. Initialize Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npx aeterna init --opencode\n"})}),"\n",(0,s.jsx)(n.p,{children:"This creates:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"opencode.jsonc"})," with plugin configuration"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:".aeterna/config.toml"})," with project settings"]}),"\n",(0,s.jsxs)(n.li,{children:["Updates ",(0,s.jsx)(n.code,{children:".gitignore"})," to exclude local files"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-configure-opencode",children:"3. Configure OpenCode"}),"\n",(0,s.jsxs)(n.p,{children:["Add to your ",(0,s.jsx)(n.code,{children:"opencode.jsonc"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsonc",children:'{\n  "$schema": "https://opencode.ai/config.json",\n  "plugin": ["@kiko-aeterna/opencode-plugin"]\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"4-start-using",children:"4. Start Using"}),"\n",(0,s.jsx)(n.p,{children:"Launch OpenCode and all Aeterna tools are now available:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'You: Search my memory for database preferences\n\nAI: [Uses aeterna_memory_search]\nFound 2 relevant memories:\n- "User prefers PostgreSQL for relational data" (user layer, 0.92 score)\n- "Project uses TimescaleDB for time-series" (project layer, 0.85 score)\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"integration-methods",children:"Integration Methods"}),"\n",(0,s.jsxs)(n.p,{children:["Aeterna provides ",(0,s.jsx)(n.strong,{children:"two integration methods"}),":"]}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Method"}),(0,s.jsx)(n.th,{children:"Best For"}),(0,s.jsx)(n.th,{children:"Features"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"NPM Plugin"})}),(0,s.jsx)(n.td,{children:"Local development, full features"}),(0,s.jsx)(n.td,{children:"All hooks, deep integration"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"MCP Server"})}),(0,s.jsx)(n.td,{children:"Remote deployments, enterprise"}),(0,s.jsx)(n.td,{children:"Tool access, limited hooks"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"feature-comparison",children:"Feature Comparison"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Feature"}),(0,s.jsx)(n.th,{children:"NPM Plugin"}),(0,s.jsx)(n.th,{children:"MCP Server"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"All 8 tools"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"Yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Chat message hook"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"System prompt injection"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Tool execution capture"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"Limited"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Permission hooks"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Session lifecycle"}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{children:"Limited"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Remote deployment"}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:"Yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Enterprise auth"}),(0,s.jsx)(n.td,{children:"Via backend"}),(0,s.jsx)(n.td,{children:"Native"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Recommendation"}),": Use ",(0,s.jsx)(n.strong,{children:"NPM Plugin"})," for development. Use ",(0,s.jsx)(n.strong,{children:"MCP Server"})," for centralized/remote deployments."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"npm-plugin-recommended",children:"NPM Plugin (Recommended)"}),"\n",(0,s.jsx)(n.h3,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'// @kiko-aeterna/opencode-plugin/src/index.ts\nimport type { Plugin, Hooks, PluginInput } from "@opencode-ai/plugin"\nimport { tool } from "@opencode-ai/plugin/tool"\nimport { AeternaClient } from "@aeterna/client"\n\nconst aeterna: Plugin = async (input: PluginInput): Promise<Hooks> => {\n  const client = new AeternaClient({\n    project: input.project.name,\n    directory: input.directory,\n    serverUrl: process.env.AETERNA_SERVER_URL,\n  })\n\n  await client.sessionStart()\n\n  return {\n    // Tools\n    tool: { /* 8 Aeterna tools */ },\n    \n    // Hooks\n    "chat.message": async (input, output) => { /* Inject knowledge */ },\n    "experimental.chat.system.transform": async (input, output) => { /* Add context */ },\n    "tool.execute.before": async (input, output) => { /* Validate args */ },\n    "tool.execute.after": async (input, output) => { /* Capture memory */ },\n    "permission.ask": async (input, output) => { /* Check governance */ },\n    "event": async ({ event }) => { /* Handle lifecycle */ },\n  }\n}\n\nexport default aeterna\n'})}),"\n",(0,s.jsx)(n.h3,{id:"package-structure",children:"Package Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"@kiko-aeterna/opencode-plugin/\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 index.ts          # Plugin entry point\n\u2502   \u251c\u2500\u2500 client.ts         # Aeterna client wrapper\n\u2502   \u251c\u2500\u2500 tools/\n\u2502   \u2502   \u251c\u2500\u2500 memory.ts     # Memory tools (add, search, get, promote)\n\u2502   \u2502   \u251c\u2500\u2500 knowledge.ts  # Knowledge tools (query, propose)\n\u2502   \u2502   \u2514\u2500\u2500 governance.ts # Governance tools (sync, status)\n\u2502   \u251c\u2500\u2500 hooks/\n\u2502   \u2502   \u251c\u2500\u2500 chat.ts       # chat.message, system.transform\n\u2502   \u2502   \u251c\u2500\u2500 tool.ts       # tool.execute.before/after\n\u2502   \u2502   \u2514\u2500\u2500 session.ts    # Session lifecycle (event hook)\n\u2502   \u2514\u2500\u2500 utils/\n\u2502       \u251c\u2500\u2500 format.ts     # Output formatting\n\u2502       \u2514\u2500\u2500 detect.ts     # Significance detection\n\u2514\u2500\u2500 README.md\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"all-8-aeterna-tools",children:"All 8 Aeterna Tools"}),"\n",(0,s.jsx)(n.h3,{id:"memory-tools",children:"Memory Tools"}),"\n",(0,s.jsx)(n.h4,{id:"aeterna_memory_add",children:(0,s.jsx)(n.code,{children:"aeterna_memory_add"})}),"\n",(0,s.jsx)(n.p,{children:"Store information for future reference."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'const memoryAddTool = tool({\n  description: "Add a memory entry to Aeterna. Use this to capture learnings, solutions, or important context.",\n  args: {\n    content: z.string().describe("The content to remember"),\n    layer: z.enum(["working", "session", "episodic"]).optional()\n      .describe("Memory layer (default: working)"),\n    tags: z.array(z.string()).optional()\n      .describe("Tags for categorization"),\n    importance: z.number().min(0).max(1).optional()\n      .describe("Importance score 0-1 (default: auto-calculated)"),\n  },\n  async execute(args, context) {\n    const result = await client.memoryAdd({\n      content: args.content,\n      layer: args.layer ?? "working",\n      tags: args.tags,\n      importance: args.importance,\n      sessionId: context.sessionID,\n    })\n    return `Memory added: ${result.id} (layer: ${result.layer}, importance: ${result.importance})`\n  },\n})\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example Usage:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"You: Remember that this project uses PostgreSQL with read replicas\n\nAI: [Uses aeterna_memory_add]\nMemory added: mem_abc123 (layer: project, importance: 0.75)\nI've stored this as a project-level memory for future reference.\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"aeterna_memory_search",children:(0,s.jsx)(n.code,{children:"aeterna_memory_search"})}),"\n",(0,s.jsx)(n.p,{children:"Search memories for relevant context."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'const memorySearchTool = tool({\n  description: "Search memories for relevant context. Returns semantically similar memories.",\n  args: {\n    query: z.string().describe("Search query"),\n    layers: z.array(z.enum(["working", "session", "episodic"])).optional()\n      .describe("Layers to search (default: all)"),\n    limit: z.number().min(1).max(20).optional()\n      .describe("Max results (default: 5)"),\n    threshold: z.number().min(0).max(1).optional()\n      .describe("Similarity threshold (default: 0.7)"),\n  },\n  async execute(args, context) {\n    const results = await client.memorySearch({\n      query: args.query,\n      layers: args.layers,\n      limit: args.limit ?? 5,\n      threshold: args.threshold ?? 0.7,\n      sessionId: context.sessionID,\n    })\n    return formatMemoryResults(results)\n  },\n})\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example Usage:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'You: What do I prefer for error handling?\n\nAI: [Uses aeterna_memory_search with query="error handling preferences"]\nFound 3 relevant memories:\n1. "User prefers Result types over exceptions" (user, 0.91)\n2. "Project uses anyhow for error context" (project, 0.87)\n3. "Team standard: always include error codes" (team, 0.82)\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"aeterna_memory_get",children:(0,s.jsx)(n.code,{children:"aeterna_memory_get"})}),"\n",(0,s.jsx)(n.p,{children:"Retrieve a specific memory by ID."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'const memoryGetTool = tool({\n  description: "Retrieve a specific memory by ID.",\n  args: {\n    memoryId: z.string().describe("Memory ID to retrieve"),\n  },\n  async execute(args) {\n    const memory = await client.memoryGet(args.memoryId)\n    return formatMemory(memory)\n  },\n})\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"aeterna_memory_promote",children:(0,s.jsx)(n.code,{children:"aeterna_memory_promote"})}),"\n",(0,s.jsx)(n.p,{children:"Promote a memory to a higher layer."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'const memoryPromoteTool = tool({\n  description: "Promote a memory from a lower layer to a higher layer (e.g., session -> project).",\n  args: {\n    memoryId: z.string().describe("Memory ID to promote"),\n    targetLayer: z.enum(["project", "team", "org", "company"])\n      .describe("Target layer for promotion"),\n    reason: z.string().optional()\n      .describe("Reason for promotion"),\n  },\n  async execute(args) {\n    const result = await client.memoryPromote({\n      memoryId: args.memoryId,\n      targetLayer: args.targetLayer,\n      reason: args.reason,\n    })\n    return `Memory ${args.memoryId} promoted to ${args.targetLayer} layer`\n  },\n})\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example Usage:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"You: That database optimization trick we discovered should be shared with the team\n\nAI: [Uses aeterna_memory_promote]\nMemory mem_xyz789 promoted to team layer.\nNow all team members' AI assistants will have access to this optimization pattern.\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"knowledge-tools",children:"Knowledge Tools"}),"\n",(0,s.jsx)(n.h4,{id:"aeterna_knowledge_query",children:(0,s.jsx)(n.code,{children:"aeterna_knowledge_query"})}),"\n",(0,s.jsx)(n.p,{children:"Search organizational knowledge (ADRs, policies, patterns)."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'const knowledgeQueryTool = tool({\n  description: "Query the knowledge repository for project/team/org knowledge.",\n  args: {\n    query: z.string().describe("Search query"),\n    scope: z.enum(["project", "team", "org", "company"]).optional()\n      .describe("Knowledge scope (default: project)"),\n    types: z.array(z.enum(["adr", "pattern", "policy", "reference"])).optional()\n      .describe("Knowledge types to include"),\n    limit: z.number().min(1).max(10).optional()\n      .describe("Max results (default: 3)"),\n  },\n  async execute(args) {\n    const results = await client.knowledgeQuery({\n      query: args.query,\n      scope: args.scope ?? "project",\n      types: args.types,\n      limit: args.limit ?? 3,\n    })\n    return formatKnowledgeResults(results)\n  },\n})\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example Usage:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'You: Are there any ADRs about database selection?\n\nAI: [Uses aeterna_knowledge_query with type="adr", query="database selection"]\nFound 1 ADR:\n- ADR-042: Database Selection for New Services (org level, accepted)\n  Summary: Use PostgreSQL for all new services requiring relational data.\n  Has blocking constraints against MySQL/MariaDB.\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"aeterna_knowledge_propose",children:(0,s.jsx)(n.code,{children:"aeterna_knowledge_propose"})}),"\n",(0,s.jsx)(n.p,{children:"Propose a new knowledge item (ADR, policy, pattern)."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'const knowledgeProposeTool = tool({\n  description: "Propose a new knowledge item (ADR, policy, pattern) for review.",\n  args: {\n    type: z.enum(["adr", "policy", "pattern", "reference"])\n      .describe("Type of knowledge item"),\n    title: z.string().describe("Title of the item"),\n    summary: z.string().describe("Brief summary"),\n    content: z.string().describe("Full markdown content"),\n    tags: z.array(z.string()).optional().describe("Tags for categorization"),\n  },\n  async execute(args, context) {\n    const result = await client.knowledgePropose({\n      type: args.type,\n      title: args.title,\n      summary: args.summary,\n      content: args.content,\n      tags: args.tags,\n      proposer: context.userID,\n    })\n    return `Knowledge proposal created: ${result.id} (status: ${result.status})`\n  },\n})\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example Usage:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"You: Let's create an ADR for our decision to use TigerBeetle for the ledger\n\nAI: [Uses aeterna_knowledge_propose]\nKnowledge proposal created: adr-047-tigerbeetle-ledger (status: draft)\nThe proposal has been submitted for review. Notify your tech lead for approval.\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"sync--governance-tools",children:"Sync & Governance Tools"}),"\n",(0,s.jsx)(n.h4,{id:"aeterna_sync_status",children:(0,s.jsx)(n.code,{children:"aeterna_sync_status"})}),"\n",(0,s.jsx)(n.p,{children:"Check memory-knowledge synchronization status."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'const syncStatusTool = tool({\n  description: "Check the sync status between memory and knowledge systems.",\n  args: {},\n  async execute() {\n    const status = await client.syncStatus()\n    return formatSyncStatus(status)\n  },\n})\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h4,{id:"aeterna_governance_status",children:(0,s.jsx)(n.code,{children:"aeterna_governance_status"})}),"\n",(0,s.jsx)(n.p,{children:"Check governance state and pending proposals."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'const governanceStatusTool = tool({\n  description: "Check governance state including pending proposals and policy violations.",\n  args: {\n    checkViolations: z.boolean().optional()\n      .describe("Check for current policy violations"),\n  },\n  async execute(args) {\n    const status = await client.governanceStatus({\n      checkViolations: args.checkViolations ?? false,\n    })\n    return formatGovernanceStatus(status)\n  },\n})\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"hook-system",children:"Hook System"}),"\n",(0,s.jsx)(n.h3,{id:"chat-message-hook",children:"Chat Message Hook"}),"\n",(0,s.jsx)(n.p,{children:"Injects relevant knowledge and memories into user messages."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'"chat.message": async (input, output) => {\n  const userMessage = output.message.content\n  \n  // Query relevant knowledge\n  const knowledge = await client.queryRelevantKnowledge(userMessage, {\n    limit: 3,\n    threshold: 0.75,\n  })\n  \n  // Query relevant memories\n  const memories = await client.searchSessionMemories(userMessage, {\n    limit: 5,\n  })\n  \n  if (knowledge.length > 0 || memories.length > 0) {\n    output.parts.unshift({\n      type: "text",\n      text: `<aeterna_context>\n${formatKnowledgeContext(knowledge)}\n${formatMemoryContext(memories)}\n</aeterna_context>`,\n    })\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What Gets Injected:"})}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Source"}),(0,s.jsx)(n.th,{children:"Content"}),(0,s.jsx)(n.th,{children:"Priority"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Knowledge"}),(0,s.jsx)(n.td,{children:"ADRs, policies, patterns relevant to query"}),(0,s.jsx)(n.td,{children:"High"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Session Memory"}),(0,s.jsx)(n.td,{children:"Current conversation context"}),(0,s.jsx)(n.td,{children:"High"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"User Memory"}),(0,s.jsx)(n.td,{children:"User preferences and history"}),(0,s.jsx)(n.td,{children:"Medium"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Project Memory"}),(0,s.jsx)(n.td,{children:"Project-specific conventions"}),(0,s.jsx)(n.td,{children:"Medium"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Team Memory"}),(0,s.jsx)(n.td,{children:"Team standards and learnings"}),(0,s.jsx)(n.td,{children:"Low"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example Injection:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<aeterna_context>\n## Relevant Knowledge\n- **ADR-042**: Database Selection - Use PostgreSQL for new services\n- **Policy**: security-baseline - All dependencies must be scanned\n\n## Relevant Memories\n- User prefers functional programming patterns (user, 0.91)\n- Last session discussed database optimization (session, 0.88)\n</aeterna_context>\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"system-prompt-transform-hook",children:"System Prompt Transform Hook"}),"\n",(0,s.jsx)(n.p,{children:"Adds project context to the AI's system prompt."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'"experimental.chat.system.transform": async (input, output) => {\n  const context = await client.getProjectContext()\n  \n  output.system.push(`\n## Aeterna Project Context\n\nProject: ${context.project.name}\nTeam: ${context.team?.name ?? "N/A"}\nOrganization: ${context.org?.name ?? "N/A"}\n\n### Active Policies\n${context.policies.map(p => `- ${p.name}: ${p.summary}`).join("\\n")}\n\n### Recent Learnings\n${context.recentMemories.map(m => `- ${m.summary}`).join("\\n")}\n\nWhen you discover useful patterns or solutions, use aeterna_memory_add to capture them.\nWhen you need context, use aeterna_memory_search or aeterna_knowledge_query.\n`)\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"tool-execute-before-hook",children:"Tool Execute Before Hook"}),"\n",(0,s.jsx)(n.p,{children:"Validates and enriches tool arguments before execution."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'"tool.execute.before": async (input, output) => {\n  if (input.tool.startsWith("aeterna_")) {\n    // Enrich with session context\n    await client.enrichToolArgs(input.tool, output.args)\n  }\n  \n  // Pre-check governance for sensitive operations\n  if (input.tool === "aeterna_knowledge_propose") {\n    const canPropose = await client.checkProposalPermission()\n    if (!canPropose) {\n      throw new Error("User lacks permission to propose knowledge items")\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"tool-execute-after-hook",children:"Tool Execute After Hook"}),"\n",(0,s.jsx)(n.p,{children:"Captures tool executions as working memory."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'"tool.execute.after": async (input, output) => {\n  // Capture all tool executions\n  await client.captureToolExecution({\n    tool: input.tool,\n    sessionId: input.sessionID,\n    callId: input.callID,\n    title: output.title,\n    output: output.output,\n    metadata: output.metadata,\n    timestamp: Date.now(),\n  })\n  \n  // Detect significant patterns\n  if (await client.detectSignificance(input, output)) {\n    await client.flagForPromotion(input.sessionID, input.callID)\n  }\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"permission-hook",children:"Permission Hook"}),"\n",(0,s.jsx)(n.p,{children:"Integrates with Aeterna's governance system."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'"permission.ask": async (input, output) => {\n  if (input.tool?.startsWith("aeterna_knowledge_propose")) {\n    const canPropose = await client.checkProposalPermission()\n    if (!canPropose) {\n      output.status = "deny"\n      output.message = "You don\'t have permission to propose knowledge items. Contact your tech lead."\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"event-hook",children:"Event Hook"}),"\n",(0,s.jsx)(n.p,{children:"Handles session lifecycle events."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'"event": async ({ event }) => {\n  switch (event.type) {\n    case "session.start":\n      await client.sessionStart()\n      await client.subscribeToGovernance()\n      break\n      \n    case "session.end":\n      await client.sessionEnd()\n      // Auto-promote significant memories\n      await client.promotePendingMemories()\n      // Generate session summary\n      await client.generateSessionSummary()\n      break\n  }\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"automatic-session-capture",children:"Automatic Session Capture"}),"\n",(0,s.jsx)(n.p,{children:"Every tool execution is automatically captured without user action."}),"\n",(0,s.jsx)(n.h3,{id:"what-gets-captured",children:"What Gets Captured"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Event"}),(0,s.jsx)(n.th,{children:"Captured Data"}),(0,s.jsx)(n.th,{children:"Memory Layer"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Tool invocation"}),(0,s.jsx)(n.td,{children:"Tool name, args, output"}),(0,s.jsx)(n.td,{children:"Working"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Error occurrence"}),(0,s.jsx)(n.td,{children:"Error message, stack trace"}),(0,s.jsx)(n.td,{children:"Working"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"File modification"}),(0,s.jsx)(n.td,{children:"File path, change type"}),(0,s.jsx)(n.td,{children:"Working"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Chat message"}),(0,s.jsx)(n.td,{children:"Message content (if significant)"}),(0,s.jsx)(n.td,{children:"Working"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"capture-flow",children:"Capture Flow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Tool Execution\n      \u2502\n      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Capture Context \u2502  \u2190 tool name, args, output, timestamp\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Create Memory  \u2502  \u2190 working memory entry\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Detect Signif.  \u2502  \u2190 error resolution? repeated? novel?\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510\n    \u2502         \u2502\n    \u25bc         \u25bc\n Normal    Significant\n    \u2502         \u2502\n    \u25bc         \u25bc\n Store     Flag for\n Only      Promotion\n"})}),"\n",(0,s.jsx)(n.h3,{id:"session-summary-generation",children:"Session Summary Generation"}),"\n",(0,s.jsx)(n.p,{children:"At session end, Aeterna generates a summary:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface SessionSummary {\n  sessionId: string\n  duration: number\n  toolsUsed: string[]\n  filesModified: string[]\n  memoriesCreated: number\n  memoriesPromoted: number\n  significantLearnings: string[]\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"knowledge-context-injection",children:"Knowledge Context Injection"}),"\n",(0,s.jsx)(n.h3,{id:"semantic-matching",children:"Semantic Matching"}),"\n",(0,s.jsx)(n.p,{children:"Knowledge is matched based on semantic similarity to the user's message:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'const knowledge = await client.queryRelevantKnowledge(userMessage, {\n  limit: 3,           // Max 3 items\n  threshold: 0.75,    // 75% similarity minimum\n  types: ["adr", "policy", "pattern"],\n})\n'})}),"\n",(0,s.jsx)(n.h3,{id:"priority-order",children:"Priority Order"}),"\n",(0,s.jsx)(n.p,{children:"When multiple knowledge items match, priority follows:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Project"})," (highest) - Most specific to current work"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Team"})," - Team-level standards"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Organization"})," - Org-wide policies"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Company"})," (lowest) - Company-wide rules"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"token-limits",children:"Token Limits"}),"\n",(0,s.jsx)(n.p,{children:"To avoid context overflow:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const context = await client.getContextWithLimits({\n  maxTokens: 2000,\n  knowledgeTokens: 1000,  // Max tokens for knowledge\n  memoryTokens: 1000,     // Max tokens for memory\n})\n"})}),"\n",(0,s.jsx)(n.p,{children:"Items are truncated or omitted based on priority when limits are exceeded."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"significance-detection",children:"Significance Detection"}),"\n",(0,s.jsx)(n.p,{children:"Aeterna automatically detects significant learnings worthy of promotion."}),"\n",(0,s.jsx)(n.h3,{id:"detection-criteria",children:"Detection Criteria"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Pattern"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Auto-Action"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Error Resolution"})}),(0,s.jsx)(n.td,{children:"Error followed by successful outcome"}),(0,s.jsx)(n.td,{children:"Flag for promotion"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Repeated Query"})}),(0,s.jsx)(n.td,{children:"Same query 3+ times"}),(0,s.jsx)(n.td,{children:"Consolidate & flag"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Novel Approach"})}),(0,s.jsx)(n.td,{children:"Solution differs from existing knowledge"}),(0,s.jsx)(n.td,{children:"Flag for review"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Explicit Capture"})}),(0,s.jsxs)(n.td,{children:["User called ",(0,s.jsx)(n.code,{children:"aeterna_memory_add"})]}),(0,s.jsx)(n.td,{children:"Store immediately"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"error-resolution-detection",children:"Error Resolution Detection"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"async function detectErrorResolution(session: Session): Promise<boolean> {\n  const recentTools = session.toolExecutions.slice(-10)\n  \n  // Find error followed by success\n  for (let i = 0; i < recentTools.length - 1; i++) {\n    if (recentTools[i].error && !recentTools[i + 1].error) {\n      // Check if same area (e.g., same file, same tool)\n      if (isSameArea(recentTools[i], recentTools[i + 1])) {\n        return true\n      }\n    }\n  }\n  return false\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"repeated-pattern-detection",children:"Repeated Pattern Detection"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"async function detectRepeatedPattern(session: Session): Promise<boolean> {\n  const queries = session.memorySearches\n  const grouped = groupBySimilarity(queries, 0.85)\n  \n  for (const group of grouped) {\n    if (group.length >= 3) {\n      // Same query 3+ times \u2192 consolidate\n      return true\n    }\n  }\n  return false\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"governance-integration",children:"Governance Integration"}),"\n",(0,s.jsx)(n.h3,{id:"governance-notifications",children:"Governance Notifications"}),"\n",(0,s.jsx)(n.p,{children:"The plugin subscribes to governance events:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'type GovernanceEvent = \n  | { type: "ProposalApproved"; proposalId: string; approver: string }\n  | { type: "ProposalRejected"; proposalId: string; reason: string }\n  | { type: "DriftDetected"; itemId: string; severity: string }\n  | { type: "PolicyViolation"; policyId: string; violation: string }\n'})}),"\n",(0,s.jsx)(n.h3,{id:"event-handling",children:"Event Handling"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'client.onGovernanceEvent((event) => {\n  switch (event.type) {\n    case "ProposalApproved":\n      notify(`Your proposal ${event.proposalId} was approved!`)\n      break\n    case "DriftDetected":\n      warn(`Semantic drift detected in ${event.itemId}. Review recommended.`)\n      break\n    case "PolicyViolation":\n      error(`Policy violation: ${event.violation}`)\n      break\n  }\n})\n'})}),"\n",(0,s.jsx)(n.h3,{id:"permission-checks",children:"Permission Checks"}),"\n",(0,s.jsx)(n.p,{children:"Before sensitive operations:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'const permissions = await client.checkPermissions({\n  action: "ProposeKnowledge",\n  resource: "adr",\n  scope: "team",\n})\n\nif (!permissions.allowed) {\n  throw new Error(`Permission denied: ${permissions.reason}`)\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"configuration-reference",children:"Configuration Reference"}),"\n",(0,s.jsx)(n.h3,{id:"aeternaconfigtoml",children:(0,s.jsx)(n.code,{children:".aeterna/config.toml"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:'[project]\nname = "my-project"\nteam = "backend"\norg = "engineering"\n\n[capture]\n# Enable automatic session capture\nenabled = true\n# Capture sensitivity: low, medium, high\n# - low: Only explicit aeterna_memory_add calls\n# - medium: + error resolutions and repeated patterns\n# - high: + all tool executions\nsensitivity = "medium"\n# Auto-promote significant memories at session end\nauto_promote = true\n\n[knowledge]\n# Inject relevant knowledge into chat context\ninjection_enabled = true\n# Maximum knowledge items to inject\nmax_items = 3\n# Minimum similarity threshold (0.0 - 1.0)\nthreshold = 0.75\n\n[governance]\n# Enable governance event notifications\nnotifications = true\n# Alert on semantic drift detection\ndrift_alerts = true\n\n[server]\n# Aeterna server URL (for remote deployments)\nurl = "http://localhost:8080"\n# API key (if using remote server)\n# api_key = "your-api-key"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Variable"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Default"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AETERNA_SERVER_URL"})}),(0,s.jsx)(n.td,{children:"Aeterna server URL"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"http://localhost:8080"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AETERNA_API_KEY"})}),(0,s.jsx)(n.td,{children:"API key for authentication"}),(0,s.jsx)(n.td,{children:"-"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AETERNA_PROJECT"})}),(0,s.jsx)(n.td,{children:"Project name override"}),(0,s.jsx)(n.td,{children:"From config"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AETERNA_DEBUG"})}),(0,s.jsx)(n.td,{children:"Enable debug logging"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"false"})})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"opencodejsonc",children:(0,s.jsx)(n.code,{children:"opencode.jsonc"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsonc",children:'{\n  "$schema": "https://opencode.ai/config.json",\n  \n  // NPM Plugin configuration\n  "plugin": ["@kiko-aeterna/opencode-plugin"],\n  \n  // Plugin-specific options\n  "pluginConfig": {\n    "@kiko-aeterna/opencode-plugin": {\n      "capture": {\n        "enabled": true,\n        "sensitivity": "medium"\n      },\n      "knowledge": {\n        "injectionEnabled": true,\n        "maxItems": 3\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,s.jsx)(n.h4,{id:"plugin-not-loading",children:"Plugin Not Loading"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Error: Cannot find module '@kiko-aeterna/opencode-plugin'\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm install -D @kiko-aeterna/opencode-plugin\n# Verify in package.json\n"})}),"\n",(0,s.jsx)(n.h4,{id:"connection-refused",children:"Connection Refused"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Error: ECONNREFUSED 127.0.0.1:8080\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Ensure Aeterna server is running: ",(0,s.jsx)(n.code,{children:"aeterna serve"})]}),"\n",(0,s.jsxs)(n.li,{children:["Check ",(0,s.jsx)(n.code,{children:"AETERNA_SERVER_URL"})," environment variable"]}),"\n",(0,s.jsx)(n.li,{children:"Verify firewall settings"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"knowledge-not-injecting",children:"Knowledge Not Injecting"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Symptoms:"})," AI doesn't mention ADRs or policies"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Diagnosis:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'// Check configuration\nconst config = await client.getConfig()\nconsole.log(config.knowledge.injectionEnabled) // Should be true\n\n// Check threshold\nconst results = await client.knowledgeQuery({ query: "test" })\nconsole.log(results) // Should have items above threshold\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Lower ",(0,s.jsx)(n.code,{children:"knowledge.threshold"})," in config"]}),"\n",(0,s.jsxs)(n.li,{children:["Verify knowledge items exist: ",(0,s.jsx)(n.code,{children:"aeterna knowledge list"})]}),"\n",(0,s.jsx)(n.li,{children:"Check semantic similarity with your queries"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"memories-not-capturing",children:"Memories Not Capturing"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Symptoms:"})," Tool executions not appearing in memory"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Diagnosis:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Check capture settings\ncat .aeterna/config.toml | grep capture\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Set ",(0,s.jsx)(n.code,{children:"capture.enabled = true"})]}),"\n",(0,s.jsxs)(n.li,{children:["Increase ",(0,s.jsx)(n.code,{children:"capture.sensitivity"})]}),"\n",(0,s.jsx)(n.li,{children:"Verify working memory storage is configured"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"permission-denied-for-proposals",children:"Permission Denied for Proposals"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Error: You don't have permission to propose knowledge items\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Solutions:"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Check your role: ",(0,s.jsx)(n.code,{children:"aeterna whoami"})]}),"\n",(0,s.jsx)(n.li,{children:"Contact tech lead for elevated permissions"}),"\n",(0,s.jsx)(n.li,{children:"Verify Cedar policy allows your role"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"debug-mode",children:"Debug Mode"}),"\n",(0,s.jsx)(n.p,{children:"Enable verbose logging:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"AETERNA_DEBUG=true opencode\n"})}),"\n",(0,s.jsx)(n.p,{children:"Or in config:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:'[debug]\nenabled = true\nlog_level = "trace"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"health-check",children:"Health Check"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Check Aeterna connectivity\nnpx aeterna health\n\n# Expected output:\n# \u2713 Server: http://localhost:8080 (healthy)\n# \u2713 Memory: Qdrant connection OK\n# \u2713 Knowledge: Git repository accessible\n# \u2713 Governance: Cedar policies loaded\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/aeterna/docs/integrations/mcp-server",children:"MCP Server Setup"})," - For remote deployments"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/aeterna/docs/examples/strangler-fig-migration",children:"Strangler Fig Example"})," - Real-world usage"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"../../specs/06-tool-interface.md",children:"Tool Interface Specification"})," - Detailed tool contracts"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>i,x:()=>a});var t=r(6540);const s={},o=t.createContext(s);function i(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);