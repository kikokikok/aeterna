"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[1533],{5294(e,r,t){t.r(r),t.d(r,{assets:()=>i,contentTitle:()=>c,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"helm/external-secrets","title":"External Secrets Operator Integration","description":"Use the External Secrets Operator (ESO) to sync secrets from external providers into Kubernetes.","source":"@site/docs/helm/external-secrets.md","sourceDirName":"helm","slug":"/helm/external-secrets","permalink":"/aeterna/docs/helm/external-secrets","draft":false,"unlisted":false,"editUrl":"https://github.com/kikokikok/aeterna/tree/main/website/docs/helm/external-secrets.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Security Best Practices","permalink":"/aeterna/docs/helm/security"},"next":{"title":"SOPS Secrets Management","permalink":"/aeterna/docs/helm/sops-secrets"}}');var n=t(4848),a=t(8453);const l={},c="External Secrets Operator Integration",i={},o=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Enabling External Secrets",id:"enabling-external-secrets",level:2},{value:"AWS Secrets Manager",id:"aws-secrets-manager",level:2},{value:"Create a ClusterSecretStore",id:"create-a-clustersecretstore",level:3},{value:"Store secrets in AWS",id:"store-secrets-in-aws",level:3},{value:"Reference in values",id:"reference-in-values",level:3},{value:"HashiCorp Vault",id:"hashicorp-vault",level:2},{value:"Create a ClusterSecretStore",id:"create-a-clustersecretstore-1",level:3},{value:"Store secrets in Vault",id:"store-secrets-in-vault",level:3},{value:"Reference in values",id:"reference-in-values-1",level:3},{value:"Azure Key Vault",id:"azure-key-vault",level:2},{value:"Create a ClusterSecretStore",id:"create-a-clustersecretstore-2",level:3},{value:"Store secrets in Azure Key Vault",id:"store-secrets-in-azure-key-vault",level:3},{value:"Reference in values",id:"reference-in-values-2",level:3},{value:"Verifying",id:"verifying",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"external-secrets-operator-integration",children:"External Secrets Operator Integration"})}),"\n",(0,n.jsxs)(r.p,{children:["Use the ",(0,n.jsx)(r.a,{href:"https://external-secrets.io/",children:"External Secrets Operator"})," (ESO) to sync secrets from external providers into Kubernetes."]}),"\n",(0,n.jsx)(r.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"External Secrets Operator installed in the cluster"}),"\n",(0,n.jsxs)(r.li,{children:["A configured ",(0,n.jsx)(r.code,{children:"SecretStore"})," or ",(0,n.jsx)(r.code,{children:"ClusterSecretStore"})]}),"\n"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"helm repo add external-secrets https://charts.external-secrets.io\nhelm install external-secrets external-secrets/external-secrets -n external-secrets --create-namespace\n"})}),"\n",(0,n.jsx)(r.h2,{id:"enabling-external-secrets",children:"Enabling External Secrets"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",children:'secrets:\n  provider: external-secrets\n  externalSecrets:\n    enabled: true\n    refreshInterval: "1h"\n    secretStoreRef:\n      name: my-secret-store\n      kind: ClusterSecretStore\n    remoteRefs:\n      postgresqlPassword: "path/to/postgres-password"\n      redisPassword: "path/to/redis-password"\n      opalMasterToken: "path/to/opal-token"\n      llmApiKey: "path/to/llm-api-key"\n'})}),"\n",(0,n.jsxs)(r.p,{children:["This creates an ",(0,n.jsx)(r.code,{children:"ExternalSecret"})," resource that syncs the referenced keys into a Kubernetes secret consumed by Aeterna."]}),"\n",(0,n.jsx)(r.h2,{id:"aws-secrets-manager",children:"AWS Secrets Manager"}),"\n",(0,n.jsx)(r.h3,{id:"create-a-clustersecretstore",children:"Create a ClusterSecretStore"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",children:"apiVersion: external-secrets.io/v1beta1\nkind: ClusterSecretStore\nmetadata:\n  name: aws-secrets-manager\nspec:\n  provider:\n    aws:\n      service: SecretsManager\n      region: us-east-1\n      auth:\n        jwt:\n          serviceAccountRef:\n            name: external-secrets-sa\n            namespace: external-secrets\n"})}),"\n",(0,n.jsx)(r.h3,{id:"store-secrets-in-aws",children:"Store secrets in AWS"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:'aws secretsmanager create-secret --name aeterna/postgres-password --secret-string "my-password"\naws secretsmanager create-secret --name aeterna/llm-api-key --secret-string "sk-..."\n'})}),"\n",(0,n.jsx)(r.h3,{id:"reference-in-values",children:"Reference in values"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",children:'secrets:\n  provider: external-secrets\n  externalSecrets:\n    enabled: true\n    secretStoreRef:\n      name: aws-secrets-manager\n      kind: ClusterSecretStore\n    remoteRefs:\n      postgresqlPassword: "aeterna/postgres-password"\n      llmApiKey: "aeterna/llm-api-key"\n'})}),"\n",(0,n.jsx)(r.h2,{id:"hashicorp-vault",children:"HashiCorp Vault"}),"\n",(0,n.jsx)(r.h3,{id:"create-a-clustersecretstore-1",children:"Create a ClusterSecretStore"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",children:'apiVersion: external-secrets.io/v1beta1\nkind: ClusterSecretStore\nmetadata:\n  name: vault-backend\nspec:\n  provider:\n    vault:\n      server: "https://vault.example.com"\n      path: "secret"\n      version: "v2"\n      auth:\n        kubernetes:\n          mountPath: "kubernetes"\n          role: "aeterna"\n          serviceAccountRef:\n            name: external-secrets-sa\n            namespace: external-secrets\n'})}),"\n",(0,n.jsx)(r.h3,{id:"store-secrets-in-vault",children:"Store secrets in Vault"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:'vault kv put secret/aeterna postgres-password="my-password" llm-api-key="sk-..."\n'})}),"\n",(0,n.jsx)(r.h3,{id:"reference-in-values-1",children:"Reference in values"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",children:'secrets:\n  provider: external-secrets\n  externalSecrets:\n    enabled: true\n    secretStoreRef:\n      name: vault-backend\n      kind: ClusterSecretStore\n    remoteRefs:\n      postgresqlPassword: "aeterna#postgres-password"\n      llmApiKey: "aeterna#llm-api-key"\n'})}),"\n",(0,n.jsx)(r.h2,{id:"azure-key-vault",children:"Azure Key Vault"}),"\n",(0,n.jsx)(r.h3,{id:"create-a-clustersecretstore-2",children:"Create a ClusterSecretStore"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",children:'apiVersion: external-secrets.io/v1beta1\nkind: ClusterSecretStore\nmetadata:\n  name: azure-keyvault\nspec:\n  provider:\n    azurekv:\n      tenantId: "your-tenant-id"\n      vaultUrl: "https://my-vault.vault.azure.net"\n      authType: ManagedIdentity\n      identityId: "your-managed-identity-client-id"\n'})}),"\n",(0,n.jsx)(r.h3,{id:"store-secrets-in-azure-key-vault",children:"Store secrets in Azure Key Vault"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:'az keyvault secret set --vault-name my-vault --name aeterna-postgres-password --value "my-password"\naz keyvault secret set --vault-name my-vault --name aeterna-llm-api-key --value "sk-..."\n'})}),"\n",(0,n.jsx)(r.h3,{id:"reference-in-values-2",children:"Reference in values"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-yaml",children:'secrets:\n  provider: external-secrets\n  externalSecrets:\n    enabled: true\n    secretStoreRef:\n      name: azure-keyvault\n      kind: ClusterSecretStore\n    remoteRefs:\n      postgresqlPassword: "aeterna-postgres-password"\n      llmApiKey: "aeterna-llm-api-key"\n'})}),"\n",(0,n.jsx)(r.h2,{id:"verifying",children:"Verifying"}),"\n",(0,n.jsx)(r.p,{children:"Check that the ExternalSecret synced:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"kubectl get externalsecret\nkubectl get secret aeterna-external -o yaml\n"})}),"\n",(0,n.jsx)(r.p,{children:"Troubleshoot sync failures:"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-bash",children:"kubectl describe externalsecret aeterna\n"})})]})}function u(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453(e,r,t){t.d(r,{R:()=>l,x:()=>c});var s=t(6540);const n={},a=s.createContext(n);function l(e){const r=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:l(e.components),s.createElement(a.Provider,{value:r},e.children)}}}]);