"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[2085],{9787(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"specs/knowledge-repository","title":"Knowledge Repository Specification","description":"This document specifies the Knowledge Repository component: a versioned, Git-based store for organizational decisions, policies, patterns, and specifications.","source":"@site/docs/specs/03-knowledge-repository.md","sourceDirName":"specs","slug":"/specs/knowledge-repository","permalink":"/aeterna/docs/specs/knowledge-repository","draft":false,"unlisted":false,"editUrl":"https://github.com/kikokikok/aeterna/tree/main/website/docs/specs/03-knowledge-repository.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Knowledge Repository Specification","status":"draft","version":"0.1.0","created":"2025-01-07T00:00:00.000Z","authors":["AI Systems Architecture Team"],"related":["01-core-concepts.md","04-memory-knowledge-sync.md","05-adapter-architecture.md"]},"sidebar":"docs","previous":{"title":"Memory System Specification","permalink":"/aeterna/docs/specs/memory-system"},"next":{"title":"Memory-Knowledge Sync Specification","permalink":"/aeterna/docs/specs/memory-knowledge-sync"}}');var s=t(4848),r=t(8453);const o={title:"Knowledge Repository Specification",status:"draft",version:"0.1.0",created:new Date("2025-01-07T00:00:00.000Z"),authors:["AI Systems Architecture Team"],related:["01-core-concepts.md","04-memory-knowledge-sync.md","05-adapter-architecture.md"]},a="Knowledge Repository Specification",l={},d=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Overview",id:"overview",level:2},{value:"Knowledge Types",id:"knowledge-types",level:2},{value:"The Four Knowledge Types",id:"the-four-knowledge-types",level:3},{value:"Type Characteristics",id:"type-characteristics",level:3},{value:"Type Definitions",id:"type-definitions",level:3},{value:"Knowledge Item Schema",id:"knowledge-item-schema",level:2},{value:"Core Schema",id:"core-schema",level:3},{value:"Knowledge Layer Hierarchy",id:"knowledge-layer-hierarchy",level:3},{value:"Example Knowledge Items",id:"example-knowledge-items",level:3},{value:"ADR Example",id:"adr-example",level:4},{value:"Operator Semantics",id:"operator-semantics",level:3},{value:"Constraint Evaluation",id:"constraint-evaluation",level:3},{value:"Evaluation Algorithm",id:"evaluation-algorithm",level:3},{value:"Severity Behavior",id:"severity-behavior",level:3},{value:"Repository Structure",id:"repository-structure",level:2},{value:"Directory Layout",id:"directory-layout",level:3},{value:"Manifest Schema",id:"manifest-schema",level:3},{value:"Example Manifest",id:"example-manifest",level:3},{value:"Versioning Model",id:"versioning-model",level:2},{value:"Commit Schema",id:"commit-schema",level:3},{value:"Version History",id:"version-history",level:3},{value:"Immutability Rules",id:"immutability-rules",level:3},{value:"Multi-Tenant Federation",id:"multi-tenant-federation",level:2},{value:"Federation Model",id:"federation-model",level:3},{value:"Federation Config",id:"federation-config",level:3},{value:"Sync Algorithm",id:"sync-algorithm",level:3},{value:"Layer Precedence in Federation",id:"layer-precedence-in-federation",level:3},{value:"Core Operations",id:"core-operations",level:2},{value:"Operation: Query Knowledge",id:"operation-query-knowledge",level:3},{value:"Operation: Get Knowledge Item",id:"operation-get-knowledge-item",level:3},{value:"Operation: Check Constraints",id:"operation-check-constraints",level:3},{value:"Operation: Propose Knowledge",id:"operation-propose-knowledge",level:3},{value:"Operation: Update Knowledge Status",id:"operation-update-knowledge-status",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Error Response Format",id:"error-response-format",level:3},{value:"Valid Status Transitions",id:"valid-status-transitions",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"knowledge-repository-specification",children:"Knowledge Repository Specification"})}),"\n",(0,s.jsx)(n.p,{children:"This document specifies the Knowledge Repository component: a versioned, Git-based store for organizational decisions, policies, patterns, and specifications."}),"\n",(0,s.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#overview",children:"Overview"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#knowledge-types",children:"Knowledge Types"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#knowledge-item-schema",children:"Knowledge Item Schema"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#constraint-dsl",children:"Constraint DSL"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#repository-structure",children:"Repository Structure"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#versioning-model",children:"Versioning Model"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#multi-tenant-federation",children:"Multi-Tenant Federation"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#core-operations",children:"Core Operations"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#error-handling",children:"Error Handling"})}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"The Knowledge Repository provides:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Structured storage"}),": Typed artifacts (ADRs, policies, patterns, specs)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Git-based versioning"}),": Full audit trail, immutable commits"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Constraint enforcement"}),": Declarative rules guiding agent behavior"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Multi-tenant federation"}),": Company \u2192 Org \u2192 Team \u2192 Project layers"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   KNOWLEDGE REPOSITORY                           \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502                 Knowledge Manager                        \u2502    \u2502\n\u2502  \u2502  \u2022 Coordinates all knowledge operations                  \u2502    \u2502\n\u2502  \u2502  \u2022 Enforces schema validation                            \u2502    \u2502\n\u2502  \u2502  \u2022 Routes to appropriate layer                           \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                              \u2502                                   \u2502\n\u2502                              \u25bc                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502                 Constraint Engine                        \u2502    \u2502\n\u2502  \u2502  \u2022 Parses constraint DSL                                 \u2502    \u2502\n\u2502  \u2502  \u2022 Evaluates constraints against context                 \u2502    \u2502\n\u2502  \u2502  \u2022 Reports violations by severity                        \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                              \u2502                                   \u2502\n\u2502                              \u25bc                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502                  Version Manager                         \u2502    \u2502\n\u2502  \u2502  \u2022 Creates immutable commits                             \u2502    \u2502\n\u2502  \u2502  \u2022 Manages manifest index                                \u2502    \u2502\n\u2502  \u2502  \u2022 Handles federation sync                               \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                              \u2502                                   \u2502\n\u2502                              \u25bc                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502                   Git Backend                            \u2502    \u2502\n\u2502  \u2502  \u2022 Persists to Git repository                            \u2502    \u2502\n\u2502  \u2502  \u2022 Handles branching and merging                         \u2502    \u2502\n\u2502  \u2502  \u2022 Supports local and remote repos                       \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"knowledge-types",children:"Knowledge Types"}),"\n",(0,s.jsx)(n.h3,{id:"the-four-knowledge-types",children:"The Four Knowledge Types"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                                                                  \u2502\n\u2502  TYPE        PURPOSE                       EXAMPLES              \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                                  \u2502\n\u2502  adr         Architecture Decision         "Use PostgreSQL"     \u2502\n\u2502              Records                        "Adopt microservices"\u2502\n\u2502                                                                  \u2502\n\u2502  policy      Organizational rules           "No console.log"     \u2502\n\u2502              and constraints               "PR reviews required" \u2502\n\u2502                                                                  \u2502\n\u2502  pattern     Reusable solutions            "Error handling"      \u2502\n\u2502              and best practices            "API response format" \u2502\n\u2502                                                                  \u2502\n\u2502  spec        Technical specifications       "API contract"       \u2502\n\u2502              and contracts                  "Data schema"        \u2502\n\u2502                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n'})}),"\n",(0,s.jsx)(n.h3,{id:"type-characteristics",children:"Type Characteristics"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Immutable"}),(0,s.jsx)(n.th,{children:"Has Constraints"}),(0,s.jsx)(n.th,{children:"Supersedes"}),(0,s.jsx)(n.th,{children:"Typical Size"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"adr"})}),(0,s.jsx)(n.td,{children:"Yes (decisions are final)"}),(0,s.jsx)(n.td,{children:"Often"}),(0,s.jsx)(n.td,{children:"Previous ADRs"}),(0,s.jsx)(n.td,{children:"Medium"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"policy"})}),(0,s.jsx)(n.td,{children:"No (can be updated)"}),(0,s.jsx)(n.td,{children:"Always"}),(0,s.jsx)(n.td,{children:"-"}),(0,s.jsx)(n.td,{children:"Small"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"pattern"})}),(0,s.jsx)(n.td,{children:"No (evolves)"}),(0,s.jsx)(n.td,{children:"Sometimes"}),(0,s.jsx)(n.td,{children:"-"}),(0,s.jsx)(n.td,{children:"Large"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"spec"})}),(0,s.jsx)(n.td,{children:"Yes (versioned)"}),(0,s.jsx)(n.td,{children:"Sometimes"}),(0,s.jsx)(n.td,{children:"Previous versions"}),(0,s.jsx)(n.td,{children:"Large"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"type-definitions",children:"Type Definitions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"type KnowledgeType = 'adr' | 'policy' | 'pattern' | 'spec';\n\ninterface KnowledgeTypeConfig {\n  /** Human-readable name */\n  displayName: string;\n  \n  /** Description of this type */\n  description: string;\n  \n  /** Whether items of this type can be updated (vs superseded) */\n  allowUpdates: boolean;\n  \n  /** Required fields for this type */\n  requiredFields: string[];\n  \n  /** File extension for this type */\n  fileExtension: string;\n}\n\nconst knowledgeTypeConfigs: Record<KnowledgeType, KnowledgeTypeConfig> = {\n  adr: {\n    displayName: 'Architecture Decision Record',\n    description: 'Documents significant architectural decisions',\n    allowUpdates: false, // Supersede instead\n    requiredFields: ['context', 'decision', 'consequences'],\n    fileExtension: '.md'\n  },\n  policy: {\n    displayName: 'Policy',\n    description: 'Organizational rules and guidelines',\n    allowUpdates: true,\n    requiredFields: ['scope', 'rules'],\n    fileExtension: '.md'\n  },\n  pattern: {\n    displayName: 'Pattern',\n    description: 'Reusable solutions and best practices',\n    allowUpdates: true,\n    requiredFields: ['problem', 'solution'],\n    fileExtension: '.md'\n  },\n  spec: {\n    displayName: 'Specification',\n    description: 'Technical specifications and contracts',\n    allowUpdates: false, // Version instead\n    requiredFields: ['version'],\n    fileExtension: '.md'\n  }\n};\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"knowledge-item-schema",children:"Knowledge Item Schema"}),"\n",(0,s.jsx)(n.h3,{id:"core-schema",children:"Core Schema"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"/**\n * A single knowledge item in the repository.\n */\ninterface KnowledgeItem {\n  /** Unique identifier (e.g., \"adr-042-database-selection\") */\n  id: string;\n  \n  /** Knowledge type */\n  type: KnowledgeType;\n  \n  /** Layer this item belongs to */\n  layer: KnowledgeLayer;\n  \n  /** Human-readable title */\n  title: string;\n  \n  /** Brief summary (for memory pointer) */\n  summary: string;\n  \n  /** Full content (Markdown) */\n  content: string;\n  \n  /** SHA-256 hash of content */\n  contentHash: string;\n  \n  /** Status in lifecycle */\n  status: KnowledgeStatus;\n  \n  /** Severity for constraint enforcement */\n  severity: ConstraintSeverity;\n  \n  /** Attached constraints */\n  constraints: Constraint[];\n  \n  /** Tags for categorization */\n  tags: string[];\n  \n  /** Metadata */\n  metadata: KnowledgeMetadata;\n  \n  /** Creation timestamp */\n  createdAt: string;\n  \n  /** Last update timestamp */\n  updatedAt: string;\n  \n  /** Version number (for specs) */\n  version?: string;\n  \n  /** ID of superseded item (for ADRs) */\n  supersedes?: string;\n  \n  /** IDs of items that supersede this one */\n  supersededBy?: string[];\n}\n\ntype KnowledgeLayer = 'company' | 'org' | 'team' | 'project';\n\ntype KnowledgeStatus = \n  | 'draft'      // Work in progress\n  | 'proposed'   // Ready for review\n  | 'accepted'   // Approved and active\n  | 'deprecated' // No longer recommended\n  | 'superseded' // Replaced by another item\n  | 'rejected';  // Not accepted\n\ntype ConstraintSeverity = \n  | 'info'   // Informational, no enforcement\n  | 'warn'   // Warning, can be overridden\n  | 'block'; // Blocking, must be followed\n\ninterface KnowledgeMetadata {\n  /** Authors */\n  authors?: string[];\n  \n  /** Reviewers who approved */\n  reviewers?: string[];\n  \n  /** Related items */\n  relatedItems?: string[];\n  \n  /** External references */\n  references?: string[];\n  \n  /** Custom fields */\n  [key: string]: unknown;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"knowledge-layer-hierarchy",children:"Knowledge Layer Hierarchy"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                                                                  \u2502\n\u2502  LAYER       SCOPE                  EXAMPLES                     \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                                  \u2502\n\u2502  company     Entire company         "All code must be typed"    \u2502\n\u2502     \u2502        (least specific)       "Security policy"           \u2502\n\u2502     \u2502                                                            \u2502\n\u2502  org         Business unit          "Use React for frontend"    \u2502\n\u2502     \u2502                               "API versioning scheme"     \u2502\n\u2502     \u2502                                                            \u2502\n\u2502  team        Team scope             "Code review checklist"     \u2502\n\u2502     \u2502                               "Sprint ceremonies"         \u2502\n\u2502     \u2502                                                            \u2502\n\u2502  project     Single project         "Project-specific ADRs"     \u2502\n\u2502              (most specific)        "Local conventions"         \u2502\n\u2502                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-knowledge-items",children:"Example Knowledge Items"}),"\n",(0,s.jsx)(n.h4,{id:"adr-example",children:"ADR Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'---\nid: adr-042-database-selection\ntype: adr\nlayer: org\ntitle: Database Selection for New Services\nsummary: Use PostgreSQL for all new services requiring relational data storage\nstatus: accepted\nseverity: block\ntags: [database, infrastructure, architecture]\nmetadata:\n  authors: [alice@company.com]\n  reviewers: [bob@company.com, charlie@company.com]\n  relatedItems: [adr-015-data-layer]\ncreatedAt: "2025-01-07T10:00:00Z"\nupdatedAt: "2025-01-07T10:00:00Z"\n---\n\n## Context\n\nWe need to standardize on a relational database for new services. Currently, teams use MySQL, PostgreSQL, and SQLite inconsistently.\n\n## Decision\n\nWe will use **PostgreSQL** for all new services requiring relational data storage.\n\n## Rationale\n\n1. Superior JSON support for semi-structured data\n2. Better performance for complex queries\n3. Strong community and ecosystem\n4. Existing operational expertise\n\n## Consequences\n\n### Positive\n- Consistent tooling and operations\n- Easier cross-service data integration\n- Reduced training burden\n\n### Negative\n- Teams with MySQL expertise need to learn PostgreSQL\n- Some existing services will remain on MySQL\n\n## Constraints\n\n```yaml\nconstraints:\n  - operator: must_use\n    target: dependency\n    pattern: "postgresql|pg|postgres"\n    severity: block\n    message: "Use PostgreSQL for relational data per ADR-042"\n  - operator: must_not_use\n    target: dependency\n    pattern: "mysql|mysql2|mariadb"\n    severity: block\n    message: "MySQL not allowed for new services per ADR-042"\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'\n#### Policy Example\n\n```yaml\n---\nid: policy-no-console-log\ntype: policy\nlayer: company\ntitle: No Console.log in Production Code\nsummary: Console.log statements must be removed before merging to main\nstatus: accepted\nseverity: warn\ntags: [logging, code-quality]\nmetadata:\n  authors: [security-team@company.com]\ncreatedAt: "2025-01-01T00:00:00Z"\nupdatedAt: "2025-01-07T00:00:00Z"\n---\n\n## Scope\n\nAll production code in any language that has console/print debugging.\n\n## Rules\n\n1. No `console.log()` in JavaScript/TypeScript production code\n2. No `print()` debugging in Python production code\n3. Use proper logging frameworks with log levels\n\n## Exceptions\n\n- Test files (*.test.ts, *_test.py)\n- Development-only scripts\n- CLI tools intended for local use\n\n## Constraints\n\n```yaml\nconstraints:\n  - operator: must_not_match\n    target: code\n    pattern: "console\\\\.log\\\\("\n    appliesTo: ["*.ts", "*.js"]\n    severity: warn\n    message: "Remove console.log before merging (use logger instead)"\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\n---\n\n## Constraint DSL\n\n### Constraint Schema\n\n```typescript\n/**\n * A constraint attached to a knowledge item.\n */\ninterface Constraint {\n  /** Constraint operator */\n  operator: ConstraintOperator;\n  \n  /** What the constraint targets */\n  target: ConstraintTarget;\n  \n  /** Pattern to match (regex or glob depending on target) */\n  pattern: string;\n  \n  /** File patterns this applies to (glob) */\n  appliesTo?: string[];\n  \n  /** Severity of violation */\n  severity: ConstraintSeverity;\n  \n  /** Human-readable message on violation */\n  message?: string;\n}\n\ntype ConstraintOperator =\n  | 'must_use'       // Pattern MUST be present\n  | 'must_not_use'   // Pattern MUST NOT be present\n  | 'must_match'     // Content MUST match pattern\n  | 'must_not_match' // Content MUST NOT match pattern\n  | 'must_exist'     // File/path MUST exist\n  | 'must_not_exist';// File/path MUST NOT exist\n\ntype ConstraintTarget =\n  | 'file'       // File paths\n  | 'code'       // Code content\n  | 'dependency' // Package dependencies\n  | 'import'     // Import statements\n  | 'config';    // Configuration files\n"})}),"\n",(0,s.jsx)(n.h3,{id:"operator-semantics",children:"Operator Semantics"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Operator"}),(0,s.jsx)(n.th,{children:"Target"}),(0,s.jsx)(n.th,{children:"Pattern"}),(0,s.jsx)(n.th,{children:"Passes When"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"must_use"})}),(0,s.jsx)(n.td,{children:"dependency"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"postgresql"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"postgresql"})," is in dependencies"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"must_not_use"})}),(0,s.jsx)(n.td,{children:"dependency"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"mysql"})}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"mysql"})," is NOT in dependencies"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"must_match"})}),(0,s.jsx)(n.td,{children:"code"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"^import.*from ['\"]@company/"})}),(0,s.jsx)(n.td,{children:"All imports from @company/*"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"must_not_match"})}),(0,s.jsx)(n.td,{children:"code"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"console\\.log\\("})}),(0,s.jsx)(n.td,{children:"No console.log statements"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"must_exist"})}),(0,s.jsx)(n.td,{children:"file"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"README.md"})}),(0,s.jsx)(n.td,{children:"README.md exists"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"must_not_exist"})}),(0,s.jsx)(n.td,{children:"file"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:".env.local"})}),(0,s.jsx)(n.td,{children:".env.local not committed"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"constraint-evaluation",children:"Constraint Evaluation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface ConstraintContext {\n  /** Files being checked */\n  files: FileInfo[];\n  \n  /** Dependencies from package.json/requirements.txt/etc */\n  dependencies: DependencyInfo[];\n  \n  /** Current layer identifiers */\n  layerIdentifiers: {\n    companyId?: string;\n    orgId?: string;\n    teamId?: string;\n    projectId?: string;\n  };\n}\n\ninterface FileInfo {\n  path: string;\n  content: string;\n}\n\ninterface DependencyInfo {\n  name: string;\n  version: string;\n  type: 'production' | 'development';\n}\n\ninterface ConstraintViolation {\n  /** The constraint that was violated */\n  constraint: Constraint;\n  \n  /** Knowledge item the constraint came from */\n  knowledgeItemId: string;\n  \n  /** Where the violation occurred */\n  location?: {\n    file: string;\n    line?: number;\n    column?: number;\n  };\n  \n  /** Severity of this violation */\n  severity: ConstraintSeverity;\n  \n  /** Human-readable message */\n  message: string;\n}\n\ninterface ConstraintCheckResult {\n  /** Whether all constraints passed */\n  passed: boolean;\n  \n  /** All violations found */\n  violations: ConstraintViolation[];\n  \n  /** Violations by severity */\n  summary: {\n    info: number;\n    warn: number;\n    block: number;\n  };\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"evaluation-algorithm",children:"Evaluation Algorithm"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"function evaluateConstraints(\n  constraints: Constraint[],\n  context: ConstraintContext\n): ConstraintCheckResult {\n  const violations: ConstraintViolation[] = [];\n  \n  for (const constraint of constraints) {\n    const applicableFiles = constraint.appliesTo\n      ? context.files.filter(f => matchGlob(f.path, constraint.appliesTo!))\n      : context.files;\n    \n    switch (constraint.target) {\n      case 'dependency':\n        evaluateDependencyConstraint(constraint, context.dependencies, violations);\n        break;\n      case 'code':\n        evaluateCodeConstraint(constraint, applicableFiles, violations);\n        break;\n      case 'file':\n        evaluateFileConstraint(constraint, context.files, violations);\n        break;\n      case 'import':\n        evaluateImportConstraint(constraint, applicableFiles, violations);\n        break;\n      case 'config':\n        evaluateConfigConstraint(constraint, context.files, violations);\n        break;\n    }\n  }\n  \n  return {\n    passed: violations.filter(v => v.severity === 'block').length === 0,\n    violations,\n    summary: {\n      info: violations.filter(v => v.severity === 'info').length,\n      warn: violations.filter(v => v.severity === 'warn').length,\n      block: violations.filter(v => v.severity === 'block').length\n    }\n  };\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"severity-behavior",children:"Severity Behavior"}),"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Severity"}),(0,s.jsx)(n.th,{children:"On Violation"}),(0,s.jsx)(n.th,{children:"Agent Behavior"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"info"})}),(0,s.jsx)(n.td,{children:"Log message"}),(0,s.jsx)(n.td,{children:"Continue normally"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"warn"})}),(0,s.jsx)(n.td,{children:"Show warning"}),(0,s.jsx)(n.td,{children:"Continue with caution, may prompt user"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"block"})}),(0,s.jsx)(n.td,{children:"Raise error"}),(0,s.jsx)(n.td,{children:"Stop action, explain constraint, suggest fix"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"repository-structure",children:"Repository Structure"}),"\n",(0,s.jsx)(n.h3,{id:"directory-layout",children:"Directory Layout"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"knowledge-repo/\n\u251c\u2500\u2500 manifest.json           # Index of all items\n\u251c\u2500\u2500 company/                # Company-wide knowledge\n\u2502   \u251c\u2500\u2500 adrs/\n\u2502   \u2502   \u2514\u2500\u2500 adr-001-*.md\n\u2502   \u251c\u2500\u2500 policies/\n\u2502   \u2502   \u2514\u2500\u2500 policy-*.md\n\u2502   \u251c\u2500\u2500 patterns/\n\u2502   \u2502   \u2514\u2500\u2500 pattern-*.md\n\u2502   \u2514\u2500\u2500 specs/\n\u2502       \u2514\u2500\u2500 spec-*.md\n\u251c\u2500\u2500 orgs/                   # Organization-specific\n\u2502   \u2514\u2500\u2500 {orgId}/\n\u2502       \u251c\u2500\u2500 adrs/\n\u2502       \u251c\u2500\u2500 policies/\n\u2502       \u251c\u2500\u2500 patterns/\n\u2502       \u2514\u2500\u2500 specs/\n\u251c\u2500\u2500 teams/                  # Team-specific\n\u2502   \u2514\u2500\u2500 {teamId}/\n\u2502       \u251c\u2500\u2500 adrs/\n\u2502       \u251c\u2500\u2500 policies/\n\u2502       \u251c\u2500\u2500 patterns/\n\u2502       \u2514\u2500\u2500 specs/\n\u2514\u2500\u2500 projects/               # Project-specific\n    \u2514\u2500\u2500 {projectId}/\n        \u251c\u2500\u2500 adrs/\n        \u251c\u2500\u2500 policies/\n        \u251c\u2500\u2500 patterns/\n        \u2514\u2500\u2500 specs/\n"})}),"\n",(0,s.jsx)(n.h3,{id:"manifest-schema",children:"Manifest Schema"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface KnowledgeManifest {\n  /** Manifest version */\n  version: '1.0';\n  \n  /** Generation timestamp */\n  generatedAt: string;\n  \n  /** Git commit hash */\n  commitHash: string;\n  \n  /** All items by ID */\n  items: Record<string, ManifestEntry>;\n  \n  /** Items grouped by layer */\n  byLayer: Record<KnowledgeLayer, string[]>;\n  \n  /** Items grouped by type */\n  byType: Record<KnowledgeType, string[]>;\n  \n  /** Items grouped by status */\n  byStatus: Record<KnowledgeStatus, string[]>;\n}\n\ninterface ManifestEntry {\n  /** Item ID */\n  id: string;\n  \n  /** Item type */\n  type: KnowledgeType;\n  \n  /** Item layer */\n  layer: KnowledgeLayer;\n  \n  /** File path relative to repo root */\n  path: string;\n  \n  /** Item title */\n  title: string;\n  \n  /** Item summary */\n  summary: string;\n  \n  /** Current status */\n  status: KnowledgeStatus;\n  \n  /** Content hash for change detection */\n  contentHash: string;\n  \n  /** Whether item has constraints */\n  hasConstraints: boolean;\n  \n  /** Constraint count by severity */\n  constraintSeverity?: {\n    info: number;\n    warn: number;\n    block: number;\n  };\n  \n  /** Tags */\n  tags: string[];\n  \n  /** Last modified timestamp */\n  updatedAt: string;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"example-manifest",children:"Example Manifest"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "version": "1.0",\n  "generatedAt": "2025-01-07T12:00:00Z",\n  "commitHash": "abc123def456",\n  "items": {\n    "adr-042-database-selection": {\n      "id": "adr-042-database-selection",\n      "type": "adr",\n      "layer": "org",\n      "path": "orgs/engineering/adrs/adr-042-database-selection.md",\n      "title": "Database Selection for New Services",\n      "summary": "Use PostgreSQL for all new services",\n      "status": "accepted",\n      "contentHash": "sha256:abc123...",\n      "hasConstraints": true,\n      "constraintSeverity": {\n        "info": 0,\n        "warn": 0,\n        "block": 2\n      },\n      "tags": ["database", "infrastructure"],\n      "updatedAt": "2025-01-07T10:00:00Z"\n    }\n  },\n  "byLayer": {\n    "company": ["policy-security-baseline"],\n    "org": ["adr-042-database-selection"],\n    "team": [],\n    "project": []\n  },\n  "byType": {\n    "adr": ["adr-042-database-selection"],\n    "policy": ["policy-security-baseline"],\n    "pattern": [],\n    "spec": []\n  },\n  "byStatus": {\n    "accepted": ["adr-042-database-selection", "policy-security-baseline"],\n    "draft": [],\n    "proposed": [],\n    "deprecated": [],\n    "superseded": [],\n    "rejected": []\n  }\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"versioning-model",children:"Versioning Model"}),"\n",(0,s.jsx)(n.h3,{id:"commit-schema",children:"Commit Schema"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"/**\n * An immutable commit in the knowledge repository.\n */\ninterface KnowledgeCommit {\n  /** Commit hash */\n  hash: string;\n  \n  /** Parent commit hash (null for initial) */\n  parent: string | null;\n  \n  /** Commit timestamp */\n  timestamp: string;\n  \n  /** Author identifier */\n  author: string;\n  \n  /** Commit message */\n  message: string;\n  \n  /** Type of change */\n  changeType: CommitChangeType;\n  \n  /** Items affected */\n  affectedItems: string[];\n  \n  /** Manifest snapshot at this commit */\n  manifest: KnowledgeManifest;\n}\n\ntype CommitChangeType =\n  | 'create'     // New item added\n  | 'update'     // Existing item modified\n  | 'delete'     // Item removed\n  | 'supersede'  // Item superseded by another\n  | 'status'     // Status change only\n  | 'federation';// Sync from upstream\n"})}),"\n",(0,s.jsx)(n.h3,{id:"version-history",children:"Version History"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                                                                  \u2502\n\u2502  Commit: abc123                                                  \u2502\n\u2502  Parent: def456                                                  \u2502\n\u2502  Author: alice@company.com                                       \u2502\n\u2502  Date:   2025-01-07T10:00:00Z                                   \u2502\n\u2502  Type:   create                                                  \u2502\n\u2502                                                                  \u2502\n\u2502  Message: Add ADR-042: Database Selection                        \u2502\n\u2502                                                                  \u2502\n\u2502  Affected Items:                                                 \u2502\n\u2502    + adr-042-database-selection                                 \u2502\n\u2502                                                                  \u2502\n\u2502  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500  \u2502\n\u2502                                                                  \u2502\n\u2502  Commit: def456                                                  \u2502\n\u2502  Parent: ghi789                                                  \u2502\n\u2502  Author: bob@company.com                                         \u2502\n\u2502  Date:   2025-01-06T15:30:00Z                                   \u2502\n\u2502  Type:   update                                                  \u2502\n\u2502                                                                  \u2502\n\u2502  Message: Update security policy with new requirements           \u2502\n\u2502                                                                  \u2502\n\u2502  Affected Items:                                                 \u2502\n\u2502    ~ policy-security-baseline                                   \u2502\n\u2502                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h3,{id:"immutability-rules",children:"Immutability Rules"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Commits are immutable"}),": Once created, never modified"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Items can be superseded"}),": New item references old one"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"History is append-only"}),": No rebasing or force-push"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Manifest reflects current state"}),": Regenerated on each commit"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"multi-tenant-federation",children:"Multi-Tenant Federation"}),"\n",(0,s.jsx)(n.h3,{id:"federation-model",children:"Federation Model"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                                                                  \u2502\n\u2502                     CENTRAL HUB                                  \u2502\n\u2502                  (company-wide repo)                             \u2502\n\u2502                                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502  company/                                                \u2502    \u2502\n\u2502  \u2502    \u2514\u2500\u2500 policies/                                         \u2502    \u2502\n\u2502  \u2502    \u2514\u2500\u2500 patterns/                                         \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                              \u2502                                   \u2502\n\u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                   \u2502\n\u2502              \u2502               \u2502               \u2502                   \u2502\n\u2502              \u25bc               \u25bc               \u25bc                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502  \u2502   ORG REPO    \u2502 \u2502   ORG REPO    \u2502 \u2502   ORG REPO    \u2502          \u2502\n\u2502  \u2502  (Engineering)\u2502 \u2502   (Product)   \u2502 \u2502   (Platform)  \u2502          \u2502\n\u2502  \u2502               \u2502 \u2502               \u2502 \u2502               \u2502          \u2502\n\u2502  \u2502 orgs/eng/     \u2502 \u2502 orgs/prod/    \u2502 \u2502 orgs/plat/    \u2502          \u2502\n\u2502  \u2502   \u2514\u2500\u2500 adrs/   \u2502 \u2502   \u2514\u2500\u2500 adrs/   \u2502 \u2502   \u2514\u2500\u2500 adrs/   \u2502          \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502          \u2502                                                       \u2502\n\u2502          \u25bc                                                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                               \u2502\n\u2502  \u2502  PROJECT REPO \u2502                                               \u2502\n\u2502  \u2502  (Backend API)\u2502                                               \u2502\n\u2502  \u2502               \u2502                                               \u2502\n\u2502  \u2502 projects/api/ \u2502                                               \u2502\n\u2502  \u2502   \u2514\u2500\u2500 adrs/   \u2502                                               \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                               \u2502\n\u2502                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h3,{id:"federation-config",children:"Federation Config"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'interface FederationConfig {\n  /** Central hub repository */\n  centralHub?: {\n    url: string;\n    branch: string;\n    syncInterval: string; // e.g., "1h", "6h", "1d"\n  };\n  \n  /** Upstream repositories to sync from */\n  upstreams: UpstreamConfig[];\n  \n  /** Layers to accept from each upstream */\n  layerMapping: Record<string, KnowledgeLayer[]>;\n}\n\ninterface UpstreamConfig {\n  /** Unique identifier */\n  id: string;\n  \n  /** Repository URL */\n  url: string;\n  \n  /** Branch to sync */\n  branch: string;\n  \n  /** Layers to pull */\n  layers: KnowledgeLayer[];\n  \n  /** Auto-sync enabled */\n  autoSync: boolean;\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"sync-algorithm",children:"Sync Algorithm"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"async function syncFromUpstream(\n  upstream: UpstreamConfig,\n  localRepo: KnowledgeRepository\n): Promise<SyncResult> {\n  // 1. Fetch upstream manifest\n  const upstreamManifest = await fetchManifest(upstream);\n  \n  // 2. Compare with local\n  const localManifest = await localRepo.getManifest();\n  \n  // 3. Compute delta\n  const delta = computeDelta(localManifest, upstreamManifest, upstream.layers);\n  \n  // 4. Apply changes\n  const applied: string[] = [];\n  const conflicts: ConflictInfo[] = [];\n  \n  for (const item of delta.added) {\n    await localRepo.createItem(item);\n    applied.push(item.id);\n  }\n  \n  for (const item of delta.updated) {\n    const local = await localRepo.getItem(item.id);\n    if (local && local.contentHash !== item.contentHash) {\n      // Conflict: both modified\n      conflicts.push({ itemId: item.id, local, upstream: item });\n    } else {\n      await localRepo.updateItem(item);\n      applied.push(item.id);\n    }\n  }\n  \n  for (const itemId of delta.deleted) {\n    await localRepo.markSuperseded(itemId, 'upstream-deleted');\n    applied.push(itemId);\n  }\n  \n  // 5. Create sync commit\n  await localRepo.commit({\n    message: `Sync from upstream: ${upstream.id}`,\n    changeType: 'federation',\n    affectedItems: applied\n  });\n  \n  return { applied, conflicts };\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"layer-precedence-in-federation",children:"Layer Precedence in Federation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                                                                  \u2502\n\u2502  When same item exists at multiple layers:                      \u2502\n\u2502                                                                  \u2502\n\u2502    project  \u25c4\u2500\u2500 Highest precedence (most specific)              \u2502\n\u2502       \u2502                                                          \u2502\n\u2502    team                                                          \u2502\n\u2502       \u2502                                                          \u2502\n\u2502    org                                                           \u2502\n\u2502       \u2502                                                          \u2502\n\u2502    company \u25c4\u2500\u2500 Lowest precedence (least specific)               \u2502\n\u2502                                                                  \u2502\n\u2502  Project-level items override company-level items               \u2502\n\u2502                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"core-operations",children:"Core Operations"}),"\n",(0,s.jsx)(n.h3,{id:"operation-query-knowledge",children:"Operation: Query Knowledge"}),"\n",(0,s.jsx)(n.p,{children:"Search for knowledge items matching criteria."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface QueryKnowledgeInput {\n  /** Text search query */\n  query?: string;\n  \n  /** Filter by type */\n  type?: KnowledgeType;\n  \n  /** Filter by layer */\n  layer?: KnowledgeLayer;\n  \n  /** Filter by status */\n  status?: KnowledgeStatus | KnowledgeStatus[];\n  \n  /** Filter by tags */\n  tags?: string[];\n  \n  /** Filter by severity */\n  severity?: ConstraintSeverity;\n  \n  /** Maximum results */\n  limit?: number;\n  \n  /** Layer identifiers for scoping */\n  identifiers?: {\n    companyId?: string;\n    orgId?: string;\n    teamId?: string;\n    projectId?: string;\n  };\n}\n\ninterface QueryKnowledgeOutput {\n  /** Matching items (summary only, not full content) */\n  items: KnowledgeItemSummary[];\n  \n  /** Total count */\n  totalCount: number;\n}\n\ninterface KnowledgeItemSummary {\n  id: string;\n  type: KnowledgeType;\n  layer: KnowledgeLayer;\n  title: string;\n  summary: string;\n  status: KnowledgeStatus;\n  tags: string[];\n  hasConstraints: boolean;\n  updatedAt: string;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"operation-get-knowledge-item",children:"Operation: Get Knowledge Item"}),"\n",(0,s.jsx)(n.p,{children:"Retrieve full content of a knowledge item."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface GetKnowledgeInput {\n  /** Item ID */\n  id: string;\n  \n  /** Include constraint details */\n  includeConstraints?: boolean;\n  \n  /** Include version history */\n  includeHistory?: boolean;\n}\n\ninterface GetKnowledgeOutput {\n  /** Full knowledge item */\n  item: KnowledgeItem | null;\n  \n  /** Version history (if requested) */\n  history?: KnowledgeCommit[];\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"operation-check-constraints",children:"Operation: Check Constraints"}),"\n",(0,s.jsx)(n.p,{children:"Evaluate constraints against a context."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface CheckConstraintsInput {\n  /** Files to check */\n  files?: FileInfo[];\n  \n  /** Dependencies to check */\n  dependencies?: DependencyInfo[];\n  \n  /** Specific knowledge items to check (or all if empty) */\n  knowledgeItemIds?: string[];\n  \n  /** Only check certain severity levels */\n  minSeverity?: ConstraintSeverity;\n  \n  /** Layer identifiers */\n  identifiers: {\n    companyId?: string;\n    orgId?: string;\n    teamId?: string;\n    projectId?: string;\n  };\n}\n\ninterface CheckConstraintsOutput {\n  /** Check result */\n  result: ConstraintCheckResult;\n  \n  /** Knowledge items that were checked */\n  checkedItems: string[];\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"operation-propose-knowledge",children:"Operation: Propose Knowledge"}),"\n",(0,s.jsx)(n.p,{children:"Create a new knowledge item proposal."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface ProposeKnowledgeInput {\n  /** Item type */\n  type: KnowledgeType;\n  \n  /** Title */\n  title: string;\n  \n  /** Summary */\n  summary: string;\n  \n  /** Full content (Markdown) */\n  content: string;\n  \n  /** Target layer */\n  layer: KnowledgeLayer;\n  \n  /** Severity */\n  severity?: ConstraintSeverity;\n  \n  /** Constraints */\n  constraints?: Constraint[];\n  \n  /** Tags */\n  tags?: string[];\n  \n  /** If superseding existing item */\n  supersedes?: string;\n}\n\ninterface ProposeKnowledgeOutput {\n  /** Created item (in draft status) */\n  item: KnowledgeItem;\n  \n  /** Generated ID */\n  id: string;\n  \n  /** Path in repository */\n  path: string;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"operation-update-knowledge-status",children:"Operation: Update Knowledge Status"}),"\n",(0,s.jsx)(n.p,{children:"Change the status of a knowledge item."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface UpdateStatusInput {\n  /** Item ID */\n  id: string;\n  \n  /** New status */\n  status: KnowledgeStatus;\n  \n  /** Reason for status change */\n  reason?: string;\n}\n\ninterface UpdateStatusOutput {\n  /** Updated item */\n  item: KnowledgeItem;\n  \n  /** Commit hash */\n  commitHash: string;\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.h3,{id:"error-response-format",children:"Error Response Format"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"interface KnowledgeError {\n  /** Error code */\n  code: KnowledgeErrorCode;\n  \n  /** Human-readable message */\n  message: string;\n  \n  /** Operation that failed */\n  operation: string;\n  \n  /** Additional context */\n  details?: Record<string, unknown>;\n}\n\ntype KnowledgeErrorCode =\n  | 'ITEM_NOT_FOUND'\n  | 'INVALID_TYPE'\n  | 'INVALID_LAYER'\n  | 'INVALID_STATUS_TRANSITION'\n  | 'INVALID_CONSTRAINT'\n  | 'DUPLICATE_ID'\n  | 'MANIFEST_CORRUPTED'\n  | 'GIT_ERROR'\n  | 'FEDERATION_ERROR'\n  | 'VALIDATION_ERROR';\n"})}),"\n",(0,s.jsx)(n.h3,{id:"valid-status-transitions",children:"Valid Status Transitions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                                                                  \u2502\n\u2502  draft \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba proposed                                 \u2502\n\u2502    \u2502                      \u2502                                      \u2502\n\u2502    \u2502                      \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u25ba accepted                     \u2502\n\u2502    \u2502                      \u2502           \u2502                          \u2502\n\u2502    \u2502                      \u2502           \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u25ba deprecated       \u2502\n\u2502    \u2502                      \u2502           \u2502                          \u2502\n\u2502    \u2502                      \u2502           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u25ba superseded       \u2502\n\u2502    \u2502                      \u2502                                      \u2502\n\u2502    \u2502                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u25ba rejected                     \u2502\n\u2502    \u2502                                                             \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba rejected                             \u2502\n\u2502                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Next"}),": ",(0,s.jsx)(n.a,{href:"/aeterna/docs/specs/memory-knowledge-sync",children:"04-memory-knowledge-sync.md"})," - Memory-Knowledge Sync Specification"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453(e,n,t){t.d(n,{R:()=>o,x:()=>a});var i=t(6540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);