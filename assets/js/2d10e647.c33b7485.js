"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[9664],{1285(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"helm/hybrid-mode","title":"Hybrid Mode: Architecture and Data Flow","description":"This document describes hybrid mode \u2014 a distributed architecture combining local edge caching with a remote central server. Hybrid mode enables multi-region deployments, offline operation, and graduated sync with central authority.","source":"@site/docs/helm/hybrid-mode.md","sourceDirName":"helm","slug":"/helm/hybrid-mode","permalink":"/aeterna/docs/helm/hybrid-mode","draft":false,"unlisted":false,"editUrl":"https://github.com/kikokikok/aeterna/tree/main/website/docs/helm/hybrid-mode.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Local Mode Deployment Guide","permalink":"/aeterna/docs/helm/local-mode"},"next":{"title":"High Availability Requirements for Aeterna","permalink":"/aeterna/docs/helm/ha-requirements"}}');var i=s(4848),t=s(8453);const c={},l="Hybrid Mode: Architecture and Data Flow",a={},o=[{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Key Properties",id:"key-properties",level:3},{value:"Memory Hierarchy and Sync",id:"memory-hierarchy-and-sync",level:2},{value:"1. Working Memory (Milliseconds)",id:"1-working-memory-milliseconds",level:3},{value:"2. Session Memory (Minutes to Hours)",id:"2-session-memory-minutes-to-hours",level:3},{value:"3. Episodic Memory (Long-term)",id:"3-episodic-memory-long-term",level:3},{value:"Data Flow Diagram",id:"data-flow-diagram",level:2},{value:"Session State Sync (Every 60 seconds)",id:"session-state-sync-every-60-seconds",level:3},{value:"Vector Embedding Sync (Hourly)",id:"vector-embedding-sync-hourly",level:3},{value:"Sync Configuration",id:"sync-configuration",level:2},{value:"Core Sync Settings",id:"core-sync-settings",level:3},{value:"Example Sync Secret",id:"example-sync-secret",level:3},{value:"Monitoring Sync Health",id:"monitoring-sync-health",level:3},{value:"Offline Operation",id:"offline-operation",level:2},{value:"Offline Behavior",id:"offline-behavior",level:3},{value:"Offline Configuration",id:"offline-configuration",level:3},{value:"Conflict Resolution During Replay",id:"conflict-resolution-during-replay",level:3},{value:"Central Server Requirements",id:"central-server-requirements",level:2},{value:"Central Server Helm Values",id:"central-server-helm-values",level:3},{value:"Authentication Methods",id:"authentication-methods",level:2},{value:"1. API Key (Simple)",id:"1-api-key-simple",level:3},{value:"2. OAuth2 (Recommended)",id:"2-oauth2-recommended",level:3},{value:"3. Service Account (Kubernetes)",id:"3-service-account-kubernetes",level:3},{value:"Bandwidth Considerations",id:"bandwidth-considerations",level:2},{value:"1. Batch Requests",id:"1-batch-requests",level:3},{value:"2. Compression",id:"2-compression",level:3},{value:"3. Smart Caching",id:"3-smart-caching",level:3},{value:"Failover Behavior",id:"failover-behavior",level:2},{value:"When Central Server is Unreachable",id:"when-central-server-is-unreachable",level:3},{value:"When Edge Goes Offline",id:"when-edge-goes-offline",level:3},{value:"Summary",id:"summary",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"hybrid-mode-architecture-and-data-flow",children:"Hybrid Mode: Architecture and Data Flow"})}),"\n",(0,i.jsxs)(n.p,{children:["This document describes ",(0,i.jsx)(n.strong,{children:"hybrid mode"})," \u2014 a distributed architecture combining ",(0,i.jsx)(n.strong,{children:"local edge caching"})," with a ",(0,i.jsx)(n.strong,{children:"remote central server"}),". Hybrid mode enables multi-region deployments, offline operation, and graduated sync with central authority."]}),"\n",(0,i.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,i.jsx)(n.p,{children:"Hybrid mode runs Aeterna in two tiers:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   CENTRAL SERVER (Region 1)                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 PostgreSQL (episodic memory - write authority)       \u2502   \u2502\n\u2502  \u2502 Qdrant (vector DB - complete knowledge graph)        \u2502   \u2502\n\u2502  \u2502 OPAL (Cedar policies - policy authority)             \u2502   \u2502\n\u2502  \u2502 Sync Service (bi-directional replication)            \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n            \u2191                \u2191                \u2191\n  Async sync \u2502 Periodic sync \u2502 Policy updates\u2502\n            \u2193                \u2193                \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 EDGE 1 (Region) \u2502 \u2502 EDGE 2 (Region) \u2502 \u2502 EDGE N (Region) \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Dragonfly Cache \u2502 \u2502 Dragonfly Cache \u2502 \u2502 Dragonfly Cache \u2502\n\u2502 Qdrant (subset) \u2502 \u2502 Qdrant (subset) \u2502 \u2502 Qdrant (subset) \u2502\n\u2502 Cedar Agent     \u2502 \u2502 Cedar Agent     \u2502 \u2502 Cedar Agent     \u2502\n\u2502 (offline capable)\u2502 \u2502 (offline capable)\u2502 \u2502 (offline capable)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h3,{id:"key-properties",children:"Key Properties"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Central Authority"}),": Central server is the source of truth for all data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Edge Autonomy"}),": Edges operate independently, cache locally, serve requests offline"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Eventual Consistency"}),": Edge caches eventually consistent with central server"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Graduated Sync"}),": Data syncs at three memory hierarchy levels (Working \u2192 Session \u2192 Episodic)"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"memory-hierarchy-and-sync",children:"Memory Hierarchy and Sync"}),"\n",(0,i.jsx)(n.p,{children:"Aeterna manages data across three memory layers, each with different sync behavior:"}),"\n",(0,i.jsx)(n.h3,{id:"1-working-memory-milliseconds",children:"1. Working Memory (Milliseconds)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Storage"}),": Dragonfly cache (local edge only)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scope"}),": Current request context, temporary state"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sync"}),": No sync (ephemeral)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Consistency"}),": Immediate (local only)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"TTL"}),": 1-5 seconds"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# Working memory configuration\ncache:\n  backend: dragonfly\n  layers:\n    working:\n      ttl: 5s\n      maxSize: 1Gi\n      evictionPolicy: lru\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-session-memory-minutes-to-hours",children:"2. Session Memory (Minutes to Hours)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Storage"}),": Local Dragonfly + Central PostgreSQL"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scope"}),": User session state, conversation history, recent decisions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sync"}),": Batched every 30-60 seconds"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Consistency"}),": Eventual (async batch sync)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"TTL"}),": 24 hours (configurable)"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# Session memory configuration\nsync:\n  sessionMemory:\n    enabled: true\n    batchSize: 100  # Sessions per batch\n    interval: 60s   # Sync every 60 seconds\n    compression: gzip\n    maxRetries: 3\n    retryBackoff: exponential\n\n# Central server receives:\n# {\n#   "sessionId": "sess-123",\n#   "userId": "user-456",\n#   "messages": [...],  # Conversation history\n#   "state": {...},     # Session state\n#   "timestamp": 1708024800,\n#   "checksum": "sha256..."\n# }\n'})}),"\n",(0,i.jsx)(n.h3,{id:"3-episodic-memory-long-term",children:"3. Episodic Memory (Long-term)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Storage"}),": Central PostgreSQL only"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scope"}),": Historical decisions, knowledge graph, long-term patterns"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sync"}),": On-demand + scheduled snapshots"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Consistency"}),": Strong (synchronous writes or eventual)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"TTL"}),": Indefinite (with archival)"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# Episodic memory configuration\nsync:\n  episodicMemory:\n    enabled: true\n    mode: "eventual"  # or "strong" for critical systems\n    snapshotInterval: 86400s  # Daily snapshots\n    vectorSync:\n      enabled: true\n      batchSize: 1000\n      interval: 3600s  # Hourly\n'})}),"\n",(0,i.jsx)(n.h2,{id:"data-flow-diagram",children:"Data Flow Diagram"}),"\n",(0,i.jsx)(n.h3,{id:"session-state-sync-every-60-seconds",children:"Session State Sync (Every 60 seconds)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Edge Agent writes to local Dragonfly:\n  cache.set("session:sess-123", {...})\n                           \u2502\n                           \u2193\n  Every 60 seconds, batch collector reads:\n  sessions = dragonfly.scan("session:*", batchSize=100)\n                           \u2502\n                           \u2193\n  Sync service sends to central server (gzipped):\n  POST /api/sync/sessions\n  {\n    "agent_id": "edge-agent-1",\n    "region": "us-west-2",\n    "sessions": [\n      {\n        "id": "sess-123",\n        "last_activity": 1708024800,\n        "memory": {...},\n        "state": {...}\n      },\n      ...\n    ],\n    "signature": "hmac-sha256(...)"\n  }\n                           \u2502\n                           \u2193\n  Central server verifies signature, upserts to PostgreSQL:\n  INSERT INTO session_memory (session_id, agent_id, data, synced_at)\n  VALUES (...)\n  ON CONFLICT (session_id) DO UPDATE SET data = EXCLUDED.data\n                           \u2502\n                           \u2193\n  Acknowledgement sent back to edge:\n  {\n    "status": "accepted",\n    "processed": 87,\n    "failed": 0,\n    "next_sync": 1708024900\n  }\n'})}),"\n",(0,i.jsx)(n.h3,{id:"vector-embedding-sync-hourly",children:"Vector Embedding Sync (Hourly)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Edge executes query:\n  vector_search(embedding=[...], limit=10)\n                           \u2502\n                           \u2193\n  Searches local Qdrant (subset of vectors):\n  \u2192 Finds 8 results locally\n  \u2192 Confidence score < threshold (partial results)\n                           \u2502\n                           \u2193\n  Triggers request to central server:\n  POST /api/search/vectors\n  {\n    "embedding": [...],\n    "limit": 5,  # Additional results needed\n    "filter": {"region": "exclude:us-west-2"}  # Don\'t duplicate local results\n  }\n                           \u2502\n                           \u2193\n  Central Qdrant searches complete knowledge graph:\n  \u2192 Finds 3 additional results with higher confidence\n  \u2192 Returns top 3 to edge\n                           \u2502\n                           \u2193\n  Edge caches new vectors for future queries:\n  qdrant.upsert(...)  # Async, doesn\'t block response\n  Schedules sync back to central for offset tracking\n'})}),"\n",(0,i.jsx)(n.h2,{id:"sync-configuration",children:"Sync Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"core-sync-settings",children:"Core Sync Settings"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'sync:\n  # Central server endpoint\n  enabled: true\n  centralServer:\n    url: "https://central.aeterna.example.com"\n    port: 443\n    timeout: 30s\n    maxRetries: 3\n  \n  # Authentication with central\n  auth:\n    method: "serviceAccount"  # or "apiKey", "oauth2"\n    existingSecret: "aeterna-sync-credentials"  # k8s Secret name\n    # Secret contents:\n    # apiKey: "sk-..."\n    # clientId: "client-..."\n    # clientSecret: "..."\n  \n  # Batch configuration\n  batch:\n    maxSize: 100  # Max items per batch\n    maxBytes: 10485760  # 10MB max payload\n    flushInterval: 60s  # Max time before forcing flush\n  \n  # Memory layer sync\n  memoryLayers:\n    working:\n      syncEnabled: false  # Never sync working memory\n    session:\n      syncEnabled: true\n      interval: 60s\n      batchSize: 100\n      compression: gzip\n      onError: "queue"  # Queue failed items for retry\n    episodic:\n      syncEnabled: true\n      interval: 3600s  # Hourly\n      batchSize: 1000\n      compression: gzip\n      mode: "eventual"  # Don\'t block on central writes\n  \n  # Network settings\n  network:\n    compression: gzip  # Reduce bandwidth\n    encryption: tls12  # Minimum TLS 1.2\n    certificatePinning: true\n    pinnedCertificates:\n      - "sha256/AAAAAABBBBBBCCCCCCDDDDDDEEEEEEFFFFFFFFGGGGGGHHHHHHII="\n  \n  # Offline operation\n  offline:\n    mode: "queue"  # Queue writes when central unreachable\n    maxQueueSize: 10000  # Max queued items\n    queueTTL: 3600s  # Discard queue items after 1 hour\n    fallbackCache: true  # Return cached results during outage\n'})}),"\n",(0,i.jsx)(n.h3,{id:"example-sync-secret",children:"Example Sync Secret"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Create secret for sync authentication\nkubectl create secret generic aeterna-sync-credentials \\\n  --from-literal=apiKey="sk-edge-sync-key-12345" \\\n  --from-literal=clientId="edge-sync-client" \\\n  --namespace aeterna\n\n# Or for OAuth2\nkubectl create secret generic aeterna-sync-credentials \\\n  --from-literal=clientId="edge-sync-client" \\\n  --from-literal=clientSecret="client-secret-xyz" \\\n  --from-literal=tokenUrl="https://auth.aeterna.example.com/token" \\\n  --namespace aeterna\n'})}),"\n",(0,i.jsx)(n.h3,{id:"monitoring-sync-health",children:"Monitoring Sync Health"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check sync service status\nkubectl get deployment aeterna-sync -n aeterna\nkubectl logs -n aeterna deployment/aeterna-sync --tail=50\n\n# Monitor sync metrics (if Prometheus enabled)\nkubectl exec -it aeterna-sync-0 -n aeterna -- curl http://localhost:8080/metrics | grep sync\n\n# Check queue backlog\nkubectl exec -it aeterna-sync-0 -n aeterna -- redis-cli LLEN sync:queue:session\nkubectl exec -it aeterna-sync-0 -n aeterna -- redis-cli LLEN sync:queue:episodic\n\n# Verify last successful sync\nkubectl get configmap aeterna-sync-status -n aeterna -o jsonpath='{.data.lastSync}'\n# Output: 2025-02-21T10:30:45Z\n"})}),"\n",(0,i.jsx)(n.h2,{id:"offline-operation",children:"Offline Operation"}),"\n",(0,i.jsxs)(n.p,{children:["Hybrid mode enables ",(0,i.jsx)(n.strong,{children:"offline operation"})," \u2014 the Cedar Agent continues to function when central server is unreachable."]}),"\n",(0,i.jsx)(n.h3,{id:"offline-behavior",children:"Offline Behavior"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Online Mode:\n  request \u2192 [Edge Cache] \u2192 [Central] \u2192 response\n  \nOffline Mode (central unavailable):\n  request \u2192 [Edge Cache] \u2192 [Queued decision] \u2192 response (cached/heuristic)\n           (No network call, serve immediately)\n\nReconnect:\n  [Queued decisions] \u2192 replay to central \u2192 [Central reconciles]\n"})}),"\n",(0,i.jsx)(n.h3,{id:"offline-configuration",children:"Offline Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'aeterna:\n  offline:\n    enabled: true\n    fallbackMode: "cache"  # Return cached results\n    decisionQueueing: true  # Queue decisions for later replay\n    maxQueueSize: 5000\n    conflictResolution: "timestamp"  # Use timestamps if conflicts arise\n\n# Detect offline condition\ncentralServer:\n  healthCheck:\n    interval: 30s\n    timeout: 5s\n    failureThreshold: 3  # Mark offline after 3 failed checks\n'})}),"\n",(0,i.jsx)(n.h3,{id:"conflict-resolution-during-replay",children:"Conflict Resolution During Replay"}),"\n",(0,i.jsx)(n.p,{children:"When edge decisions are replayed to central server after connectivity restoration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Central server receives queued decisions\nPOST /api/sync/replay-decisions\n{\n  "agent_id": "edge-1",\n  "decisions": [\n    {\n      "id": "dec-123",\n      "timestamp": 1708024500,  # When edge decided\n      "action": "approve",\n      "resource": "resource-456",\n      "metadata": {...}\n    }\n  ]\n}\n\n# Central checks for conflicts\nSELECT * FROM decisions \nWHERE resource_id = \'resource-456\' \n  AND timestamp > 1708024500\n\n# If conflicts exist, use conflict resolution policy:\n# - "timestamp": Keep decision with latest timestamp (default)\n# - "central": Discard edge decision, keep central\n# - "manual": Flag for manual review\n'})}),"\n",(0,i.jsx)(n.h2,{id:"central-server-requirements",children:"Central Server Requirements"}),"\n",(0,i.jsx)(n.p,{children:"For hybrid mode to work, the central server must:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"PostgreSQL 16+"})," with pgvector for semantic search"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Qdrant"})," or ",(0,i.jsx)(n.strong,{children:"Weaviate"})," for complete vector knowledge graph"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"OPAL"})," Cedar authorization engine"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Sync API"})," endpoints:\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POST /api/sync/sessions"})," \u2014 accept session state updates"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POST /api/sync/vectors"})," \u2014 accept vector embeddings"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GET /api/search/vectors"})," \u2014 return additional search results"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POST /api/sync/replay-decisions"})," \u2014 replay offline decisions"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"API Rate Limiting"}),": 100 req/sec per edge agent"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"TLS 1.2+"})," with certificate pinning for transport security"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"central-server-helm-values",children:"Central Server Helm Values"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# Central server values.yaml\ndeploymentMode: central\n\npostgresql:\n  cloudnativepg:\n    enabled: true\n    cluster:\n      instances: 5  # HA for central\n      postgresql:\n        version: 16\n        parameters:\n          shared_preload_libraries: "pgvector"\n      storage:\n        size: 500Gi  # Large for global data\n\nvectorDatabase:\n  qdrant:\n    enabled: true\n    replicas: 5\n    storage:\n      size: 300Gi\n\nsync:\n  enabled: true\n  listenPort: 8081\n  maxEdges: 1000  # Max edge agents\n  rateLimit: "100/sec"  # Per agent\n  \nopal:\n  enabled: true\n  replicas: 3\n\n# TLS for sync API\ntls:\n  enabled: true\n  certManager:\n    enabled: true\n    issuer: letsencrypt-prod\n'})}),"\n",(0,i.jsx)(n.h2,{id:"authentication-methods",children:"Authentication Methods"}),"\n",(0,i.jsx)(n.h3,{id:"1-api-key-simple",children:"1. API Key (Simple)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"sync:\n  auth:\n    method: apiKey\n    existingSecret: aeterna-sync-credentials\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Create secret\nkubectl create secret generic aeterna-sync-credentials \\\n  --from-literal=apiKey="sk-edge-sync-abc123def456" \\\n  -n aeterna\n'})}),"\n",(0,i.jsx)(n.p,{children:"Request format:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Authorization: Bearer sk-edge-sync-abc123def456\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-oauth2-recommended",children:"2. OAuth2 (Recommended)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"sync:\n  auth:\n    method: oauth2\n    existingSecret: aeterna-sync-credentials\n    # Secret contains: clientId, clientSecret, tokenUrl\n"})}),"\n",(0,i.jsx)(n.p,{children:"Central server issues JWT tokens to edges:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-service-account-kubernetes",children:"3. Service Account (Kubernetes)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"sync:\n  auth:\n    method: serviceAccount\n    serviceAccount:\n      name: aeterna-edge-sync\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# RBAC for edge sync\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: aeterna-edge-sync\n  namespace: aeterna\n\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: aeterna-edge-sync\nrules:\n- apiGroups: [""]\n  resources: ["secrets"]\n  verbs: ["get"]\n'})}),"\n",(0,i.jsx)(n.h2,{id:"bandwidth-considerations",children:"Bandwidth Considerations"}),"\n",(0,i.jsxs)(n.p,{children:["Hybrid mode trades ",(0,i.jsx)(n.strong,{children:"latency for bandwidth"})," \u2014 each central query adds ~100-500ms of network delay. Optimize:"]}),"\n",(0,i.jsx)(n.h3,{id:"1-batch-requests",children:"1. Batch Requests"}),"\n",(0,i.jsx)(n.p,{children:"Instead of:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"for each decision:\n  POST /api/sync/session  # N requests\n"})}),"\n",(0,i.jsx)(n.p,{children:"Do:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"batch = [decisions...]\nPOST /api/sync/sessions  # 1 request\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-compression",children:"2. Compression"}),"\n",(0,i.jsx)(n.p,{children:"All payloads gzipped (default):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"gzip compression: ~80% reduction for JSON\nSession state: 100KB \u2192 20KB\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-smart-caching",children:"3. Smart Caching"}),"\n",(0,i.jsx)(n.p,{children:"Cache frequently accessed vectors locally:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'qdrant:\n  cache:\n    enabled: true\n    # Cache top 10K frequently accessed vectors\n    size: 10000\n    ttl: 86400s  # 1 day\n    policy: "frequency"  # Based on access frequency\n'})}),"\n",(0,i.jsx)(n.h2,{id:"failover-behavior",children:"Failover Behavior"}),"\n",(0,i.jsx)(n.h3,{id:"when-central-server-is-unreachable",children:"When Central Server is Unreachable"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Edge detects failure"})," (health check timeout after 3 failures, ~90 seconds)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Offline mode activated"}),":\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Serve requests from cache"}),"\n",(0,i.jsx)(n.li,{children:"Queue decisions locally"}),"\n",(0,i.jsx)(n.li,{children:"No external API calls"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Monitor automatically retries"})," central connection every 30 seconds"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"On reconnect"}),":\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Send queued sync batches"}),"\n",(0,i.jsx)(n.li,{children:"Verify no conflicts (timestamp-based resolution)"}),"\n",(0,i.jsx)(n.li,{children:"Resume normal sync"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"when-edge-goes-offline",children:"When Edge Goes Offline"}),"\n",(0,i.jsx)(n.p,{children:"Central server considers edge offline after:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"No sync batches for 5 minutes (configurable)"}),"\n",(0,i.jsx)(n.li,{children:"Edge agent explicitly goes offline"}),"\n",(0,i.jsx)(n.li,{children:"Network partition detected"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Central continues accepting queries, clients may get stale cache results."}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Hybrid mode enables:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Multi-region deployments with local caching"}),"\n",(0,i.jsx)(n.li,{children:"Offline-capable agents (queue decisions locally)"}),"\n",(0,i.jsx)(n.li,{children:"Graduated consistency (working\u2192session\u2192episodic)"}),"\n",(0,i.jsx)(n.li,{children:"Reduced latency for common operations (cached locally)"}),"\n",(0,i.jsx)(n.li,{children:"Centralized authority (single source of truth)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Tradeoffs:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"More operational complexity (two-tier architecture)"}),"\n",(0,i.jsx)(n.li,{children:"Eventual consistency (session/episodic layer)"}),"\n",(0,i.jsx)(n.li,{children:"Network dependency for full functionality"}),"\n",(0,i.jsx)(n.li,{children:"Additional bandwidth for sync traffic"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["For detailed configuration, see ",(0,i.jsx)(n.code,{children:"values-hybrid.yaml"}),". For remote mode (no local caching), see ",(0,i.jsx)(n.strong,{children:"remote-mode.md"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>c,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function c(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);