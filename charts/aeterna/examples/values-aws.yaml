# Aeterna AWS EKS Values
# Production deployment on Amazon Elastic Kubernetes Service
# Usage: helm install aeterna ./charts/aeterna -f charts/aeterna/examples/values-aws.yaml

deploymentMode: local

aeterna:
  replicaCount: 3

  serviceAccount:
    annotations:
      eks.amazonaws.com/role-arn: "arn:aws:iam::123456789012:role/aeterna-role"

  resources:
    limits:
      cpu: 2000m
      memory: 4Gi
    requests:
      cpu: 500m
      memory: 1Gi

  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70

  pdb:
    enabled: true
    minAvailable: 2

  topologySpreadConstraints:
    - maxSkew: 1
      topologyKey: topology.kubernetes.io/zone
      whenUnsatisfiable: DoNotSchedule
      labelSelector:
        matchLabels:
          app.kubernetes.io/name: aeterna

  ingress:
    enabled: true
    className: "alb"
    annotations:
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/certificate-arn: "arn:aws:acm:us-east-1:123456789012:certificate/xxxx"
      alb.ingress.kubernetes.io/listen-ports: '[{"HTTPS":443}]'
    hosts:
      - host: aeterna.example.com
        paths:
          - path: /
            pathType: Prefix

# Vector Backend configuration
vectorBackend:
  type: qdrant
  qdrant:
    bundled: true

# Cache configuration
cache:
  type: dragonfly
  dragonfly:
    enabled: true
    replicas: 3
  # External ElastiCache configuration (commented out alternative)
  # type: external
  # external:
  #   enabled: true
  #   host: "aeterna-cache.xxxx.use1.cache.amazonaws.com"
  #   port: 6379
  #   existingSecret: "aeterna-cache-credentials"

# PostgreSQL configuration
postgresql:
  bundled: true
  cloudnativepg:
    instances: 3
    storage:
      size: 100Gi
      storageClass: "gp3"
    backup:
      enabled: true
      provider: "s3"
      destinationPath: "s3://aeterna-backups/postgresql"
  # External RDS configuration (commented out alternative)
  # bundled: false
  # external:
  #   enabled: true
  #   host: "aeterna-db.xxxx.us-east-1.rds.amazonaws.com"
  #   database: "aeterna"
  #   existingSecret: "aeterna-db-credentials"

# Backup configuration
backup:
  enabled: true
  destination:
    type: s3
    s3:
      bucket: "aeterna-backups"
      region: "us-east-1"
      existingSecret: "aeterna-s3-credentials"

# OPAL stack
opal:
  enabled: true
  server:
    replicaCount: 3

# Observability
observability:
  serviceMonitor:
    enabled: true
    labels:
      release: prometheus
  tracing:
    enabled: true
    endpoint: "http://jaeger-collector.monitoring.svc:4317"
    samplingRatio: 0.1

# Security
networkPolicy:
  enabled: true

# Subcharts
qdrant:
  enabled: true
  replicaCount: 3
  persistence:
    size: 100Gi
    storageClass: "gp3"

dragonfly:
  enabled: true
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
