{{- if .Values.aeterna.enabled }}
{{- if not .Values.postgresql.external.existingSecret }}
{{- if not .Values.postgresql.bundled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "aeterna.fullname" . }}-postgresql
  labels:
    {{- include "aeterna.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.postgresql.external.password }}
  {{ .Values.postgresql.external.secretKey | default "postgres-password" }}: {{ .Values.postgresql.external.password | b64enc | quote }}
  {{- else }}
  {{ .Values.postgresql.external.secretKey | default "postgres-password" }}: {{ randAlphaNum 32 | b64enc | quote }}
  {{- end }}
---
{{- end }}
{{- end }}
{{- if and .Values.cache.external.enabled (not .Values.cache.external.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "aeterna.fullname" . }}-redis
  labels:
    {{- include "aeterna.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.cache.external.password }}
  {{ .Values.cache.external.secretKey | default "redis-password" }}: {{ .Values.cache.external.password | b64enc | quote }}
  {{- else }}
  {{ .Values.cache.external.secretKey | default "redis-password" }}: {{ randAlphaNum 32 | b64enc | quote }}
  {{- end }}
---
{{- end }}
{{- if and (ne .Values.deploymentMode "local") .Values.central.apiKey (not .Values.central.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "aeterna.fullname" . }}-central
  labels:
    {{- include "aeterna.labels" . | nindent 4 }}
type: Opaque
data:
  {{ .Values.central.secretKey | default "api-key" }}: {{ .Values.central.apiKey | b64enc | quote }}
---
{{- end }}
{{- if and (eq .Values.llm.provider "openai") .Values.llm.openai.apiKey (not .Values.llm.openai.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "aeterna.fullname" . }}-openai
  labels:
    {{- include "aeterna.labels" . | nindent 4 }}
type: Opaque
data:
  api-key: {{ .Values.llm.openai.apiKey | b64enc | quote }}
---
{{- end }}
{{- if and (eq .Values.llm.provider "anthropic") .Values.llm.anthropic.apiKey (not .Values.llm.anthropic.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "aeterna.fullname" . }}-anthropic
  labels:
    {{- include "aeterna.labels" . | nindent 4 }}
type: Opaque
data:
  api-key: {{ .Values.llm.anthropic.apiKey | b64enc | quote }}
---
{{- end }}
{{- if and (eq .Values.vectorBackend.type "pinecone") .Values.vectorBackend.pinecone.apiKey (not .Values.vectorBackend.pinecone.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "aeterna.fullname" . }}-pinecone
  labels:
    {{- include "aeterna.labels" . | nindent 4 }}
type: Opaque
data:
  api-key: {{ .Values.vectorBackend.pinecone.apiKey | b64enc | quote }}
---
{{- end }}
{{- if and (not .Values.vectorBackend.qdrant.bundled) .Values.vectorBackend.qdrant.external.apiKey (not .Values.vectorBackend.qdrant.external.existingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "aeterna.fullname" . }}-qdrant
  labels:
    {{- include "aeterna.labels" . | nindent 4 }}
type: Opaque
data:
  api-key: {{ .Values.vectorBackend.qdrant.external.apiKey | b64enc | quote }}
{{- end }}
{{- end }}
