<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-examples/strangler-fig-migration" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Strangler Fig Migration with Aeterna | Aeterna</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kikokikok.github.io/aeterna/docs/examples/strangler-fig-migration"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Strangler Fig Migration with Aeterna | Aeterna"><meta data-rh="true" name="description" content="How 300 engineers transform a monolith to microservices using AI-assisted knowledge governance"><meta data-rh="true" property="og:description" content="How 300 engineers transform a monolith to microservices using AI-assisted knowledge governance"><link data-rh="true" rel="icon" href="/aeterna/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kikokikok.github.io/aeterna/docs/examples/strangler-fig-migration"><link data-rh="true" rel="alternate" href="https://kikokikok.github.io/aeterna/docs/examples/strangler-fig-migration" hreflang="en"><link data-rh="true" rel="alternate" href="https://kikokikok.github.io/aeterna/docs/examples/strangler-fig-migration" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Strangler Fig Migration with Aeterna","item":"https://kikokikok.github.io/aeterna/docs/examples/strangler-fig-migration"}]}</script><link rel="stylesheet" href="/aeterna/assets/css/styles.9ec36079.css">
<script src="/aeterna/assets/js/runtime~main.7b7cf05c.js" defer="defer"></script>
<script src="/aeterna/assets/js/main.2421dfb6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/aeterna/"><b class="navbar__title text--truncate">Aeterna</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/aeterna/docs/">Documentation</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/kikokikok/aeterna" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/aeterna/docs/"><span title="Introduction to Aeterna" class="linkLabel_WmDU">Introduction to Aeterna</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/aeterna/docs/helm/quickstart-local"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aeterna/docs/helm/quickstart-local"><span title="Local Mode Quick Start" class="linkLabel_WmDU">Local Mode Quick Start</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aeterna/docs/helm/quickstart-hybrid"><span title="Hybrid Mode Deployment Guide" class="linkLabel_WmDU">Hybrid Mode Deployment Guide</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aeterna/docs/helm/quickstart-remote"><span title="Remote Mode Deployment Guide" class="linkLabel_WmDU">Remote Mode Deployment Guide</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aeterna/docs/guides/cli-quick-reference"><span title="Aeterna CLI Quick Reference" class="linkLabel_WmDU">Aeterna CLI Quick Reference</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aeterna/docs/specs/overview"><span title="Concepts" class="categoryLinkLabel_W154">Concepts</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aeterna/docs/specs/memory-system"><span title="Memory System" class="categoryLinkLabel_W154">Memory System</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aeterna/docs/specs/knowledge-repository"><span title="Knowledge Repository" class="categoryLinkLabel_W154">Knowledge Repository</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aeterna/docs/governance/policy-model"><span title="Governance" class="categoryLinkLabel_W154">Governance</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aeterna/docs/cca/overview"><span title="CCA — Confucius Code Agent" class="categoryLinkLabel_W154">CCA — Confucius Code Agent</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aeterna/docs/integrations/mcp-server"><span title="Integrations" class="categoryLinkLabel_W154">Integrations</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aeterna/docs/security/rbac-matrix"><span title="Security" class="categoryLinkLabel_W154">Security</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aeterna/docs/helm/architecture"><span title="Helm Deployment" class="categoryLinkLabel_W154">Helm Deployment</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aeterna/docs/guides/ha-deployment"><span title="Operations" class="categoryLinkLabel_W154">Operations</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/aeterna/docs/examples/strangler-fig-migration"><span title="Examples" class="categoryLinkLabel_W154">Examples</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/aeterna/docs/examples/strangler-fig-migration"><span title="Strangler Fig Migration with Aeterna" class="linkLabel_WmDU">Strangler Fig Migration with Aeterna</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aeterna/docs/examples/policies/"><span title="Example Policies Library" class="linkLabel_WmDU">Example Policies Library</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aeterna/docs/examples/policies/security-baseline"><span title="Security Baseline Policies" class="linkLabel_WmDU">Security Baseline Policies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aeterna/docs/examples/policies/code-quality"><span title="Code Quality Policies" class="linkLabel_WmDU">Code Quality Policies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aeterna/docs/examples/policies/architecture-constraints"><span title="Architecture Constraints Policies" class="linkLabel_WmDU">Architecture Constraints Policies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aeterna/docs/examples/policies/dependency-management"><span title="Dependency Management Policies" class="linkLabel_WmDU">Dependency Management Policies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aeterna/docs/examples/policies/team-conventions"><span title="Team Conventions Policies" class="linkLabel_WmDU">Team Conventions Policies</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/aeterna/docs/specs/tool-interface"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/aeterna/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Examples</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Strangler Fig Migration with Aeterna</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Strangler Fig Migration with Aeterna</h1></header>
<p><strong>How 300 engineers transform a monolith to microservices using AI-assisted knowledge governance</strong></p>
<p>This guide demonstrates how Aeterna serves as the knowledge backbone for a multi-year platform transformation using the Strangler Fig pattern.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-scenario-project-wolf">The Scenario: Project Wolf<a href="#the-scenario-project-wolf" class="hash-link" aria-label="Direct link to The Scenario: Project Wolf" title="Direct link to The Scenario: Project Wolf" translate="no">​</a></h2>
<p><strong>Starting Point (Legacy &quot;KApp&quot;):</strong></p>
<ul>
<li class="">Monolithic Java application (2M LOC)</li>
<li class="">Batch-oriented processing (1M payments/month)</li>
<li class="">End-of-day reconciliation</li>
<li class="">Single PostgreSQL database</li>
<li class="">15 years of accumulated technical debt</li>
</ul>
<p><strong>Target State (Autonomous Platform):</strong></p>
<ul>
<li class="">50M+ payments/month</li>
<li class="">&lt;30 second latency</li>
<li class="">~200 versioned microservices (&quot;Bricks&quot;)</li>
<li class="">Cellular multi-tenant architecture</li>
<li class="">Policy-driven, agent-ready operations</li>
</ul>
<p><strong>Timeline:</strong> 3 years (2024-2027)
<strong>Teams:</strong> 12 teams, 300 engineers
<strong>Challenge:</strong> How do you coordinate this transformation without chaos?</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="aeternas-role-the-transformation-knowledge-graph">Aeterna&#x27;s Role: The Transformation Knowledge Graph<a href="#aeternas-role-the-transformation-knowledge-graph" class="hash-link" aria-label="Direct link to Aeterna&#x27;s Role: The Transformation Knowledge Graph" title="Direct link to Aeterna&#x27;s Role: The Transformation Knowledge Graph" translate="no">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                     STRANGLER FIG TRANSFORMATION                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌─────────────────────────────────────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                        AETERNA KNOWLEDGE LAYER                       │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                      │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │     ADRs     │  │   Policies   │  │   Patterns   │             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │              │  │              │  │              │             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │ • Migration  │  │ • Code rules │  │ • Brick spec │             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │   decisions  │  │ • API stds   │  │ • Anti-cors  │             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │ • Tech debt  │  │ • Security   │  │ • Wrappers   │             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │   payoffs    │  │ • Testing    │  │ • Facades    │             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   └──────────────┘  └──────────────┘  └──────────────┘             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                              │                                      │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                    ┌─────────▼─────────┐                           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                    │  CONSTRAINT DSL   │                           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                    │                   │                           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                    │ &quot;Block if using   │                           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                    │  legacy patterns&quot; │                           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                    └─────────┬─────────┘                           │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                              │                                      │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────────────────────────┼──────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                 │                                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────────────────────────▼──────────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                        AETERNA MEMORY LAYER                          │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                      │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │ Team Memory  │  │ Agent Memory │  │  Migration   │             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │              │  │              │  │   Learnings  │             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │ • Decisions  │  │ • What works │  │              │             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │ • Blockers   │  │ • Edge cases │  │ • Gotchas    │             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │ • Workarounds│  │ • Tool prefs │  │ • Successes  │             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   └──────────────┘  └──────────────┘  └──────────────┘             │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                      │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └──────────────────────────────────────────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ┌──────────────────────────────────────────────────────────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                                                       │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   MONOLITH (KApp)              │           MICROSERVICES (Wolf)      │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   ━━━━━━━━━━━━━━━━             │           ━━━━━━━━━━━━━━━━━━━━      │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                │                                      │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   ┌─────────────┐   Strangler  │   ┌─────────────┐                   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  Payment    │──── Fig ─────┼──►│  Payment    │                   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  Module     │   Wrapper    │   │  Service    │                   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   └─────────────┘              │   └─────────────┘                   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                │                                      │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   ┌─────────────┐              │   ┌─────────────┐                   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  Liquidity  │──────────────┼──►│  Liquidity  │                   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  Module     │              │   │  Service    │                   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   └─────────────┘              │   └─────────────┘                   │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                │                                      │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   ┌─────────────┐              │                                      │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  Legacy     │  (not yet    │                                      │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   │  Modules    │   migrated)  │                                      │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │   └─────────────┘              │                                      │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  │                                │                                      │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  └────────────────────────────────┴──────────────────────────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────────────────────────────────────────────────────┘</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="organizational-structure-in-aeterna">Organizational Structure in Aeterna<a href="#organizational-structure-in-aeterna" class="hash-link" aria-label="Direct link to Organizational Structure in Aeterna" title="Direct link to Organizational Structure in Aeterna" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="company-layer-global-standards">Company Layer: Global Standards<a href="#company-layer-global-standards" class="hash-link" aria-label="Direct link to Company Layer: Global Standards" title="Direct link to Company Layer: Global Standards" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># knowledge/company/wolf-corp/policies/migration-baseline.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> migration</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">baseline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">layer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> company</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mandatory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">merge_strategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> merge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># No new code in monolith</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> no</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">monolith</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">features</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_not_match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;src/main/java/com/legacy/kapp/.*\\.java$&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      BLOCKED: No new features in legacy KApp.</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      All new development must use Wolf microservices.</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      See ADR-001: Strangler Fig Migration Strategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># All new services must be &quot;Bricks&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> brick</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pattern</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@Brick\\(version\\s*=\\s*\&quot;\\d+\\.\\d+\&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> warn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      All new services must follow the Brick pattern.</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      See pattern://wolf/brick-specification</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># API versioning required</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> api</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">versioning</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;api\\.version:\\s*v[0-9]+&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      All APIs must be versioned (v1, v2, etc.)</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      See ADR-015: API Versioning Strategy</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="organization-layer-domain-standards">Organization Layer: Domain Standards<a href="#organization-layer-domain-standards" class="hash-link" aria-label="Direct link to Organization Layer: Domain Standards" title="Direct link to Organization Layer: Domain Standards" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># knowledge/org/platform-engineering/policies/payments-domain.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> payments</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">domain</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">standards</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">layer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mandatory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Payment services must use TigerBeetle for ledger</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ledger</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">technology</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dependency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tigerbeetle-client&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      Payment services MUST use TigerBeetle for ledger operations.</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      PostgreSQL is NOT approved for financial transactions.</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      See ADR-023: Ledger Technology Selection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Idempotency required</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> idempotency</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@Idempotent|idempotency_key&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      All payment operations MUST be idempotent.</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      See pattern://wolf/idempotent-operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Double-entry accounting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> double</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">entry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;debit.*credit|credit.*debit&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> warn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      Financial operations should use double-entry accounting.</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      See ADR-024: Accounting Model</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="team-layer-implementation-standards">Team Layer: Implementation Standards<a href="#team-layer-implementation-standards" class="hash-link" aria-label="Direct link to Team Layer: Implementation Standards" title="Direct link to Team Layer: Implementation Standards" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># knowledge/team/payments-core/policies/team-standards.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> payments</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">core</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">standards</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">layer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> team</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> optional</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">merge_strategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> merge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Team uses Kotlin for new services</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kotlin</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">preferred</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.*\\.kt$&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      Payments Core team prefers Kotlin for new services.</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      Java is acceptable for legacy integration.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Circuit breaker on all external calls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> circuit</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">breaker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@CircuitBreaker|resilience4j&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> warn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      External service calls should use circuit breakers.</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      See pattern://payments-core/resilience-patterns</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="adr-library-capturing-migration-decisions">ADR Library: Capturing Migration Decisions<a href="#adr-library-capturing-migration-decisions" class="hash-link" aria-label="Direct link to ADR Library: Capturing Migration Decisions" title="Direct link to ADR Library: Capturing Migration Decisions" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="adr-001-strangler-fig-migration-strategy">ADR-001: Strangler Fig Migration Strategy<a href="#adr-001-strangler-fig-migration-strategy" class="hash-link" aria-label="Direct link to ADR-001: Strangler Fig Migration Strategy" title="Direct link to ADR-001: Strangler Fig Migration Strategy" translate="no">​</a></h3>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">#</span><span class="token title important"> knowledge/company/wolf-corp/adrs/adr-001-strangler-fig.md</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">#</span><span class="token title important"> ADR-001: Strangler Fig Migration Strategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accepted (2024-01-15)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">We need to transform KApp (2M LOC monolith) to Wolf (microservices) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while maintaining 99.9% uptime and serving existing customers.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Big-bang rewrites fail. We need incremental transformation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> Decision</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">We will use the </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Strangler Fig Pattern</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">1.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Wrap</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: New facade intercepts requests to legacy modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">2.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Replace</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: Gradually implement functionality in new services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">3.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token bold content">Retire</span><span class="token bold punctuation" style="color:#393A34">**</span><span class="token plain">: Remove legacy code when traffic fully migrated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> ┌─────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> │            API Gateway                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> │                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> │   ┌────────────────────────────────┐    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> │   │      Strangler Facade          │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> │   │                                │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> │   │  if (feature_flag.new_service) │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> │   │    → route to Wolf service     │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> │   │  else                          │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> │   │    → route to KApp module      │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> │   │                                │    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> │   └────────────────────────────────┘    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> │              │              │            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> └──────────────┼──────────────┼────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ▼              ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ┌───────────┐  ┌───────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   Wolf    │  │   KApp    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │  Service  │  │  Module   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └───────────┘  └───────────┘</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Consequences</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Positive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Zero downtime migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Incremental risk reduction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Team autonomy (different teams migrate different modules)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Rollback capability per feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Negative</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Temporary complexity (two systems)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Need robust feature flag infrastructure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Requires comprehensive testing of both paths</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Constraints (Enforced by Aeterna)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">constraints:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - operator: must_not_exist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target: file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pattern: &quot;src/main/java/com/legacy/kapp/new_feature_*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    severity: block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    message: &quot;No new features in legacy KApp - use Wolf services&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - operator: must_use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target: dependency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pattern: &quot;strangler-facade-sdk&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    severity: warn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    message: &quot;Use official SDK for strangler facades&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="related">Related<a href="#related" class="hash-link" aria-label="Direct link to Related" title="Direct link to Related" translate="no">​</a></h2>
<ul>
<li class="">ADR-002: Feature Flag Strategy</li>
<li class="">ADR-003: Traffic Shadowing for Validation</li>
<li class="">Pattern: Strangler Facade Implementation</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### ADR-015: API Versioning Strategy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```markdown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># knowledge/company/wolf-corp/adrs/adr-015-api-versioning.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ADR-015: API Versioning Strategy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accepted (2024-03-01)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">With 200 microservices and 12 teams, we need consistent API evolution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">without breaking consumers. Migration period means both KApp and Wolf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">consumers exist simultaneously.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Decision</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**URL Path Versioning** with **Sunset Headers**:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Version in path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POST /api/v2/payments/initiate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Sunset header for deprecation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sunset: Sat, 01 Jan 2025 00:00:00 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Deprecation: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Link: &lt;/api/v3/payments/initiate&gt;; rel=&quot;successor-version&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="version-lifecycle">Version Lifecycle<a href="#version-lifecycle" class="hash-link" aria-label="Direct link to Version Lifecycle" title="Direct link to Version Lifecycle" translate="no">​</a></h3>

























<table><thead><tr><th>Stage</th><th>Duration</th><th>Policy</th></tr></thead><tbody><tr><td><strong>Current</strong></td><td>Indefinite</td><td>Full support</td></tr><tr><td><strong>Deprecated</strong></td><td>6 months</td><td>Bug fixes only, sunset header</td></tr><tr><td><strong>Retired</strong></td><td>-</td><td>Returns 410 Gone</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="breaking-vs-non-breaking">Breaking vs Non-Breaking<a href="#breaking-vs-non-breaking" class="hash-link" aria-label="Direct link to Breaking vs Non-Breaking" title="Direct link to Breaking vs Non-Breaking" translate="no">​</a></h3>
<p><strong>Non-breaking (no version bump):</strong></p>
<ul>
<li class="">Adding optional fields</li>
<li class="">Adding new endpoints</li>
<li class="">Performance improvements</li>
</ul>
<p><strong>Breaking (version bump required):</strong></p>
<ul>
<li class="">Removing fields</li>
<li class="">Changing field types</li>
<li class="">Changing endpoint behavior</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="constraints-enforced-by-aeterna">Constraints (Enforced by Aeterna)<a href="#constraints-enforced-by-aeterna" class="hash-link" aria-label="Direct link to Constraints (Enforced by Aeterna)" title="Direct link to Constraints (Enforced by Aeterna)" translate="no">​</a></h2>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">constraints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@ApiVersion\\(\&quot;v[0-9]+\&quot;\\)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;All API endpoints must declare version&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_not_match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@DeleteMapping.*v1.*payment&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Cannot remove v1 payment endpoints until 2025-06-01&quot;</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### ADR-023: Ledger Technology Selection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```markdown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># knowledge/org/platform-engineering/adrs/adr-023-ledger-tech.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ADR-023: Ledger Technology Selection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accepted (2024-04-15)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Payment services require ACID guarantees for financial transactions.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Current PostgreSQL setup cannot guarantee:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Double-entry accounting consistency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Sub-millisecond balance checks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- 50M transactions/month throughput</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Options Considered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Option | Throughput | Latency | Consistency | Team Expertise |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|--------|------------|---------|-------------|----------------|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| PostgreSQL | 1M/month | 50ms | ACID | High |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| CockroachDB | 10M/month | 20ms | Serializable | Medium |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| TigerBeetle | 100M/month | \&lt;1ms | Strict Serial | Low |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| Custom Ledger | Variable | Variable | Custom | None |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Decision</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">**TigerBeetle** for all financial ledger operations.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Rationale</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Purpose-built for financial transactions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. 1000x faster than PostgreSQL for balance operations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Built-in double-entry accounting primitives</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. Deterministic - same inputs always produce same outputs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Migration Path</span><br></span></code></pre></div></div>
<p>Phase 1: Shadow mode (TigerBeetle mirrors PostgreSQL)
Phase 2: Read from TigerBeetle, write to both
Phase 3: Write to TigerBeetle, async sync to PostgreSQL
Phase 4: TigerBeetle primary, PostgreSQL retired</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Constraints (Enforced by Aeterna)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">constraints:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - operator: must_use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target: dependency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pattern: &quot;tigerbeetle-client&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    appliesTo: [&quot;services/payments-*&quot;, &quot;services/ledger-*&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    severity: block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    message: &quot;Payment services must use TigerBeetle&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - operator: must_not_use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target: code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pattern: &quot;JdbcTemplate.*balance|UPDATE.*account.*balance&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    appliesTo: [&quot;services/payments-*&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    severity: block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    message: &quot;Direct PostgreSQL balance updates prohibited&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="related-1">Related<a href="#related-1" class="hash-link" aria-label="Direct link to Related" title="Direct link to Related" translate="no">​</a></h2>
<ul>
<li class="">ADR-024: Double-Entry Accounting Model</li>
<li class="">ADR-025: Reconciliation Strategy</li>
<li class="">Pattern: TigerBeetle Integration</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Patterns Library: Reusable Solutions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Pattern: Strangler Facade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```markdown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># knowledge/company/wolf-corp/patterns/strangler-facade.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Pattern: Strangler Facade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Problem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">How do you incrementally migrate traffic from a legacy module to a </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">new microservice without downtime?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Solution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Implement a facade that intercepts requests and routes them based on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feature flags, gradually shifting traffic to the new service.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>┌─────────────────────────────────────────────────────────────────┐
│                     Strangler Facade                             │
│                                                                  │
│   Request ──►  ┌─────────────────────────────────────────┐      │
│                │         Router                          │      │
│                │                                         │      │
│                │  1. Check feature flag                  │      │
│                │  2. Check traffic percentage            │      │
│                │  3. Check client tier (Platinum/Gold)   │      │
│                │  4. Route to appropriate backend        │      │
│                │                                         │      │
│                └──────────┬──────────────┬───────────────┘      │
│                           │              │                       │
│                     ┌─────▼─────┐  ┌─────▼─────┐                │
│                     │   Wolf    │  │   KApp    │                │
│                     │  Service  │  │  Module   │                │
│                     └───────────┘  └───────────┘                │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Implementation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```kotlin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class PaymentStranglerFacade(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private val featureFlags: FeatureFlagService,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private val wolfClient: PaymentWolfClient,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private val kappClient: PaymentKAppClient,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private val metrics: MeterRegistry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Brick(version = &quot;2.1&quot;, domain = &quot;payments&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    suspend fun initiatePayment(request: PaymentRequest): PaymentResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val routingDecision = decideRouting(request)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return when (routingDecision) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            is RouteToWolf -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                metrics.counter(&quot;strangler.wolf.requests&quot;).increment()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                wolfClient.initiate(request)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            is RouteToKApp -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                metrics.counter(&quot;strangler.kapp.requests&quot;).increment()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                kappClient.initiate(request)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            is ShadowBoth -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // Send to both, return KApp result, compare async</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                val kappResult = kappClient.initiate(request)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                launch { shadowCompare(request, kappResult) }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                kappResult</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private fun decideRouting(request: PaymentRequest): RoutingDecision {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Platinum clients get Wolf first</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (request.clientTier == Tier.PLATINUM &amp;&amp; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            featureFlags.isEnabled(&quot;wolf.payments.platinum&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return RouteToWolf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Percentage rollout for others</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        val percentage = featureFlags.getPercentage(&quot;wolf.payments.rollout&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (Random.nextInt(100) &lt; percentage) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return RouteToWolf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Shadow mode for validation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (featureFlags.isEnabled(&quot;wolf.payments.shadow&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ShadowBoth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return RouteToKApp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="traffic-migration-schedule">Traffic Migration Schedule<a href="#traffic-migration-schedule" class="hash-link" aria-label="Direct link to Traffic Migration Schedule" title="Direct link to Traffic Migration Schedule" translate="no">​</a></h2>






















































<table><thead><tr><th>Week</th><th>Platinum</th><th>Gold</th><th>Standard</th><th>Shadow</th></tr></thead><tbody><tr><td>1-2</td><td>Shadow</td><td>-</td><td>-</td><td>100%</td></tr><tr><td>3-4</td><td>10%</td><td>Shadow</td><td>-</td><td>100%</td></tr><tr><td>5-6</td><td>50%</td><td>10%</td><td>Shadow</td><td>-</td></tr><tr><td>7-8</td><td>100%</td><td>50%</td><td>10%</td><td>-</td></tr><tr><td>9-10</td><td>100%</td><td>100%</td><td>50%</td><td>-</td></tr><tr><td>11-12</td><td>100%</td><td>100%</td><td>100%</td><td>-</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="constraints">Constraints<a href="#constraints" class="hash-link" aria-label="Direct link to Constraints" title="Direct link to Constraints" translate="no">​</a></h2>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">constraints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;StranglerFacade|@Strangler&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">appliesTo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;services/*-facade&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Facade services must use Strangler pattern&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;metrics\\.counter\\(\&quot;strangler\\.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> warn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Strangler facades should emit routing metrics&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="related-2">Related<a href="#related-2" class="hash-link" aria-label="Direct link to Related" title="Direct link to Related" translate="no">​</a></h2>
<ul>
<li class="">ADR-001: Strangler Fig Migration Strategy</li>
<li class="">ADR-002: Feature Flag Strategy</li>
<li class="">Pattern: Shadow Testing</li>
<li class="">Pattern: Reconciler Bot</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Pattern: Brick Specification</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```markdown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># knowledge/company/wolf-corp/patterns/brick-specification.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Pattern: Brick Specification</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Problem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">How do you ensure 200+ microservices across 12 teams maintain </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">consistency in contracts, versioning, and observability?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Solution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Every service function is a **Brick**: a versioned, atomic, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">observable unit of business capability.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Brick Anatomy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```kotlin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Brick(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    version = &quot;2.3&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    domain = &quot;payments&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    capability = &quot;initiate-payment&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    owner = &quot;payments-core-team&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sla = Sla(p99 = 100.ms, availability = 99.9)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Idempotent(key = &quot;request.idempotencyKey&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@CircuitBreaker(name = &quot;payment-initiate&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Metered</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Traced</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">suspend fun initiatePayment(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Valid request: PaymentInitiateRequest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">): PaymentInitiateResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Implementation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="required-annotations">Required Annotations<a href="#required-annotations" class="hash-link" aria-label="Direct link to Required Annotations" title="Direct link to Required Annotations" translate="no">​</a></h2>













































<table><thead><tr><th>Annotation</th><th>Purpose</th><th>Required</th></tr></thead><tbody><tr><td><code>@Brick</code></td><td>Version, domain, ownership</td><td>✅ Yes</td></tr><tr><td><code>@Idempotent</code></td><td>Exactly-once semantics</td><td>✅ For mutations</td></tr><tr><td><code>@CircuitBreaker</code></td><td>Fault isolation</td><td>✅ For external calls</td></tr><tr><td><code>@Metered</code></td><td>Business metrics</td><td>✅ Yes</td></tr><tr><td><code>@Traced</code></td><td>Distributed tracing</td><td>✅ Yes</td></tr><tr><td><code>@Cached</code></td><td>Response caching</td><td>Optional</td></tr><tr><td><code>@RateLimited</code></td><td>Throttling</td><td>Optional</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="version-compatibility-matrix">Version Compatibility Matrix<a href="#version-compatibility-matrix" class="hash-link" aria-label="Direct link to Version Compatibility Matrix" title="Direct link to Version Compatibility Matrix" translate="no">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Brick Version Format: MAJOR.MINOR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MAJOR bump (breaking):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Request schema changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Response schema changes  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Semantic behavior changes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MINOR bump (compatible):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Performance improvements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Bug fixes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - New optional fields</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="registry-entry">Registry Entry<a href="#registry-entry" class="hash-link" aria-label="Direct link to Registry Entry" title="Direct link to Registry Entry" translate="no">​</a></h2>
<p>Every Brick is registered in the Wolf Registry:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># registry/payments/initiate-payment.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">brick</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> payments.initiate</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">payment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2.3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">domain</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> payments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">owner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> payments</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">core</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">team</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">contract</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PaymentInitiateRequest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">response</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PaymentInitiateResponse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">errors</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> INVALID_AMOUNT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> INSUFFICIENT_FUNDS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> DUPLICATE_REQUEST</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dependencies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ledger.create</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">transfer@2.x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> risk.evaluate</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">transaction@1.x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> connectivity.send</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">rail@3.x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sla</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">p50</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 20ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">p99</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">availability</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 99.9%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">migration</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">strangler_facade</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> payment</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">strangler</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">facade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">legacy_module</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.legacy.kapp.payments.PaymentProcessor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">traffic_percentage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">75</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="constraints-1">Constraints<a href="#constraints-1" class="hash-link" aria-label="Direct link to Constraints" title="Direct link to Constraints" translate="no">​</a></h2>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">constraints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@Brick\\(.*version.*domain.*\\)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">appliesTo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;services/*/src/**/*.kt&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;All service functions must be annotated as Bricks&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@Idempotent&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">appliesTo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;**/*Command.kt&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;**/*Mutation.kt&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;All mutations must be idempotent&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;registry/.*/.*\\.yaml&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> warn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Bricks should be registered in the Wolf Registry&quot;</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### Pattern: Anti-Corruption Layer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```markdown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># knowledge/company/wolf-corp/patterns/anti-corruption-layer.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Pattern: Anti-Corruption Layer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Problem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">How do you prevent legacy domain models from &quot;corrupting&quot; the clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">design of new microservices during migration?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Solution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Implement a translation layer that converts between legacy and </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modern domain models, keeping them strictly separated.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    Wolf Service (Clean Domain)                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ┌─────────────────────────────────────────────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │                  Domain Model                            │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │                                                          │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   Payment {                                              │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │     id: PaymentId                                        │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │     amount: Money                                        │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │     status: PaymentStatus                                │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │     initiatedAt: Instant                                 │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   }                                                      │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │                                                          │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └─────────────────────────────────────────────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                              │                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                              ▼                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ┌─────────────────────────────────────────────────────────┐   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │              Anti-Corruption Layer                       │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │                                                          │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   - Translates KApp → Wolf models                        │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   - Translates Wolf → KApp models                        │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   - Handles missing/extra fields                         │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   - Normalizes enums and codes                           │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │                                                          │   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └─────────────────────────────────────────────────────────┘   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                              │                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└──────────────────────────────┼───────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               ▼</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                    KApp (Legacy Domain)                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   PAYMENT_RECORD {                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     PAY_ID: VARCHAR(20)                                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     AMT: DECIMAL(15,2)                                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     CCY: CHAR(3)                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     STAT_CD: CHAR(2)                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     CRE_DT: DATE                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│     CRE_TM: TIME                                                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   }                                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────┘</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="implementation">Implementation<a href="#implementation" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation" translate="no">​</a></h2>
<div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token annotation builtin">@Component</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> PaymentAntiCorruptionLayer </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Translate legacy KApp payment to Wolf domain model</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fromLegacy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">record</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> KAppPaymentRecord</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Payment </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Payment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">PaymentId</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">record</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">payId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            amount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Money</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> record</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">amt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                currency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Currency</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">record</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ccy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">translateStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">record</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">statCd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            initiatedAt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">combineDateTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">record</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">creDt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> record</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">creTm</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * Translate Wolf payment to legacy KApp format</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">toLegacy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payment</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> Payment</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> KAppPaymentRecord </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">KAppPaymentRecord</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            payId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> payment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">take</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Truncate to legacy limit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            amt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> payment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ccy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> payment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">currency</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">currencyCode</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            statCd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">reverseTranslateStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">payment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            creDt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> payment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">initiatedAt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toLocalDate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            creTm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> payment</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">initiatedAt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">toLocalTime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fun</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">translateStatus</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">legacyCode</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> String</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> PaymentStatus </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">when</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">legacyCode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-literal singleline string" style="color:#e3116c">&quot;01&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> PaymentStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PENDING</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-literal singleline string" style="color:#e3116c">&quot;02&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> PaymentStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PROCESSING</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-literal singleline string" style="color:#e3116c">&quot;03&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> PaymentStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">COMPLETED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-literal singleline string" style="color:#e3116c">&quot;04&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> PaymentStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FAILED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string-literal singleline string" style="color:#e3116c">&quot;99&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> PaymentStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CANCELLED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">warn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string-literal singleline string" style="color:#e3116c">&quot;Unknown legacy status: </span><span class="token string-literal singleline interpolation interpolation-punctuation punctuation" style="color:#393A34">$</span><span class="token string-literal singleline interpolation expression">legacyCode</span><span class="token string-literal singleline string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                PaymentStatus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UNKNOWN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="translation-registry">Translation Registry<a href="#translation-registry" class="hash-link" aria-label="Direct link to Translation Registry" title="Direct link to Translation Registry" translate="no">​</a></h2>
<p>Document all translations for team reference:</p>



































<table><thead><tr><th>Wolf Field</th><th>KApp Field</th><th>Transformation</th></tr></thead><tbody><tr><td><code>id: PaymentId</code></td><td><code>PAY_ID: VARCHAR(20)</code></td><td>Truncate to 20 chars</td></tr><tr><td><code>amount.value</code></td><td><code>AMT: DECIMAL(15,2)</code></td><td>Direct mapping</td></tr><tr><td><code>amount.currency</code></td><td><code>CCY: CHAR(3)</code></td><td>ISO 4217 code</td></tr><tr><td><code>status</code></td><td><code>STAT_CD: CHAR(2)</code></td><td>Enum translation</td></tr><tr><td><code>initiatedAt</code></td><td><code>CRE_DT + CRE_TM</code></td><td>Combine date+time</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="constraints-2">Constraints<a href="#constraints-2" class="hash-link" aria-label="Direct link to Constraints" title="Direct link to Constraints" translate="no">​</a></h2>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">constraints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_not_match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;KApp.*Record|PAYMENT_RECORD&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">appliesTo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;services/*/domain/**&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> block</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      Legacy types must not leak into domain layer.</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      Use Anti-Corruption Layer for translation.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> must_exist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">target</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pattern</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;**/acl/*Translator.kt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">appliesTo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;services/*-service&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> warn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">message</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Services should have ACL translators&quot;</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## Memory Layer: Team Learnings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">### How AI Agents Use Migration Knowledge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```rust</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Agent working on payments-service asks about migration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let context = TenantContext::new(&quot;wolf-corp&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .with_org(&quot;platform-engineering&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .with_team(&quot;payments-core&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .with_project(&quot;payments-service&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Search memory for migration learnings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let learnings = memory.search(SearchQuery {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    query: &quot;strangler facade gotchas payment migration&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layers: vec![</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MemoryLayer::Project,  // Project-specific issues</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MemoryLayer::Team,     // Team discoveries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MemoryLayer::Org,      // Org-wide patterns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MemoryLayer::Company,  // Global lessons</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context: context.clone(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}).await?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Results (ordered by layer precedence):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 1. [Project] &quot;Payment facade race condition with KApp - use distributed lock&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 2. [Team] &quot;TigerBeetle connection pooling: max 10 connections per service&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 3. [Org] &quot;Always shadow test for 2 weeks before traffic shift&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 4. [Company] &quot;Feature flags: use LaunchDarkly SDK v7+ for Kotlin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Check constraints before writing code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let violations = knowledge.check_constraints(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ConstraintContext::new()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .with_file(&quot;src/main/kotlin/PaymentService.kt&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .with_code(proposed_code)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .with_dependencies(&amp;[&quot;postgresql-client&quot;])  // Trying to use PostgreSQL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">).await?;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Result: BLOCKED</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// &quot;Payment services must use TigerBeetle for ledger operations.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//  See ADR-023: Ledger Technology Selection&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="memory-examples-by-layer">Memory Examples by Layer<a href="#memory-examples-by-layer" class="hash-link" aria-label="Direct link to Memory Examples by Layer" title="Direct link to Memory Examples by Layer" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">COMPANY LAYER (Global Lessons)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;Strangler facades need circuit breakers on BOTH backends&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;Shadow testing found 3% discrepancy rate is normal during migration&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;Never migrate during quarter-end close periods&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;LaunchDarkly flags: always set default to legacy path&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORG LAYER (Platform Engineering)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;TigerBeetle: batch transfers for &gt;100 operations&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;Temporal workflows: use 30-day retention for audit&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;ClickHouse: partition by week for payment analytics&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;CockroachDB: set transaction priority for critical paths&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEAM LAYER (Payments Core)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">━━━━━━━━━━━━━━━━━━━━━━━━━━</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;Payment idempotency: hash(client_id + reference + amount)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;KApp STAT_CD &#x27;05&#x27; is undocumented - means &#x27;pending_review&#x27;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;Reconciler bot: run at 3am UTC to avoid peak load&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;Legacy API timeout: 30s (not 10s as documented)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PROJECT LAYER (payments-service)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;CircuitBreaker: 50% threshold, 60s timeout for KApp calls&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;PaymentInitiateRequest: amount must be positive (legacy allows 0)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;Shadow mode enabled for Platinum clients since 2024-06-01&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">• &quot;Deployment: blue-green with 10min bake time&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="memory-promotion-memory-r1">Memory Promotion (Memory-R1)<a href="#memory-promotion-memory-r1" class="hash-link" aria-label="Direct link to Memory Promotion (Memory-R1)" title="Direct link to Memory Promotion (Memory-R1)" translate="no">​</a></h3>
<p>When a developer discovers something valuable, agents can promote it:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Developer finds a critical gotcha</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">memory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">MemoryEntry</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    content</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;KApp payment module has 20-char limit on payment ID. </span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">              Wolf uses UUIDs (36 chars). ACL must truncate or hash.&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">MemoryLayer</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Project</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">MemoryMetadata</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token macro property" style="color:#36acaa">vec!</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;gotcha&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;acl&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;migration&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">MemorySource</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Conversation</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> message_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;msg_123&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">..</span><span class="token class-name">Default</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">default</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Later: This memory gets positive feedback from multiple team members</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">memory</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">feedback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">MemoryFeedback</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    memory_id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mem_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reward</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Very helpful</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    feedback_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">FeedbackType</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Positive</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Memory-R1 autonomous optimization promotes it to team layer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Now ALL payments-core team members benefit from this discovery</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="agent-collaboration-scenarios">Agent Collaboration Scenarios<a href="#agent-collaboration-scenarios" class="hash-link" aria-label="Direct link to Agent Collaboration Scenarios" title="Direct link to Agent Collaboration Scenarios" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-1-new-developer-onboarding">Scenario 1: New Developer Onboarding<a href="#scenario-1-new-developer-onboarding" class="hash-link" aria-label="Direct link to Scenario 1: New Developer Onboarding" title="Direct link to Scenario 1: New Developer Onboarding" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Developer: &quot;I need to add a new payment validation rule&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AI Agent (with Aeterna):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">━━━━━━━━━━━━━━━━━━━━━━━━━</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. [Knowledge Check] Searching ADRs and policies...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Found:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • ADR-001: No new features in legacy KApp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • Policy: All new code must be in Wolf services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • Pattern: Brick Specification required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. [Memory Search] Looking for similar work...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Found (Team Memory):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • &quot;Validation rules go in payments-validator service&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • &quot;Use @ValidationBrick annotation&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • &quot;Legacy PaymentValidator.java is frozen - don&#x27;t touch&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. [Constraint Check] Validating your approach...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ⚠️ WARNING: You&#x27;re editing src/main/java/com/legacy/kapp/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   This is BLOCKED by company policy.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✅ SUGGESTED: Create new Brick in services/payments-validator/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. [Generate Code] Based on patterns and team standards...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   @Brick(version = &quot;1.0&quot;, domain = &quot;payments&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   @ValidationBrick</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   class AmountRangeValidator : PaymentValidator {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       override fun validate(payment: Payment): ValidationResult {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           // Implementation following team patterns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-2-cross-team-dependency">Scenario 2: Cross-Team Dependency<a href="#scenario-2-cross-team-dependency" class="hash-link" aria-label="Direct link to Scenario 2: Cross-Team Dependency" title="Direct link to Scenario 2: Cross-Team Dependency" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Liquidity Team: &quot;We need payment status for forecasting&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AI Agent (with Aeterna):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">━━━━━━━━━━━━━━━━━━━━━━━━━</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. [Knowledge Check] Checking API contracts...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Found (Registry):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • payments.get-status@v2 - Available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • payments.subscribe-status@v1 - Available (Event-driven)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ADR-015: Use v2 APIs (v1 deprecated)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. [Memory Search] Cross-team integration patterns...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Found (Org Memory):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • &quot;Prefer event subscription over polling for status&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • &quot;Payment events on Kafka topic: wolf.payments.status&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • &quot;Use Avro schemas from schema-registry&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. [Constraint Check] Validating integration...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✅ OK: Using approved v2 API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ✅ OK: Event-driven pattern preferred</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ⚠️ WARNING: Liquidity services should not call payment </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ledger directly (ADR-023)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4. [Generate Integration]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   @Brick(version = &quot;1.0&quot;, domain = &quot;liquidity&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   class PaymentStatusSubscriber(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       private val kafka: KafkaConsumer&lt;PaymentStatusEvent&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       @EventHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       suspend fun onPaymentStatus(event: PaymentStatusEvent) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           // Update forecast based on payment status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="scenario-3-migration-decision">Scenario 3: Migration Decision<a href="#scenario-3-migration-decision" class="hash-link" aria-label="Direct link to Scenario 3: Migration Decision" title="Direct link to Scenario 3: Migration Decision" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Tech Lead: &quot;Should we migrate the FX module next?&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AI Agent (with Aeterna):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">━━━━━━━━━━━━━━━━━━━━━━━━━</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. [Knowledge Check] Migration status and dependencies...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Current State:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • Payments: 75% migrated (Wolf primary)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • Liquidity: 40% migrated (Shadow testing)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • FX: 0% migrated (Legacy only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • Risk: 0% migrated (Legacy only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Dependency Graph:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • FX depends on: Payments (✅), Risk (❌)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • Risk depends on: Payments (✅), Liquidity (⚠️)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. [Memory Search] Previous migration learnings...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Found (Company Memory):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • &quot;Always migrate dependencies first&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • &quot;FX has complex KApp stored procedures - 3 month estimate&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   • &quot;Risk module: Shadow testing revealed 5% discrepancy&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. [ADR Recommendation]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Based on analysis, I recommend:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ❌ NOT ready to migrate FX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Reasons:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   1. Risk module (dependency) not migrated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   2. Liquidity (transitive dependency) still in shadow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   3. FX stored procedures need refactoring first</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Suggested sequence:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   1. Complete Liquidity migration (4 weeks)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   2. Migrate Risk module (6 weeks)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   3. Then migrate FX (12 weeks)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Want me to draft an ADR for the migration sequence?</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="governance-dashboard">Governance Dashboard<a href="#governance-dashboard" class="hash-link" aria-label="Direct link to Governance Dashboard" title="Direct link to Governance Dashboard" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="policy-compliance-by-team">Policy Compliance by Team<a href="#policy-compliance-by-team" class="hash-link" aria-label="Direct link to Policy Compliance by Team" title="Direct link to Policy Compliance by Team" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                 WOLF MIGRATION GOVERNANCE                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                 Week 24 / 2024                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─────────────────────────────────────────────────────────────────┤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  POLICY COMPLIANCE                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ━━━━━━━━━━━━━━━━━                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  payments-core     ████████████████████░░░░  85%                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  liquidity-team    ██████████████████░░░░░░  75%                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  connectivity      ████████████████████████  98%                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  risk-team         ██████████████░░░░░░░░░░  60%                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  fx-team           ████████░░░░░░░░░░░░░░░░  35%  ⚠️            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  TOP VIOLATIONS                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ━━━━━━━━━━━━━━━                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  1. [BLOCK] Legacy code modifications (fx-team: 12 instances)   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  2. [WARN]  Missing @Brick annotations (risk-team: 8 instances) │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  3. [INFO]  Outdated API versions (various: 23 instances)       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  MIGRATION PROGRESS                                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ━━━━━━━━━━━━━━━━━━                                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Payments     [██████████████████░░]  90%  → Target: 100% Q3    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Liquidity    [████████████░░░░░░░░]  60%  → Target: 100% Q4    │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Connectivity [████████████████████]  100% ✅ Complete           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Risk         [████████░░░░░░░░░░░░]  40%  → Target: 100% Q1&#x27;25 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  FX           [████░░░░░░░░░░░░░░░░]  20%  → Target: 100% Q2&#x27;25 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  KNOWLEDGE HEALTH                                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ━━━━━━━━━━━━━━━━                                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  ADRs:      45 (+3 this week)                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Policies:  28 (2 violations pending)                           │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Patterns:  52 (+5 this week)                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│  Memories:  1,247 (89 promoted this week)                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                                                                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────────┘</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="getting-started">Getting Started<a href="#getting-started" class="hash-link" aria-label="Direct link to Getting Started" title="Direct link to Getting Started" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-initialize-aeterna-for-migration-project">1. Initialize Aeterna for Migration Project<a href="#1-initialize-aeterna-for-migration-project" class="hash-link" aria-label="Direct link to 1. Initialize Aeterna for Migration Project" title="Direct link to 1. Initialize Aeterna for Migration Project" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Clone and setup</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/your-org/aeterna</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> aeterna</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cargo</span><span class="token plain"> build </span><span class="token parameter variable" style="color:#36acaa">--release</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Initialize knowledge repository</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aeterna init </span><span class="token parameter variable" style="color:#36acaa">--template</span><span class="token plain"> strangler-fig </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--company</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;wolf-corp&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--orgs</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;platform-engineering,product,security&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-import-existing-adrs">2. Import Existing ADRs<a href="#2-import-existing-adrs" class="hash-link" aria-label="Direct link to 2. Import Existing ADRs" title="Direct link to 2. Import Existing ADRs" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Import from existing docs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aeterna knowledge </span><span class="token function" style="color:#d73a49">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--source</span><span class="token plain"> ./legacy-docs/adrs </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--type</span><span class="token plain"> adr </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">--layer</span><span class="token plain"> company</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Validate constraints</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aeterna knowledge validate </span><span class="token parameter variable" style="color:#36acaa">--strict</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-configure-cicd-integration">3. Configure CI/CD Integration<a href="#3-configure-cicd-integration" class="hash-link" aria-label="Direct link to 3. Configure CI/CD Integration" title="Direct link to 3. Configure CI/CD Integration" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># .github/workflows/aeterna-check.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Aeterna Policy Check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pull_request</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">policy-check</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Check Aeterna Constraints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> aeterna/policy</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">check</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./aeterna.toml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">fail-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> block  </span><span class="token comment" style="color:#999988;font-style:italic"># block, warn, or info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Post Violations to PR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> failure()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> aeterna/pr</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">comment</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> policy</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">violation</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-enable-ai-agent-integration">4. Enable AI Agent Integration<a href="#4-enable-ai-agent-integration" class="hash-link" aria-label="Direct link to 4. Enable AI Agent Integration" title="Direct link to 4. Enable AI Agent Integration" translate="no">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// In your AI coding assistant</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> aeterna </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">AeternaClient</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">new</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Before generating code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> context </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> aeterna</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_context</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tenant</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;adrs&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;policies&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;patterns&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;memories&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Include in agent prompt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> prompt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token macro property" style="color:#36acaa">format!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;{}\n\nRelevant context:\n{}&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_request</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">to_prompt_string</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// After generating code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> violations </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> aeterna</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">check_constraints</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">generated_code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">file_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">await</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> violations</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">has_blocking</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Regenerate with constraint awareness</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary" translate="no">​</a></h2>
<p>Aeterna enables successful strangler fig migrations by:</p>
<ol>
<li class=""><strong>Codifying Decisions</strong>: ADRs capture the &quot;why&quot; behind migration choices</li>
<li class=""><strong>Enforcing Policies</strong>: Constraints prevent legacy patterns from spreading</li>
<li class=""><strong>Sharing Patterns</strong>: Reusable solutions accelerate team delivery</li>
<li class=""><strong>Preserving Memory</strong>: Learnings survive team changes and time</li>
<li class=""><strong>Enabling Agents</strong>: AI assistants have full migration context</li>
<li class=""><strong>Tracking Progress</strong>: Governance dashboard shows compliance trends</li>
</ol>
<p><strong>The result</strong>: 300 engineers can transform a monolith over 3 years without losing institutional knowledge, repeating mistakes, or violating architectural decisions.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/kikokikok/aeterna/tree/main/website/docs/examples/strangler-fig-migration.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/aeterna/docs/guides/cost-optimization"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Cost Optimization Guide</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/aeterna/docs/examples/policies/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Example Policies Library</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-scenario-project-wolf" class="table-of-contents__link toc-highlight">The Scenario: Project Wolf</a></li><li><a href="#aeternas-role-the-transformation-knowledge-graph" class="table-of-contents__link toc-highlight">Aeterna&#39;s Role: The Transformation Knowledge Graph</a></li><li><a href="#organizational-structure-in-aeterna" class="table-of-contents__link toc-highlight">Organizational Structure in Aeterna</a><ul><li><a href="#company-layer-global-standards" class="table-of-contents__link toc-highlight">Company Layer: Global Standards</a></li><li><a href="#organization-layer-domain-standards" class="table-of-contents__link toc-highlight">Organization Layer: Domain Standards</a></li><li><a href="#team-layer-implementation-standards" class="table-of-contents__link toc-highlight">Team Layer: Implementation Standards</a></li></ul></li><li><a href="#adr-library-capturing-migration-decisions" class="table-of-contents__link toc-highlight">ADR Library: Capturing Migration Decisions</a><ul><li><a href="#adr-001-strangler-fig-migration-strategy" class="table-of-contents__link toc-highlight">ADR-001: Strangler Fig Migration Strategy</a></li></ul></li><li><a href="#related" class="table-of-contents__link toc-highlight">Related</a><ul><li><a href="#version-lifecycle" class="table-of-contents__link toc-highlight">Version Lifecycle</a></li><li><a href="#breaking-vs-non-breaking" class="table-of-contents__link toc-highlight">Breaking vs Non-Breaking</a></li></ul></li><li><a href="#constraints-enforced-by-aeterna" class="table-of-contents__link toc-highlight">Constraints (Enforced by Aeterna)</a></li><li><a href="#related-1" class="table-of-contents__link toc-highlight">Related</a></li><li><a href="#traffic-migration-schedule" class="table-of-contents__link toc-highlight">Traffic Migration Schedule</a></li><li><a href="#constraints" class="table-of-contents__link toc-highlight">Constraints</a></li><li><a href="#related-2" class="table-of-contents__link toc-highlight">Related</a></li><li><a href="#required-annotations" class="table-of-contents__link toc-highlight">Required Annotations</a></li><li><a href="#version-compatibility-matrix" class="table-of-contents__link toc-highlight">Version Compatibility Matrix</a></li><li><a href="#registry-entry" class="table-of-contents__link toc-highlight">Registry Entry</a></li><li><a href="#constraints-1" class="table-of-contents__link toc-highlight">Constraints</a></li><li><a href="#implementation" class="table-of-contents__link toc-highlight">Implementation</a></li><li><a href="#translation-registry" class="table-of-contents__link toc-highlight">Translation Registry</a></li><li><a href="#constraints-2" class="table-of-contents__link toc-highlight">Constraints</a><ul><li><a href="#memory-examples-by-layer" class="table-of-contents__link toc-highlight">Memory Examples by Layer</a></li><li><a href="#memory-promotion-memory-r1" class="table-of-contents__link toc-highlight">Memory Promotion (Memory-R1)</a></li></ul></li><li><a href="#agent-collaboration-scenarios" class="table-of-contents__link toc-highlight">Agent Collaboration Scenarios</a><ul><li><a href="#scenario-1-new-developer-onboarding" class="table-of-contents__link toc-highlight">Scenario 1: New Developer Onboarding</a></li><li><a href="#scenario-2-cross-team-dependency" class="table-of-contents__link toc-highlight">Scenario 2: Cross-Team Dependency</a></li><li><a href="#scenario-3-migration-decision" class="table-of-contents__link toc-highlight">Scenario 3: Migration Decision</a></li></ul></li><li><a href="#governance-dashboard" class="table-of-contents__link toc-highlight">Governance Dashboard</a><ul><li><a href="#policy-compliance-by-team" class="table-of-contents__link toc-highlight">Policy Compliance by Team</a></li></ul></li><li><a href="#getting-started" class="table-of-contents__link toc-highlight">Getting Started</a><ul><li><a href="#1-initialize-aeterna-for-migration-project" class="table-of-contents__link toc-highlight">1. Initialize Aeterna for Migration Project</a></li><li><a href="#2-import-existing-adrs" class="table-of-contents__link toc-highlight">2. Import Existing ADRs</a></li><li><a href="#3-configure-cicd-integration" class="table-of-contents__link toc-highlight">3. Configure CI/CD Integration</a></li><li><a href="#4-enable-ai-agent-integration" class="table-of-contents__link toc-highlight">4. Enable AI Agent Integration</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/aeterna/docs/">Getting Started</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kikokikok/aeterna" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Aeterna Contributors.</div></div></div></footer></div>
</body>
</html>